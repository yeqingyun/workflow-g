<#include "/common/head.html">
<#assign proofType=""/>
<#assign text=""/>
<#assign processId=""/>
<#assign rows=""/>
<#assign factory=""/>
<!-- 展示表单 -->
<#if processSteps??> 
<table class="formtable" cellspacing="1" cellpadding="0">
<#list processSteps as steps> 
	<#if steps.key =='startevent1'>
	<#assign rows=steps.vars["isOffRowCount"]!""/>
		<tr>
			<td colspan="4" class="formtable_td_key"  align="center">设备维修申请单</td>
		</tr>
		<tr>
			<td class="formtable_td_key">申请部门：</td>
			<td class="formtable_td_value">${steps.vars["applyDepartment"]!""}</td>
			<td class="formtable_td_key">申请日期：</td>
			<td class="formtable_td_value">${steps.vars["applyDate"]!""}</td>
		</tr>
		<tr>
			<td class="formtable_td_key">设备名称：</td>
			<td class="formtable_td_value">${steps.vars["equipmentName"]!""}</td>
			<td class="formtable_td_key">型号/规格：</td>
			<td class="formtable_td_value">${steps.vars["typeOrStandard"]!""}</td>
		</tr>
		<tr>
			<td class="formtable_td_key">设备编号：</td>
			<td class="formtable_td_value">${steps.vars["equipmentNo"]!""}</td>
			<td class="formtable_td_key">生产厂家:</td>
			<td class="formtable_td_value">${steps.vars["manufactureFactory"]!""}</td>
		</tr>
		<tr>
		  	  	<td class="formtable_td_key">所属类别</td>
		  	  		<td class="formtable_td_value">
			  	  		类别选择:<#if steps.vars["equipmentType"]??> 
			  	  		<input type="checkbox"   disabled="disabled"   value="1"  <#if steps.vars["equipmentType"]?contains("1")>checked</#if>/>设备类
		                <input type="checkbox"   disabled="disabled"   value="2"  <#if steps.vars["equipmentType"]?contains("2")>checked</#if>/>仪表类
		                <input type="checkbox"   disabled="disabled"   value="3"  <#if steps.vars["equipmentType"]?contains("3")>checked</#if>/>工具类
		                <input type="checkbox"   disabled="disabled"   value="4"  <#if steps.vars["equipmentType"]?contains("4")>checked</#if>/>测架类
		                </#if>
		  	  		</td>
		  	  	<td class="formtable_td_key">工厂：</td>
				<td class="formtable_td_value">${steps.vars["factoryName"]!""}</td>
		  	</tr>
		<tr>
			<td class="formtable_td_key">故障现象描述：</td>
			<td class="formtable_td_value" colspan="3">
			<textarea class="easyui-validatebox"   
					style="font-size: 12px; width: 800px; height: 50px;" readonly="readonly" disabled="disabled">${steps.vars["faultDescribe"]!""}</textarea></td>
		</tr>
		<#if steps.vars["isOffGaffer"]=='1'>
		<tr>
			<td class="formtable_td_key">凭证类型：</td>
			<td class="formtable_td_value" colspan="3">
				<#if steps.vars["proofType"] == 'NB'>NB 标准采购申请</#if>
				<#if steps.vars["proofType"] == 'ZR01'>ZR01 总经办非生产物资采购申请</#if>
				<#if steps.vars["proofType"] == 'ZR02'>ZR02 工程部非生产物资采购申请</#if>
				<#if steps.vars["proofType"] == 'ZR03'>ZR03 物殊采购申请</#if>
				<#if steps.vars["proofType"] == 'ZR04 '>ZR04 金立非生产物资采购申请(测试部)</#if>
				<#if steps.vars["proofType"] == 'ZR05'>ZR05金立非生产物资采购申请(信息部)</#if>
			</td>
		</tr>
		<tr>
				  	<td colspan="6" class="formtable_td_key" align="center">设备维修物料清单</td>
				</tr>
				<tr>
				  	<td class="formtable_td_value" colspan="6">
				  	  	<div style="width:1350px;margin-top:2px;border:solid 1px #95B8E7;">
					  	  	<div style="border-top:solid 1px #666666;">
								<table class="gridtable">
									<thead>
										<tr>
											<td width="24" align="center">序号</td>
											<td width="30" align="center">科目分配</td>
											<td width="80" align="center">物料编码</td>
											<td width="90" align="center">物料名称及规格</td>
											<td width="60" align="center">申请数量</td>
											<td width="60" align="center">单位</td>
											<td width="80" align="center">总账科目</td>
											<td width="125" align="center">成本中心</td>
											<td width="60" align="center">预估单价</td>
											<td width="80" align="center">合计</td>
											<td width="125" align="center">交货日期</td>
											<td width="80" align="center">采购组</td>
											<td width="80" align="center">物料组</td>
											<td width="80" align="center">申请者</td>
											<td width="180" align="center">备注</td>
										</tr>
									</thead>
								</table>
							</div>
							<div style="height:auto;overflow-y:auto;border-top:solid 1px #666666;">
								<table class="gridtable" style="word-break:break-all; word-wrap:break-all;">
									<tbody>
									<#if steps.vars["scrapWay"]=='1'>
										<#if steps.vars["MFixedAssetsDetraction"]??>
						   					<#assign text1>
												${(steps.vars["MFixedAssetsDetraction"])!""}
											</#assign>
											<#assign json=text1?eval />
											<#list json.accessoryData as item>
												<tr>
													<td width="24" align="center">${item.rowno}</td>
													<td width="30" align="top">${item.courseAllot}</td>
													<td width="80" align="top">${item.stockNumber}</td>
													<td width="90" align="top">${item.stockNameAndStandard}</td>
													<td width="60" align="top">${item.applyNumber}</td>
													<td width="60" align="top">${item.monad}</td>
													<td width="80" align="top">${item.reckoning}</td>
													<td width="125" align="top">${item.costCenter}</td>
													<td width="60" align="top">${item.unitPrice}</td>
													<td width="80" align="top">${item.amountInTotal}</td>
													<td width="125" align="top">${item.deliveryDate}</td>
													<td width="80" align="top">${item.procurementSection}</td>
													<td width="80" align="top">${item.itemGroup}</td>
													<td width="80" align="top">${item.applyName}</td>
													<td width="180" align="top">${item.remark}</td>
												</tr>
											</#list>
			   							</#if>
			   							</#if>
			   							<#if steps.vars["scrapWay"]=='2'>
										<#if steps.vars["scrapWay2JsonStr"]??>
						   					<#assign text1>
												${(steps.vars["scrapWay2JsonStr"])!""}
											</#assign>
											<#assign json=text1?eval />
											<#list json.accessoryData as item>
												<tr>
													<td width="24" align="center">${item.rowno}</td>
													<td width="30" align="top">${item.courseAllot}</td>
													<td width="80" align="top">${item.stockNumber}</td>
													<td width="90" align="top">${item.stockNameAndStandard}</td>
													<td width="60" align="top">${item.applyNumber}</td>
													<td width="60" align="top">${item.monad}</td>
													<td width="80" align="top">${item.reckoning}</td>
													<td width="125" align="top">${item.costCenter}</td>
													<td width="60" align="top">${item.unitPrice}</td>
													<td width="80" align="top">${item.amountInTotal}</td>
													<td width="125" align="top">${item.deliveryDate}</td>
													<td width="80" align="top">${item.procurementSection}</td>
													<td width="80" align="top">${item.itemGroup}</td>
													<td width="80" align="top">${item.applyName}</td>
													<td width="180" align="top">${item.remark}</td>
												</tr>
											</#list>
			   							</#if>
			   							</#if>
									</tbody>
								</table>
							</div>
						</div>	
				  	  </td>
				  	</tr>
				  </#if>
		<tr>
		<td class="formtable_td_key">申请人：</td>
		<td class="formtable_td_value" >
			${(steps.vars["applyName"])!""}
		</td>
		<td class="formtable_td_key">日期：</td>
		<td class="formtable_td_value">
			${(steps.vars["applyEmpDate"])!""}
		</td>
	</tr>
	<#if steps.attachments??>
			<tr>
				<td class="formtable_td_key">附件：</td>
				<td class="formtable_td_value" colspan="3">
				<#list steps.attachments as attachs> 
				<a href="${attachs.url}">${attachs.name}_${attachs.revision}.0 </a><br /> </#list>
				</td>
			</tr>
		</#if>
		<style type="text/css">
				table.gridtable {
					font-family: verdana,arial,sans-serif;
					font-size:11px;
					color:#333333;
					border-width: 1px;
					border-color: #666666;
					border-collapse: collapse;
				}
				table.gridtable thead td {
					padding: 4px;
					border-top:solid 1px #666666;
					border-right:solid 1px #666666;
					border-left:solid 1px #666666;
				}
				table.gridtable tbody td {
					padding: 4px;
					border-width: 1px;
					border-style: solid;
					border-color: #666666;
				}
			</style>
</#if>

<!-- 流程发起人确认流程是否结束 -->
<#if steps.key == 'confirmProcessEndTask'>
<#if steps.vars["confirmProcessEndAudi"] == '1'>
	<tr>
	<td class="formtable_td_key" rowspan="3">发起人确认流程是否结束</td>
		<td class="formtable_td_key">是否结束该流程：</td>	
		<td class="formtable_td_value" colspan="2">
			<#if steps.vars["confirmProcessEndAudi"] == '1'>
			是
			</#if>
			<#if steps.vars["confirmProcessEndAudi"] == '0'>
			否
			</#if>
		</td>
	</tr>
	<tr>
		<td class="formtable_td_key">确认意见：</td>	
		<td class="formtable_td_value" colspan="3">
		<textarea class="easyui-validatebox"   
					style="font-size: 12px; width: 800px; height: 50px;" readonly="readonly" disabled="disabled">${(steps.vars["applyUserAudiAdvice"])!""}</textarea></td>
	</tr>
	<tr>
		<td class="formtable_td_key">发起人签字：</td>
		<td class="formtable_td_value" >
			${(steps.vars["applyUserName"])!""}
		</td>
		<td class="formtable_td_key">签字时间：</td>
		<td class="formtable_td_value">
			${(steps.vars["applyUserAudiTime"])!""}
		</td>
	</tr>
	</#if>
</#if>

<!-- 修改表单申请 -->
	<#if steps.key =='updateEquipmentApplyTask'>
		<#assign rows=steps.vars["isOffRowCount"]!""/>
		<tr>
			<td colspan="4" class="formtable_td_key"  align="center">修改设备维修申请单</td>
		</tr>
		<tr>
			<td class="formtable_td_key">申请部门：</td>
			<td class="formtable_td_value">${steps.vars["updateApplyDepartment"]!""}</td>
			<td class="formtable_td_key">申请日期：</td>
			<td class="formtable_td_value">${steps.vars["updateApplyDate"]!""}</td>
		</tr>
		<tr>
			<td class="formtable_td_key">设备名称：</td>
			<td class="formtable_td_value">${steps.vars["updateEquipmentName"]!""}</td>
			<td class="formtable_td_key">型号/规格：</td>
			<td class="formtable_td_value">${steps.vars["updateTypeOrStandard"]!""}</td>
		</tr>
		<tr>
			<td class="formtable_td_key">设备编号：</td>
			<td class="formtable_td_value">${steps.vars["updateEquipmentNo"]!""}</td>
			<td class="formtable_td_key">生产厂家:</td>
			<td class="formtable_td_value">${steps.vars["updateManufactureFactory"]!""}</td>
		</tr>
		<tr>
		  	  	<td class="formtable_td_key">所属类别</td>
		  	  		<td class="formtable_td_value">
			  	  		类别选择:<#if steps.vars["updateEquipmentType"]??> 
			  	  		<input type="checkbox"   disabled="disabled"   value="1"  <#if steps.vars["updateEquipmentType"]?contains("1")>checked</#if>/>设备类
		                <input type="checkbox"   disabled="disabled"   value="2"  <#if steps.vars["updateEquipmentType"]?contains("2")>checked</#if>/>仪表类
		                <input type="checkbox"   disabled="disabled"   value="3"  <#if steps.vars["updateEquipmentType"]?contains("3")>checked</#if>/>工具类
		                <input type="checkbox"   disabled="disabled"   value="4"  <#if steps.vars["updateEquipmentType"]?contains("4")>checked</#if>/>测架类
		                </#if>
		  	  		</td>
		  	  		<td class="formtable_td_key">工厂：</td>
					<td class="formtable_td_value">${steps.vars["updateFactoryName"]!""}</td>
		  	</tr>
		<tr>
			<td class="formtable_td_key">故障现象描述：</td>
			<td class="formtable_td_value" colspan="3">
			<textarea class="easyui-validatebox"   
					style="font-size: 12px; width: 800px; height: 50px;" readonly="readonly" disabled="disabled">${steps.vars["updateFaultDescribe"]!""}</textarea></td>
		</tr>
		<#if steps.vars["isOffGaffer"]=='1'>
		<tr>
			<td class="formtable_td_key">凭证类型：</td>
			<td class="formtable_td_value" colspan="3">
				<#if steps.vars["updateProofType"] == 'NB'>NB 标准采购申请</#if>
				<#if steps.vars["updateProofType"] == 'ZR01'>ZR01 总经办非生产物资采购申请</#if>
				<#if steps.vars["updateProofType"] == 'ZR02'>ZR02 工程部非生产物资采购申请</#if>
				<#if steps.vars["updateProofType"] == 'ZR03'>ZR03 物殊采购申请</#if>
				<#if steps.vars["updateProofType"] == 'ZR04 '>ZR04 金立非生产物资采购申请(测试部)</#if>
				<#if steps.vars["updateProofType"] == 'ZR05'>ZR05金立非生产物资采购申请(信息部)</#if>
			</td>
		</tr>
		<tr>
				  	<td colspan="4" class="formtable_td_key" align="center">设备维修物料清单</td>
				</tr>
				<tr>
				  	<td class="formtable_td_value" colspan="4">
				  	  	<div style="width:1350px;margin-top:2px;border:solid 1px #95B8E7;">
					  	  	<div style="border-top:solid 1px #666666;">
								<table class="gridtable">
									<thead>
										<tr>
											<td width="24" align="center">序号</td>
											<td width="30" align="center">科目分配</td>
											<td width="80" align="center">物料编码</td>
											<td width="90" align="center">物料名称及规格</td>
											<td width="60" align="center">申请数量</td>
											<td width="60" align="center">单位</td>
											<td width="80" align="center">总账科目</td>
											<td width="125" align="center">成本中心</td>
											<td width="60" align="center">预估单价</td>
											<td width="80" align="center">合计</td>
											<td width="125" align="center">交货日期</td>
											<td width="80" align="center">采购组</td>
											<td width="80" align="center">物料组</td>
											<td width="80" align="center">申请者</td>
											<td width="180" align="center">备注</td>
										</tr>
									</thead>
								</table>
							</div>
							<div style="height:auto;overflow-y:auto;border-top:solid 1px #666666;">
								<table class="gridtable" style="word-break:break-all; word-wrap:break-all;">
									<tbody>
										<#if steps.vars["updateMFixedAssetsDetraction"]??>
						   					<#assign text1>
												${(steps.vars["updateMFixedAssetsDetraction"])!""}
											</#assign>
											<#assign json=text1?eval />
											<#list json.accessoryData as item>
												<tr>
													<td width="24" align="center">${item.rowno}</td>
													<td width="30" align="top">${item.courseAllot}</td>
													<td width="80" align="top">${item.stockNumber}</td>
													<td width="90" align="top">${item.stockNameAndStandard}</td>
													<td width="60" align="top">${item.applyNumber}</td>
													<td width="60" align="top">${item.monad}</td>
													<td width="80" align="top">${item.reckoning}</td>
													<td width="125" align="top">${item.costCenter}</td>
													<td width="60" align="top">${item.unitPrice}</td>
													<td width="80" align="top">${item.amountInTotal}</td>
													<td width="125" align="top">${item.deliveryDate}</td>
													<td width="80" align="top">${item.procurementSection}</td>
													<td width="80" align="top">${item.itemGroup}</td>
													<td width="80" align="top">${item.applyName}</td>
													<td width="180" align="top">${item.remark}</td>
												</tr>
											</#list>
			   							</#if>
									</tbody>
								</table>
							</div>
						</div>	
				  	  </td>
				  	</tr>
				  </#if>
		<tr>
		<td class="formtable_td_key">申请人：</td>
		<td class="formtable_td_value" >
			${(steps.vars["updateApplyUserName"])!""}
		</td>
		<td class="formtable_td_key">日期：</td>
		<td class="formtable_td_value">
			${(steps.vars["updateApplyUserDate"])!""}
		</td>
	</tr>
	<#if steps.attachments??>
			<tr>
				<td class="formtable_td_key">附件：</td>
				<td class="formtable_td_value" colspan="3">
				<#list steps.attachments as attachs> 
				<a href="${attachs.url}">${attachs.name}_${attachs.revision}.0 </a><br /> </#list>
				</td>
			</tr>
		</#if>
		<style type="text/css">
						table.gridtable {
							font-family: verdana,arial,sans-serif;
							font-size:11px;
							color:#333333;
							border-width: 1px;
							border-color: #666666;
							border-collapse: collapse;
						}
						table.gridtable thead td {
							padding: 4px;
							border-top:solid 1px #666666;
							border-right:solid 1px #666666;
							border-left:solid 1px #666666;
						}
						table.gridtable tbody td {
							padding: 4px;
							border-width: 1px;
							border-style: solid;
							border-color: #666666;
						}
			</style>		
		</#if>

<!-- 部门经理审核 -->
<#if steps.key == 'departManagerAudiTask'>
		<tr>
			<td class="formtable_td_key" align="center" colspan="4" style="font-weight:bold;font-size:14px;">
			  	部门经理审核
			</td>
		</tr>
		<tr>
			<td class="formtable_td_key">部门经理：</td>
				<td class="formtable_td_value" >${(steps.vars["deptManagerName"])!""}</td>
			<td class="formtable_td_key">审核结果：</td>
				<td class="formtable_td_value" >
					<#if steps.vars["deptManagerAudi"] == '0' >同意</#if>
					<#if steps.vars["deptManagerAudi"] == '1' >不同意</#if>
				</td>
		</tr>
	<tr>
		<td class="formtable_td_key">处理意见：（包括维修价格、维修期限等，由处理单位填写）</td>
		<td class="formtable_td_value" colspan="3">
		<textarea class="easyui-validatebox"   
					style="font-size: 12px; width: 800px; height: 50px;" readonly="readonly" disabled="disabled">${(steps.vars["deptManagerAudiAdvice"])!""}</textarea>
		</td>
	</tr>
	<tr>
		<td class="formtable_td_key">备注：</td>
		<td class="formtable_td_value" colspan="3">
		<textarea class="easyui-validatebox"   
					style="font-size: 12px; width: 800px; height: 50px;" readonly="readonly" disabled="disabled">${(steps.vars["deptManagerRemark"])!""}</textarea>
		</td>
	</tr>
	<tr>
			<td class="formtable_td_key">审核时间：</td>
			<td class="formtable_td_value"  colspan="3">${(steps.vars["deptManagerAudiTime"])!""}</td>
		</tr>
	<#if steps.attachments??>
	<tr>
		<td class="formtable_td_key">附件：</td>
		<td class="formtable_td_value" colspan="3">
		<#list steps.attachments as attachs> 
		<a href="${attachs.url}">${attachs.name}_${attachs.revision}.0 </a><br /> </#list>
		</td>
	</tr>
	</#if>
</#if> 

<!-- 采购员 -->
<#if steps.key == 'logisticProcurementAudiTask'>
	<#assign rows=steps.vars["isOffRowCount"]/>
		<tr>
			<td class="formtable_td_key" align="center" colspan="4" style="font-weight:bold;font-size:14px;">
			  	后勤采购员审核
			</td>
		</tr>
		<tr>
			<td class="formtable_td_key">凭证类型：</td>
			<td class="formtable_td_value" colspan="3">
				<#if steps.vars["proofType"] == 'NB'>NB 标准采购申请</#if>
				<#if steps.vars["proofType"] == 'ZR01'>ZR01 总经办非生产物资采购申请</#if>
				<#if steps.vars["proofType"] == 'ZR02'>ZR02 工程部非生产物资采购申请</#if>
				<#if steps.vars["proofType"] == 'ZR03'>ZR03 物殊采购申请</#if>
				<#if steps.vars["proofType"] == 'ZR04 '>ZR04 金立非生产物资采购申请(测试部)</#if>
				<#if steps.vars["proofType"] == 'ZR05'>ZR05金立非生产物资采购申请(信息部)</#if>
			</td>
		</tr>
		<tr>
				  	<td colspan="4" class="formtable_td_key" align="center">设备维修物料清单</td>
				</tr>
				<tr>
				  	<td class="formtable_td_value" colspan="4">
				  	  	<div style="width:1350px;margin-top:2px;border:solid 1px #95B8E7;">
					  	  	<div style="border-top:solid 1px #666666;">
								<table class="gridtable">
									<thead>
										<tr>
											<td width="24" align="center">序号</td>
											<td width="30" align="center">科目分配</td>
											<td width="80" align="center">物料编码</td>
											<td width="90" align="center">物料名称及规格</td>
											<td width="60" align="center">申请数量</td>
											<td width="60" align="center">单位</td>
											<td width="80" align="center">总账科目</td>
											<td width="125" align="center">成本中心</td>
											<td width="60" align="center">预估单价</td>
											<td width="80" align="center">合计</td>
											<td width="125" align="center">交货日期</td>
											<td width="80" align="center">采购组</td>
											<td width="80" align="center">物料组</td>
											<td width="80" align="center">申请者</td>
											<td width="180" align="center">备注</td>
										</tr>
									</thead>
								</table>
							</div>
							<div style="height:auto;overflow-y:auto;border-top:solid 1px #666666;">
								<table class="gridtable" style="word-break:break-all; word-wrap:break-all;">
									<tbody>
									<#if steps.vars["scrapWay"]=='1'>
										<#if steps.vars["MFixedAssetsDetraction"]??>
						   					<#assign text1>
												${(steps.vars["MFixedAssetsDetraction"])!""}
											</#assign>
											<#assign json=text1?eval />
											<#list json.accessoryData as item>
												<tr>
													<td width="24" align="center">${item.rowno}</td>
													<td width="30" align="top">${item.courseAllot}</td>
													<td width="80" align="top">${item.stockNumber}</td>
													<td width="90" align="top">${item.stockNameAndStandard}</td>
													<td width="60" align="top">${item.applyNumber}</td>
													<td width="60" align="top">${item.monad}</td>
													<td width="80" align="top">${item.reckoning}</td>
													<td width="125" align="top">${item.costCenter}</td>
													<td width="60" align="top">${item.unitPrice}</td>
													<td width="80" align="top">${item.amountInTotal}</td>
													<td width="125" align="top">${item.deliveryDate}</td>
													<td width="80" align="top">${item.procurementSection}</td>
													<td width="80" align="top">${item.itemGroup}</td>
													<td width="80" align="top">${item.applyName}</td>
													<td width="180" align="top">${item.remark}</td>
												</tr>
											</#list>
			   							</#if>
			   							</#if>
			   							<#if steps.vars["scrapWay"]=='2'>
										<#if steps.vars["scrapWay2JsonStr"]??>
						   					<#assign text1>
												${(steps.vars["scrapWay2JsonStr"])!""}
											</#assign>
											<#assign json=text1?eval />
											<#list json.accessoryData as item>
												<tr>
													<td width="24" align="center">${item.rowno}</td>
													<td width="30" align="top">${item.courseAllot}</td>
													<td width="80" align="top">${item.stockNumber}</td>
													<td width="90" align="top">${item.stockNameAndStandard}</td>
													<td width="60" align="top">${item.applyNumber}</td>
													<td width="60" align="top">${item.monad}</td>
													<td width="80" align="top">${item.reckoning}</td>
													<td width="125" align="top">${item.costCenter}</td>
													<td width="60" align="top">${item.unitPrice}</td>
													<td width="80" align="top">${item.amountInTotal}</td>
													<td width="125" align="top">${item.deliveryDate}</td>
													<td width="80" align="top">${item.procurementSection}</td>
													<td width="80" align="top">${item.itemGroup}</td>
													<td width="80" align="top">${item.applyName}</td>
													<td width="180" align="top">${item.remark}</td>
												</tr>
											</#list>
			   							</#if>
			   							</#if>
									</tbody>
								</table>
							</div>
						</div>	
				  	  </td>
				  	</tr>
	<tr>
		<td class="formtable_td_key">后勤采购员：</td>
			<td class="formtable_td_value">${(steps.vars["logisticProcurementName"])!""}</td>
		<td class="formtable_td_key">审核结果：</td>
			<td class="formtable_td_value">
				<#if steps.vars["logisticProcurementAudi"] == '0' >同意</#if>
				<#if steps.vars["logisticProcurementAudi"] == '1' >不同意</#if>
			</td>
	</tr>
	<tr>
		<td class="formtable_td_key">处理意见：（包括维修价格、维修期限等，由处理单位填写）</td>
		<td class="formtable_td_value" colspan="3">
		<textarea class="easyui-validatebox"   
					style="font-size: 12px; width: 800px; height: 50px;" readonly="readonly" disabled="disabled">${(steps.vars["logisticProcurementAudiAdvice"])!""}</textarea>
		</td>
	</tr>
	<tr>
		<td class="formtable_td_key">备注：</td>
		<td class="formtable_td_value" colspan="3">
		<textarea class="easyui-validatebox"   
					style="font-size: 12px; width: 800px; height: 50px;" readonly="readonly" disabled="disabled">${(steps.vars["logisticProcurementRemark"])!""}</textarea>
		</td>
	</tr>
	<tr>
		<td class="formtable_td_key">审核时间：</td>
		<td class="formtable_td_value"  colspan="3">${(steps.vars["logisticProcurementAudiTime"])!""}</td>
	</tr>
	<#if steps.attachments??>
	<tr>
		<td class="formtable_td_key">附件：</td>
		<td class="formtable_td_value" colspan="3">
		<#list steps.attachments as attachs> 
		<a href="${attachs.url}">${attachs.name}_${attachs.revision}.0 </a><br /> </#list>
		</td>
	</tr>
	</#if>
	<style type="text/css">
						table.gridtable {
							font-family: verdana,arial,sans-serif;
							font-size:11px;
							color:#333333;
							border-width: 1px;
							border-color: #666666;
							border-collapse: collapse;
						}
						table.gridtable thead td {
							padding: 4px;
							border-top:solid 1px #666666;
							border-right:solid 1px #666666;
							border-left:solid 1px #666666;
						}
						table.gridtable tbody td {
							padding: 4px;
							border-width: 1px;
							border-style: solid;
							border-color: #666666;
						}
			</style>	
</#if>

<!-- 后勤部经理 -->
<#if steps.key == 'logisticManagerAuditTask'>
	<#assign processId=steps.vars["proInstId"]/>
	<tr>
			<td class="formtable_td_key" align="center" colspan="4" style="font-weight:bold;font-size:14px;">
			  	后勤部经理审核
			</td>
		</tr>
	<tr>
		<td class="formtable_td_key">后勤部经理：</td>
			<td class="formtable_td_value">${(steps.vars["logisticManagerName"])!""}</td>
		<td class="formtable_td_key">审核结果：</td>
		<td class="formtable_td_value">
			<#if steps.vars["logisticManagerAudi"] == '0' >同意</#if>
			<#if steps.vars["logisticManagerAudi"] == '1' >不同意</#if>
		</td>
	</tr>
	<tr>
		<td class="formtable_td_key">处理意见：（包括维修价格、维修期限等，由处理单位填写）</td>
		<td class="formtable_td_value" colspan="3">
		<textarea class="easyui-validatebox"   
					style="font-size: 12px; width: 800px; height: 50px;" readonly="readonly" disabled="disabled">${(steps.vars["logisticManagerAudiAdvice"])!""}</textarea>
		</td>
	</tr>
	<tr>
		<td class="formtable_td_key">备注：</td>
		<td class="formtable_td_value" colspan="3">
		<textarea class="easyui-validatebox"   
					style="font-size: 12px; width: 800px; height: 50px;" readonly="readonly" disabled="disabled">${(steps.vars["logisticManagerRemark"])!""}</textarea>
		</td>
	</tr>
	<#if rows=='0' || rows==''>
	<#else>
		<tr>
			<td class="formtable_td_key">凭证编号：</td>
			<td class="formtable_td_value proofNo${rand}" colspan="3"></td>
		</tr>
	</#if>
	<tr>
		<td class="formtable_td_key">审核时间：</td>
		<td class="formtable_td_value"  colspan="3">${(steps.vars["logisticManagerAudiTime"])!""}</td>
	</tr>
	<#if steps.attachments??>
	<tr>
		<td class="formtable_td_key">附件：</td>
		<td class="formtable_td_value" colspan="3">
		<#list steps.attachments as attachs> 
		<a href="${attachs.url}">${attachs.name}_${attachs.revision}.0 </a><br /> </#list>
		</td>
	</tr>
	</#if>
	<script type="text/javascript">
		$(function(){
			$.get("workspace/getNoProducProofNo.json",{
				processId:'${processId}'
			},function(data){
				$(".proofNo${rand}").text(data);
			});
		});
	</script>	
</#if>

<!--<#if steps.key == 'applyGetProofNoTask'>
	<tr>
			<td class="formtable_td_key" align="center" colspan="6" style="font-weight:bold;font-size:14px;">
			  	申请人查看凭证编号
			</td>
		</tr>
	<tr>
		<td class="formtable_td_key">凭证编号：</td>
		<td class="formtable_td_value" colspan="5">
		${(steps.vars["proofNo"])!""}
		</td>
	</tr>
	<tr>
		<td class="formtable_td_key">查看人：</td>
			<td class="formtable_td_value" colspan="2">${(steps.vars["getProofNoName"])!""}</td>
		<td class="formtable_td_key">查看时间：</td>
		<td class="formtable_td_value"  colspan="2">${(steps.vars["getProofNoTime"])!""}</td>
	</tr>
	<#if steps.attachments??>
	<tr>
		<td class="formtable_td_key">附件：</td>
		<td class="formtable_td_value" colspan="5">
		<#list steps.attachments as attachs> 
		<a href="${attachs.url}">${attachs.name}_${attachs.revision}.0 </a><br /> </#list>
		</td>
	</tr>
	</#if>
</#if>-->

<!-- 总经理-->
<!--<#if steps.key == 'generalManagerAuditTask'>
	<tr>
			<td class="formtable_td_key" align="center" colspan="4" style="font-weight:bold;font-size:14px;">
			  	总经理审核
			</td>
		</tr>
	<tr>
		<td class="formtable_td_key">总经理：</td>
			<td class="formtable_td_value">${(steps.vars["generalManagerName"])!""}</td>
		<td class="formtable_td_key">审核结果：</td>
		<td class="formtable_td_value">
			<#if steps.vars["generalManagerAudi"] == '0' >同意</#if>
			<#if steps.vars["generalManagerAudi"] == '1' >不同意</#if>
		</td>
	</tr>
	<tr>
		<td class="formtable_td_key">审核时间：</td>
		<td class="formtable_td_value"  colspan="3">${(steps.vars["generalManagerAudiTime"])!""}</td>
	</tr>
	<tr>
		<td class="formtable_td_key">处理意见：（包括维修价格、维修期限等，由处理单位填写）</td>
		<td class="formtable_td_value" colspan="3">
		<textarea class="easyui-validatebox"   
					style="font-size: 12px; width: 800px; height: 50px;" readonly="readonly" disabled="disabled">${(steps.vars["generalManagerAudiAdvice"])!""}</textarea>
		</td>
	</tr>
	<tr>
		<td class="formtable_td_key">备注：</td>
		<td class="formtable_td_value" colspan="3">
		<textarea class="easyui-validatebox"   
					style="font-size: 12px; width: 800px; height: 50px;" readonly="readonly" disabled="disabled">${(steps.vars["generalManagerRemark"])!""}</textarea>
		</td>
	</tr>
	<#if steps.attachments??>
	<tr>
		<td class="formtable_td_key">附件：</td>
		<td class="formtable_td_value" colspan="3">
		<#list steps.attachments as attachs> 
		<a href="${attachs.url}">${attachs.name}_${attachs.revision}.0 </a><br /> </#list>
		</td>
	</tr>
	</#if>
</#if>-->

<!-- SAP录入员 -->
<!--<#if steps.key == 'keyboarderVerifyTask'>
		<tr>
			<td class="formtable_td_key">处理意见：（包括维修价格、维修期限等，由处理单位填写）</td>
			<td class="formtable_td_value" colspan="3">
			<textarea class="easyui-validatebox"   
					style="font-size: 12px; width: 800px; height: 50px;" readonly="readonly" disabled="disabled">${(steps.vars["keyboarderAudidvice"])!""}</textarea>
			</td>
		</tr>
		<tr>
			<td class="formtable_td_key">SAp录入员:</td>
			<td class="formtable_td_value">${(steps.vars["keyboarderName"])!""}</td>
			<td class="formtable_td_key">处理时间：</td>
			<td class="formtable_td_value">${(steps.vars["keyboarderAudiTime"])!""}</td>
		</tr>
		<tr>
			<td class="formtable_td_key">备注：</td>
			<td class="formtable_td_value" colspan="3">
			<textarea class="easyui-validatebox"   
					style="font-size: 12px; width: 800px; height: 50px;" readonly="readonly" disabled="disabled">${(steps.vars["keyboarderRemark"])!""}</textarea>
			</td>
		</tr>
		<#if steps.attachments??>
		<tr>
			<td class="formtable_td_key">附件：</td>
			<td class="formtable_td_value" colspan="3">
			<#list steps.attachments as attachs> 
			<a href="${attachs.url}">${attachs.name}_${attachs.revision}.0 </a><br /> </#list>
			</td>
		</tr>
	</#if>
</#if>-->

</#list> 
</table>
</#if>

<!-- 表单开始 -->
<#if currentStep?exists>
	<#if currentStep == 'startevent1'>
		<div id="start">
			<form id="startForm" method="post" enctype='multipart/form-data'>
		  	  <table id="startFormTable" class="formtable" cellspacing="1" cellpadding="0">
		  	  	<tr>
		  	  	<td class="formtable_td_key">申请部门：</td>
					<td class="formtable_td_value" >
						  <input id="applyDepartment${rand}" style="width:180px;" class='easyui-validatebox' data-options="required:true" type="text" name="fp_applyDepartment" value="${appuser.orgName}"/>
					</td>
		  	  		<td class="formtable_td_key">申请日期：</td>
		  	  		<td class="formtable_td_value" >
		  	  			<input type="text" class="easyui-my97" style="width:165px;" name="fp_applyDate" id="applyDate${rand}" data-options="width:120,required:true,disabled:false,minDate:'%y-%M-{%d}',validType:'reqdate' "/>
		  	  		</td>
		  	  	</tr>
		  	  	<tr>
					<td class="formtable_td_key">设备名称：</td>
			  	  		<td class="formtable_td_value" >
			  	  			<input id="equipmentName${rand}" style="width:180px;"  type="text"  class="easyui-validatebox textbox"  data-options="required:true"   name="fp_equipmentName"/>
			  	  		</td>
		  	  		<td class="formtable_td_key">型号/规格：</td>
			  	  		<td class="formtable_td_value">
			  	  			<input id="typeOrStandard${rand}" style="width:180px;" type="text"  class="easyui-validatebox textbox"  data-options="required:true"   name="fp_typeOrStandard"/>
			  	  		</td>
		  	  	</tr>
		  	  	<tr>
		  	  		<td class="formtable_td_key">设备编号：</td>
		  	  		<td class="formtable_td_value">
		  	  			<input id="equipmentNo${rand}" style="width:180px;" type="text"  class="easyui-validatebox textbox"  data-options="required:true"   name="fp_equipmentNo"/>
		  	  		</td>
		  	  		<td class="formtable_td_key" >生产厂家:</td>
		  	  		<td class="formtable_td_value">
		  	  			<input id="manufactureFactory${rand}" style="width:180px;" class="easyui-validatebox textbox" name="fp_manufactureFactory" type="text" />
		  	  		</td>
		  	  	</tr>
		  	  	<tr>
					<td class="formtable_td_key">所属类别：</td>
					<td class="formtable_td_value">
						<input type="checkbox"   name="fp_equipmentType" value="1" />设备类
	                    <input type="checkbox"   name="fp_equipmentType" value="2"/>仪表类
	                    <input type="checkbox"   name="fp_equipmentType" value="3"/>工具类
	                    <input type="checkbox"   name="fp_equipmentType" value="4"/>测架类
	                    <font color="red"> (至少勾选一个) </font>
	                    <input id="moduleName${rand}" name="fp_moduleName" class="easyui-validatebox" data-options="required:true" missingMessage="至少勾选一个" style="padding:0px;margin:0px;width:0px;height:0px;border-width:0px;" />
					</td>
					<td class="formtable_td_key">工厂：</td>
					<td class="formtable_td_value">
						<input id="factory${rand}" class="easyui-combobox" style="width:180px;" type="text"  name="fp_factory" data-options="required:true,valueField: 'value',textField: 'text',
									data:[{text:'',value:''},
										{text:'东莞市金铭电子有限公司',value:'2000'},
										{text:'东莞金卓通信科技有限公司',value:'3000'}] " 
										/>
						<input type="hidden" id="factoryName${rand}" name="fp_factoryName"/>
					</td>
				</tr>
				<tr>
					<td class="formtable_td_key" >故障现象描述:</td>
		  	  		<td class="formtable_td_value" colspan="3">
		  	  			<textarea
							 name="fp_faultDescribe" class="easyui-validatebox"   
							style="font-size: 12px; width: 800px; height: 50px;" data-options="required:true"></textarea>
		  	  		</td>
				</tr>
				<tr class="gaffter">
					<td class="formtable_td_key">凭证类型：</td>
					<td class="formtable_td_value" colspan="3">
						 <select id="proofType${rand}" name="fp_proofType" style="width:180px;">
						 	<option value='ZR01'>ZR01 总经办非生产物资采购申请</option>
						  	<option value='NB'>NB 标准采购申请</option>
						  	<option value='ZR02'>ZR02 工程部非生产物资采购申请</option>
						  	<option value='ZR03'>ZR03 物殊采购申请</option>
						  	<option value='ZR04'>ZR04 金立非生产物资采购申请(测试部)</option>
						  	<option value='ZR05'>ZR05金立非生产物资采购申请(信息部)</option>
						 </select>
					</td>
				</tr>
				<tr class="gaffter">
		  	  		<td class="formtable_td_key">选择申请方式：</td>
		  	  		<td class="formtable_td_value" colspan="3">
		  	  			<input type="radio" name="fp_scrapWay" value="1" checked/>少量申请
		  	  			<input type="radio" name="fp_scrapWay" value="2"/>批量申请
		  	  		</td>
		  	  	</tr>
				<tr class="gaffter">
				  	<td colspan="4" class="formtable_td_key" align="center">设备维修物料清单</td>
				</tr>
				<tr class="gaffter scrapWay1">
				  	<td class="formtable_td_value" colspan="4">
				  		<div>
				  	  		<a class="easyui-linkbutton l-btn" onclick="addAccessory()">
	    						<span class="l-btn-text icon-add l-btn-icon-left">新增</span>
	    					</a>
	    					<a class="easyui-linkbutton l-btn" onclick="removeAccessory()">
	    						<span class="l-btn-text icon-remove l-btn-icon-left">删除</span>
	    						<input type="hidden" id="AccessoriesJsonStr${rand}" name="fp_MFixedAssetsDetraction"/>
	    					</a>
				  	  	</div>
				  	  	<div style="width:1465px;margin-top:2px;border:solid 1px #95B8E7;">
					  	  	<div style="border-top:solid 1px #666666;">
								<table class="gridtable">
									<thead>
										<tr>
											<td width="1" align="center"><input type="checkbox" class="thchk" /></td>
											<td width="24" align="center">序号</td>
											<td width="45" align="center">科目分配</td>
											<td width="80" align="center">物料编码</td>
											<td width="150" align="center">物料名称及规格</td>
											<td width="60" align="center">申请数量</td>
											<td width="60" align="center">单位</td>
											<!--<td width="125" align="center">工厂</td>-->
											<td width="80" align="center">总账科目</td>
											<td width="125" align="center">成本中心</td>
											<td width="60" align="center">预估单价</td>
											<td width="80" align="center">合计</td>
											<td width="125" align="center">交货日期</td>
											<td width="50" align="center">采购组</td>
											<td width="100" align="center">物料组</td>
											<td width="80" align="center">申请者</td>
											<td width="180" align="center">备注</td>
										</tr>
									</thead>
								</table>
							</div>
							<div style="height:auto;overflow-y:auto;border-top:solid 1px #666666;">
								<table id="accessoryInfoTb${rand}" class="gridtable" style="word-break:break-all; word-wrap:break-all;">
									<tbody>
									</tbody>
								</table>
							</div>
						</div>	
				  	  </td>
				  	</tr>
				  	<tr class="gaffter scrapWay2">
					<td class="formtable_td_value" colspan="4">
						<input id="partAccount" type="hidden" name="fp_partList" /> 
						<!--<input id="participantList_val" type="hidden" name="fp_participantList" />--> 
						<input id="scrapWay2JsonStr${rand}" type="hidden" name="fp_scrapWay2JsonStr" />
						<a id="openImportPersonBtn-${rand}" href="javascript:void(0);" class="easyui-linkbutton" 
								data-options="iconCls:'icon-upload'">导入设备维修物料清单</a>
						<a id="downloadTravelExcel${rand}" href="javascript:void(0);" class="easyui-linkbutton" 
								data-options="iconCls:'icon-down_load'">下载EXCEL电子模板</a>
						<div id="participantList" style="font-size: 12px; ">
							<table id="participantListTb${rand}" class="gridtable" style="word-break:break-all; word-wrap:break-all;">
								<tbody>
								</tbody>
							</table>
						</div>
					</td>
				 	</tr>
				<tr>		  	
		  	  		<td class="formtable_td_key">申请人签字：</td>
		  	  		<td class="formtable_td_value">
		  	  			<input id="curEmpLoginId${rand}" type="hidden" name="fp_curLoginNo" value="${appuser.account}"/>
		  	  			<input id="curAccount${rand}" name="fp_applyEmpId" type="hidden"/>
		  	  			<input id="isOffGaffer${rand}" name="fp_isOffGaffer" type="hidden"/>
		  	  			<input id="isOffRowCount${rand}" name="fp_isOffRowCount" type="hidden" value="0"/>
		  	  			<input id="applyEmpName" class="easyui-validatebox textbox"  name="fp_applyName" type="hidden" value="${appuser.name}"/>${appuser.name}
		  	  		</td>
		  	  		<td class="formtable_td_key">日期：</td>
		  	  		<td class="formtable_td_value">${.now?string('yyyy-MM-dd HH:mm:ss')}
		  	  			<input   name="fp_applyEmpDate" type="hidden" value="${.now?string('yyyy-MM-dd HH:mm:ss')}"/>
		  	  			<input id="processName${rand}" type="hidden" name="fp_processName" readonly="readonly" style="width:180px"/>
		  	  		</td>
		  	  	</tr>
		  	  </table>
			</form>
		</div>
		
		<div id="importWin-${rand}" class="easyui-dialog"
		data-options="modal:true, title:'导入非生产物资清单',closed:true,cache:false,iconCls:'icon-process',width:600,height:100,onClose:clearInputFile${rand}">
		<div  style="padding:10px 10px;">
		<form id="upform-${rand}" method="post" enctype="multipart/form-data">
			<table>
				<tr>
					<td width="120" align="center">上传文件:</td>
					<td id="td_input_${rand}"><input id="upload_file-${rand}" class="easyui-validatebox" data-options="required:true" type="file" name="files" style="width:300px;"/></td>
					<td>
						<a id="upfile-${rand}" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search">上传</a>
					</td>
				</tr>
			</table>
		</form>
		</div>
	</div>
		<style type="text/css">
				table.gridtable {
					font-family: verdana,arial,sans-serif;
					font-size:11px;
					color:#333333;
					border-width: 1px;
					border-color: #666666;
					border-collapse: collapse;
				}
				table.gridtable thead td {
					padding: 4px;
					border-top:solid 1px #666666;
					border-right:solid 1px #666666;
					border-left:solid 1px #666666;
				}
				table.gridtable tbody td {
					padding: 4px;
					border-width: 1px;
					border-style: solid;
					border-color: #666666;
				}
			</style>
	<script type="text/javascript">
		$(function(){
			$('#processName${rand}').val(
					"[" + "${appuser.account}" + ","
							+ "${appuser.name}" + "]设备维修申请");//流程实例名称
			
			$.post("hrFlow/getHrUserInfo.json",{
				account:$("#curEmpLoginId${rand}").val()
			},function(data){
				if(data.success){
					var accounts='00000000'+data.obj.empId;
					$("#curAccount${rand}").val(accounts.substring(accounts.length-8,accounts.length));
					if(data.obj.job.indexOf('电工领班')>0){
						$("#isOffGaffer${rand}").val('1');
						$(".gaffter").show();
						
						$(".scrapWay2").hide();
						$(":radio[name='fp_scrapWay']").click(function(){
							var scrapWay=$('input[name="fp_scrapWay"]:checked').val();
							if(scrapWay=='1'){
								$(".scrapWay1").show();
								$("#participantListTb${rand} tbody").html('');
								$("#scrapWay2JsonStr${rand}").val('');
								$(".scrapWay2").hide();
							}else{
								$(".scrapWay2").show();
								$("#accessoryInfoTb${rand} tbody").html('');
								$("#AccessoriesJsonStr${rand}").val('');
								$(".scrapWay1").hide();
							}
						});
					}else{
						$("#isOffGaffer${rand}").val('0');
						$(".gaffter").hide();
					}
				}
			});
			
			$("input[name='fp_equipmentType']").bind("click",function(){
	        	document.getElementById("moduleName${rand}").value = "";
	        	var str="";
	        	  $("input[name='fp_equipmentType']").each(function(){ 
		                if($(this).prop("checked")){
		                    str += $(this).val()+",";
		                    document.getElementById("moduleName${rand}").value = str;
		                }
		            })
	        });
			
			$('.thchk').each(function(){ 
				$(this).click(function(){ 
					if($(this).prop('checked')){
						$('.tdchk').prop("checked", true);
					} else {
						$('.tdchk').prop("checked", false);
					} 	
				});
			});
		});
		
		$("#factory${rand}").combobox({
			onChange:function(n,o){
				if(n=='2000'){
					$("#factoryName${rand}").val('东莞市金铭电子有限公司');
				}
				if(n=='3000'){
					$("#factoryName${rand}").val('东莞金卓通信科技有限公司');
				}
				if(n!=''){
					var scrapWay=$('input[name="fp_scrapWay"]:checked').val();
					if(scrapWay=='1'){
						var rowno=1;
						$('#accessoryInfoTb${rand} tbody tr').each(function () {
							var courseAllot = $.trim($(this).find('td').eq(2).find("select").val());
							var stockNumber = $.trim($(this).find('td').eq(3).find("input").val());
			    			var stockNameAndStandard = $(this).find('td').eq(4).find("input");
			    			var monad = $(this).find('td').eq(6).find("input");
			    			var reckoning = $(this).find('td').eq(7).find("input");
			    			var costCenter = $(this).find('td').eq(8).find("input");
			    			var procurementSection = $(this).find('td').eq(12).find("input");
			    			var itemGroup=$(this).find('td').eq(13);
			    			
			    			$.get('hrFlow/getSapCostCenter.json', {
								factory:n
							}, function(data) {
								costCenter.val('');
								costCenter.combobox('loadData', data);
							}, 'json');
			    			
			    			if(stockNumber!=null&&stockNumber!=''){
			    				//根据工厂、物料编号获取非生产物资数据
								$.get("hrFlow/getStockInfo.json",{
									functionName:'ZHR_OA46',vars:'I_MATNR_VALUE_'+stockNumber+'_NEXT_I_WERKS_VALUE_'+n,exportTableName:'E_MATNR',
									exportlist:'MAKTX_NEXT_MEINS_NEXT_EKGRP_NEXT_MATKL'
								},function(data){
									var jsondata=eval("("+data+")");
									if(jsondata.MAKTX=='' && jsondata.MEINS=='' && jsondata.EKGRP=='' && jsondata.MATKL==''){
										$.messager.alert("提示信息","您好，此编号的非生产物资不存在!");
										$("#stock"+rowno+"${rand}").val('');
									}
									stockNameAndStandard.val(jsondata.MAKTX);
									monad.val(jsondata.MEINS);
									procurementSection.val(jsondata.EKGRP);
									//if(courseAllot=='K'){
										if(jsondata.MATKL=='7001'||jsondata.MATKL=='7010'){
											reckoning.val('6598000059');
										}else if(jsondata.MATKL=='7011'||jsondata.MATKL=='7014'){
											reckoning.val('6598000022');
										}else if(jsondata.MATKL=='7509'){
											reckoning.val('6598000086');
										}else if(jsondata.MATKL=='7510'){
											reckoning.val('6598000087');
										}else if(jsondata.MATKL=='7511'){
											reckoning.val('6598000088');
										}else{
											reckoning.val('6598000033');
										}
									if(courseAllot=='K'){
										itemGroup.html('<input id="itemGroup'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+jsondata.MATKL+'" onblur="makeAccessory();"/>')
									}else{
										itemGroup.find("input").val(jsondata.MATKL);
									}
									makeAccessory();
								});
			    			}
							rowno++;
						});
					}
					if(scrapWay=='2'){
						var count=0;
						$('#participantListTb${rand} tbody tr').each(function () {
							if(count>0){
								var courseAllot = $.trim($(this).find('td').eq(1).find("select").val());
								var stockNumber = $.trim($(this).find('td').eq(2).find("input").val());
				    			var stockNameAndStandard = $(this).find('td').eq(3).find("input");
				    			var monad = $(this).find('td').eq(5).find("input");
				    			var reckoning = $(this).find('td').eq(6).find("input");
				    			var costCenter = $(this).find('td').eq(7).find("input");
				    			var procurementSection = $(this).find('td').eq(11).find("input");
				    			var itemGroup=$(this).find('td').eq(12);
				    			
				    			$.get('hrFlow/getSapCostCenter.json', {
									factory:n
								}, function(data) {
									costCenter.val('');
									costCenter.combobox('loadData', data);
								}, 'json');
				    			
				    			if(stockNumber!=null&&stockNumber!=''){
				    				//根据工厂、物料编号获取非生产物资数据
									$.get("hrFlow/getStockInfo.json",{
										functionName:'ZHR_OA46',vars:'I_MATNR_VALUE_'+stockNumber+'_NEXT_I_WERKS_VALUE_'+n,exportTableName:'E_MATNR',
										exportlist:'MAKTX_NEXT_MEINS_NEXT_EKGRP_NEXT_MATKL'
									},function(data){
										var jsondata=eval("("+data+")");
										if(jsondata.MAKTX=='' && jsondata.MEINS=='' && jsondata.EKGRP=='' && jsondata.MATKL==''){
											$.messager.alert("提示信息","您好，此编号的非生产物资不存在!");
											$("#stock"+rowno+"${rand}").val('');
										}
										stockNameAndStandard.val(jsondata.MAKTX);
										monad.val(jsondata.MEINS);
										procurementSection.val(jsondata.EKGRP);
										//if(courseAllot=='K'){
											if(jsondata.MATKL=='7001'||jsondata.MATKL=='7010'){
												reckoning.val('6598000059');
											}else if(jsondata.MATKL=='7011'||jsondata.MATKL=='7014'){
												reckoning.val('6598000022');
											}else if(jsondata.MATKL=='7509'){
												reckoning.val('6598000086');
											}else if(jsondata.MATKL=='7510'){
												reckoning.val('6598000087');
											}else if(jsondata.MATKL=='7511'){
												reckoning.val('6598000088');
											}else{
												reckoning.val('6598000033');
											}
										if(courseAllot=='K'){
											itemGroup.html('<input id="itemGroup'+count+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+jsondata.MATKL+'" onblur="makeAccessory();"/>')
										}else{
											itemGroup.find("input").val(jsondata.MATKL);
										}
										makeImportInf();
									});
				    			}
			    			}
				    		count++;
						});
					}
				}
			}
		});
		
		function addAccessory() {
			var rows = $('#accessoryInfoTb${rand} tbody tr'); 
			var rowno = rows.length + 1;
			var str = '<tr>';
			str += '<td width="1"><input type="checkbox" class="tdchk" /></td>';
			str += '<td width="24" align="center">' + rowno + '</td>';
			str += '<td width="45"><select id="courseAllot'+rowno+'${rand}" style="width:40px;border:solid 1px #007ACC;" onchange="showRequire('+rowno+')"><option value=""></option><option value="K" selected="selected">K</option></select></td>';
			str += '<td width="80"><input id="stock'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:75px;border:solid 1px #007ACC;" onblur="getStockInfo('+rowno+');"/></td>';
			str += '<td width="150"><input id="stockNameAndStandard'+rowno+'${rand}" type="text" class="easyui-validatebox" data-options="required:true" style="width:145px;border:solid 1px #007ACC;" onblur="makeAccessory()"/></td>';
			str +='<td width="60"><input type="text" class="easyui-numberbox" data-options="required:true" style="width:55px;border:solid 1px #007ACC;" onblur="getAcountIntTotal('+rowno+');"/></td>';
			str +='<td width="60"><input id="monad'+rowno+'${rand}" type="text" class="easyui-validatebox" data-options="required:true" style="width:55px;border:solid 1px #007ACC;" onblur="makeAccessory()"/></td>';
			//str +='<td width="125"><input id="factory'+rowno+'${rand}" type="text" class="easyui-combobox" data-options="required:true" style="width:120px;border:solid 1px #007ACC;"/></td>';
			str +='<td width="80"><input id="reckoning'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:75px;border:solid 1px #007ACC;" value="6598000059" onblur="makeAccessory()"/></td>';
			str +='<td width="125"><input id="costCenter'+rowno+'${rand}" type="text" class="easyui-combobox" style="width:120px;border:solid 1px #007ACC;"/></td>';
			str +='<td width="60"><input id="unitPrice'+rowno+'${rand}" type="text" class="easyui-numberbox" data-options="required:true" style="width:55px;border:solid 1px #007ACC;" onchange="getAcountIntTotal('+rowno+');"/></td>';
			str +='<td width="80"><input id="totalAmount'+rowno+'${rand}" type="text" class="easyui-numberbox" style="width:75px;border:solid 1px #007ACC;" readonly/></td>';
			str +='<td width="125"><input type="text" class="easyui-my97" data-options="width:100,required:true,disabled:false,minDate:\'%y-%M-{%d}\',validType:\'reqdate\' " style="width:100px;border:solid 1px #007ACC;" onblur="makeAccessory()"/></td>';
			str +='<td width="50"><input id="procurementSection'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:45px;border:solid 1px #007ACC;" value="006" onblur="makeAccessory();"/></td>';
			str +='<td width="100"><select id="itemGroup'+rowno+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getRecoking('+rowno+');">'
				+'<option value="7001">7001-消防类</option>'
				+'<option value="7002">7002-安全系统类</option>'
				+'<option value="7004">7004-电工维修工具类</option>'
				+'<option value="7005">7005-办公设施类</option>'
				+'<option value="7006">7006-办公用品类</option>'
				+'<option value="7007">7007-生活辅助类</option>'
				+'<option value="7008">7008-安装制作维修类</option>'
				+'<option value="7010" selected="selected">7010-设备维修类</option>'
				+'<option value="7011">7011-手机充值卡类</option>'
				+'<option value="7012">7012-手机测试卡类</option>'
				+'<option value="7014">7014-培训物资类</option>'
				+' </select></td>';
			str +='<td width="80"><input type="text" class="easyui-validatebox" data-options="required:true" style="width:75px;border:solid 1px #007ACC;" onblur="makeAccessory()"/></td>';
			str +='<td width="180"><input type="text" class="easyui-validatebox" style="width:175px;border:solid 1px #007ACC;" onblur="makeAccessory()"/></td>';
			str += '</tr>';
	    	$('#accessoryInfoTb${rand} tbody').append(str);
	    	$.parser.parse($('#accessoryInfoTb${rand}').find("tr").eq(-1));
	    	$("#isOffRowCount${rand}").val(rowno);
	    	
	    	$("#unitPrice"+rowno+"${rand}").numberbox({
			    precision:3
			});
	    	
	    	$("#totalAmount"+rowno+"${rand}").numberbox({
			    precision:3
			});
	    	
	    	var costCenter=$("#costCenter"+rowno+"${rand}");
	    	
	    	costCenter.combobox({
				valueField : 'id',
				textField : 'text',
				//required : false,
				editable : false,
				onSelect : function(record) {
					makeAccessory();
					//$("#costCenterName${rand}").val(record.text);
					//$('#costCenterId${rand}').val(record.id);
				}
			});
	    	
				if($("#factory${rand}").combobox("getValue")!=''&&$("#factory${rand}").combobox("getValue")!=null&&$("#factory${rand}").combobox("getValue")!=undefined){
					$.get('hrFlow/getSapCostCenter.json', {
						factory:$("#factory${rand}").combobox("getValue")
					}, function(data) {
						costCenter.combobox('clear').combobox('loadData', data);
					}, 'json');
				}
		}
		
		function showRequire(n){
			var courseAllot = $.trim($("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(2).find("select").val());
			var stock=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(3).find("input");
			var stockNameAndStandard=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(4).find("input");
			var monad=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(6).find("input");
			var roging=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(7).find("input");
			//var costCenter=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(9);
			var procurementSection=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(12).find("input");
			var itemGroup=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(13);
			//itemGroup.empty();
			roging.val('');
			if(courseAllot=='K'){
				stock.validatebox({required:false});
				stockNameAndStandard.validatebox({required:true});
				monad.validatebox({required:true});
				roging.validatebox({required:true});
				procurementSection.validatebox({required:true});
				//costCenter.html('<input id="costCenter'+n+'${rand}" type="text" class="easyui-combobox" data-options="valueField : \'id\',textField : \'text\',required : true,editable : false,onSelect : function(record) {makeAccessory();}" style="width:120px;border:solid 1px #007ACC;"/>');
				//roging.val('6598000059');
				if(stock.val()==null || stock.val()==''){
					itemGroup.html('<select id="itemGroup'+n+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getRecoking('+n+');">'
							+'<option value="7001">7001-消防类</option>'
							+'<option value="7002">7002-安全系统类</option>'
							+'<option value="7004">7004-电工维修工具类</option>'
							+'<option value="7005">7005-办公设施类</option>'
							+'<option value="7006">7006-办公用品类</option>'
							+'<option value="7007">7007-生活辅助类</option>'
							+'<option value="7008">7008-安装制作维修类</option>'
							+'<option value="7010" selected="selected">7010-设备维修类</option>'
							+'<option value="7011">7011-手机充值卡类</option>'
							+'<option value="7012">7012-手机测试卡类</option>'
							+'<option value="7014">7014-培训物资类</option>'
						+' </select>');
					roging.val('6598000059');
				}
			}else{
				//roging.val('');
				stock.validatebox({required:true});
				stockNameAndStandard.validatebox({required:false});
				monad.validatebox({required:false});
				roging.validatebox({required:false});
				procurementSection.validatebox({required:false});
				//costCenter.html('<input id="costCenter'+n+'${rand}" type="text" class="easyui-combobox" data-options="valueField : \'id\',textField : \'text\',required : false,editable : false,onSelect : function(record) {makeAccessory();}" style="width:120px;border:solid 1px #007ACC;"/>');
				itemGroup.html('<input id="itemGroup'+n+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" onblur="makeAccessory();" readonly/>');
			}
			//$('#accessoryInfoTb${rand} tbody').append($("#accessoryInfoTb${rand}").find("tr").eq(n-1));
	    	$.parser.parse($('#accessoryInfoTb${rand}').find("tr").eq(n-1));
			makeAccessory();
		}
		
		function getRecoking(n){
			var itemGroup = $.trim($("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(13).find("select").val());
			var reckoning=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(7).find("input");
			if(itemGroup=='7001'||itemGroup=='7010'){
				reckoning.val('6598000059');
			}else if(itemGroup=='7011'||itemGroup=='7014'){
				reckoning.val('6598000022');
			}else if(itemGroup=='7509'){
				reckoning.val('6598000086');
			}else if(itemGroup=='7510'){
				reckoning.val('6598000087');
			}else if(itemGroup=='7511'){
				reckoning.val('6598000088');
			}else{
				reckoning.val('6598000033');
			}
			makeAccessory();
		}
		
		function removeAccessory() {
	    	var rows = $('#accessoryInfoTb${rand} tbody tr input[type="checkbox"]:checked');
            if (rows.length == 0) {
        		$.messager.alert("操作提示", "请至少选择一条数据", "info");
        		return false;
            }

            $.each(rows, function () {        
                $(this).parent("td").parent("tr").remove();
            });
            
            /*var rowno=1;
            $('#accessoryInfoTb${rand} tbody tr').each(function () {
            	$(this).find('td').eq(1).text(rowno++);
            });*/
            var MFixedAssetsDetraction = { accessoryData:[] };
            var accessoryArr = [];
            var rows=1;
    		$('#accessoryInfoTb${rand} tbody tr').each(function () {
    			var courseAllot = $.trim($(this).find('td').eq(2).find("select").val());
    			var stockNumber = $.trim($(this).find('td').eq(3).find("input").val());
    			var stockNameAndStandard = $.trim($(this).find('td').eq(4).find("input").val());
    			var applyNumber = $.trim($(this).find('td').eq(5).find("input").numberbox("getValue"));
    			var monad = $.trim($(this).find('td').eq(6).find("input").val());
    			//var factory = $.trim($(this).find('td').eq(7).find("input").combotree("getText"));
    			var reckoning = $.trim($(this).find('td').eq(7).find("input").val());
    			var costCenter = $.trim($(this).find('td').eq(8).find("input").combotree("getText"));
    			var unitPrice = $.trim($(this).find('td').eq(9).find("input").numberbox("getValue"));
    			var amountInTotal = $.trim($(this).find('td').eq(10).find("input").numberbox("getValue"));
    			var deliveryDate = $.trim($(this).find('td').eq(11).find("input").val());
    			var procurementSection = $.trim($(this).find('td').eq(12).find("input").val());
    			var itemGroup='';
    			if(courseAllot=='K' && (stockNumber==null || stockNumber=='')){
    				itemGroup = $.trim($(this).find('td').eq(13).find("select").val());
    			}else{
    				itemGroup = $.trim($(this).find('td').eq(13).find("input").val());
    			}
    			var applyName = $.trim($(this).find('td').eq(14).find("input").val());
    			var remark = $.trim($(this).find('td').eq(15).find("input").val());
    			accessoryArr.push({
    				courseAllot:courseAllot,stockNumber:stockNumber,stockNameAndStandard:stockNameAndStandard,applyNumber:applyNumber,monad:monad,reckoning:reckoning,costCenter:costCenter,unitPrice:unitPrice,amountInTotal:amountInTotal,deliveryDate:deliveryDate,procurementSection:procurementSection,itemGroup:itemGroup,applyName:applyName,remark:remark
    			});
    			MFixedAssetsDetraction.accessoryData.push({
    				rowno:rows,courseAllot:courseAllot,stockNumber:stockNumber,stockNameAndStandard:stockNameAndStandard,applyNumber:applyNumber,monad:monad,reckoning:reckoning,costCenter:costCenter,unitPrice:unitPrice,amountInTotal:amountInTotal,deliveryDate:deliveryDate,procurementSection:procurementSection,itemGroup:itemGroup,applyName:applyName,remark:remark
    			});
    			rows++;
    		});
    		$('#AccessoriesJsonStr${rand}').val(JSON.stringify(MFixedAssetsDetraction));

        	var rowno = '';
        	$("#accessoryInfoTb${rand} tbody").empty();
    		$.each(accessoryArr, function(idx, obj) {
    			rowno=idx+1;
    			var str = '<tr>';
				str += '<td width="1"><input type="checkbox" class="tdchk" /></td>';
				str += '<td width="24" align="center">' + rowno + '</td>';
				str += '<td width="45"><select id="courseAllot'+rowno+'${rand}" style="width:40px;border:solid 1px #007ACC;" onchange="showRequire('+rowno+')"><option value="" selected="selected"></option><option value="K">K</option></select></td>';
				str += '<td width="80"><input id="stock'+rowno+'${rand}" type="text" class="easyui-validatebox" data-options="required:true" style="width:75px;border:solid 1px #007ACC;" onblur="getStockInfo('+rowno+');" value="'+obj.stockNumber+'"/></td>';
				str += '<td width="150"><input id="stockNameAndStandard'+rowno+'${rand}" type="text" class="easyui-validatebox"  style="width:145px;border:solid 1px #007ACC;" value="'+obj.stockNameAndStandard+'" onblur="makeAccessory()"/></td>';
				str +='<td width="60"><input type="text" class="easyui-numberbox" data-options="required:true" style="width:55px;border:solid 1px #007ACC;" onblur="getAcountIntTotal('+rowno+');" value="'+obj.applyNumber+'"/></td>';
				str +='<td width="60"><input id="monad'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:55px;border:solid 1px #007ACC;" value="'+obj.monad+'" onblur="makeAccessory()"/></td>';
				//str +='<td width="125"><input id="factory'+rowno+'${rand}" type="text" data-options="required:true" style="width:120px;border:solid 1px #007ACC;" value="'+obj.factory+'" /></td>';
				str +='<td width="80"><input id="totalAllot'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:75px;border:solid 1px #007ACC;" onblur="makeAccessory()" value="'+obj.reckoning+'"/></td>';
				str +='<td width="125"><input id="costCenter'+rowno+'${rand}" type="text" style="width:120px;border:solid 1px #007ACC;" value="'+obj.costCenter+'"/></td>';
				str +='<td width="60"><input id="unitPrice'+rowno+'${rand}" type="text" class="easyui-numberbox" data-options="required:true" precision="3" style="width:55px;border:solid 1px #007ACC;" onblur="getAcountIntTotal('+rowno+');" value="'+obj.unitPrice+'"/></td>';
				str +='<td width="80"><input id="totalAmount'+rowno+'${rand}" type="text" class="easyui-numberbox" precision="3" style="width:75px;border:solid 1px #007ACC;" value="'+obj.amountInTotal+'" readonly/></td>';
				str +='<td width="125"><input type="text" class="easyui-my97" data-options="width:100,required:true,disabled:false,minDate:\'%y-%M-{%d}\',validType:\'reqdate\' " style="width:100px;border:solid 1px #007ACC;" onblur="makeAccessory()" value="'+obj.deliveryDate+'"/></td>';
				str +='<td width="50"><input id="procurementSection'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:45px;border:solid 1px #007ACC;" value="'+obj.procurementSection+'" onblur="makeAccessory()"/></td>';
				if(obj.courseAllot=='K'&&(obj.stockNumber==null||obj.stockNumber=='')){
					str +='<td width="100"><select id="itemGroup'+rowno+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getRecoking('+rowno+');">'
					+'<option value="7001">7001-消防类</option>'
					+'<option value="7002">7002-安全系统类</option>'
					+'<option value="7004">7004-电工维修工具类</option>'
					+'<option value="7005">7005-办公设施类</option>'
					+'<option value="7006">7006-办公用品类</option>'
					+'<option value="7007">7007-生活辅助类</option>'
					+'<option value="7008">7008-安装制作维修类</option>'
					+'<option value="7010" selected="selected">7010-设备维修类</option>'
					+'<option value="7011">7011-手机充值卡类</option>'
					+'<option value="7012">7012-手机测试卡类</option>'
					+'<option value="7014">7014-培训物资类</option>'
				+' </select></td>';
				}else{
					str +='<td width="100"><input id="itemGroup'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+obj.itemGroup+'" onblur="makeAccessory()"/></td>';
				}
				str +='<td width="80"><input type="text" class="easyui-validatebox" data-options="required:true" style="width:75px;border:solid 1px #007ACC;" onblur="makeAccessory()" value="'+obj.applyName+'"/></td>';
				str +='<td width="180"><input type="text" class="easyui-validatebox" style="width:175px;border:solid 1px #007ACC;" onblur="makeAccessory()" value="'+obj.remark+'"/></td>';
				str += '</tr>';
			
				$('#accessoryInfoTb${rand} tbody').append(str);
				//$.parser.parse($('#accessoryInfoTb${rand}').parent());
				$.parser.parse($('#accessoryInfoTb${rand}').find("tr").eq(idx));
				
				/*$("#unitPrice"+rowno+"${rand}").numberbox({
				    precision:3
				});
		    	
		    	$("#totalAmount"+rowno+"${rand}").numberbox({
				    precision:3
				});*/
		    	
				if(obj.courseAllot=='K'){
					$("#stock"+rowno+"${rand}").validatebox({required:false});
					$("#stockNameAndStandard"+rowno+"${rand}").validatebox({required:true});
					$("#monad"+rowno+"${rand}").validatebox({required:true});
					$("#totalAllot"+rowno+"${rand}").validatebox({required:true});
					if(obj.stockNumber==null||obj.stockNumber==''){
						$("#itemGroup"+rowno+"${rand} option[value='"+obj.itemGroup+"']").attr("selected", true); 
					}
				}
				$("#courseAllot"+rowno+"${rand} option[value='"+obj.courseAllot+"']").attr("selected", true);
				
    		});
    		var rows = $('#accessoryInfoTb${rand} tbody tr');
			if(rows.length == 0) {		
				$('#accessoryInfoTb${rand}').val('');
			} else {				
        		$('#accessoryInfoTb${rand} tbody tr').each(function () {
        			var row=$.trim($(this).find('td').eq(1).find("input").val());
        			var courseAllot1=$.trim($(this).find('td').eq(2).find("input").val());
        			var stock1 = $(this).find('td').eq(3).find("input");
        			var stockNameAndStandard1 =$(this).find('td').eq(4).find("input");
        			var monad1 = $(this).find('td').eq(6).find("input");
        			//var factory1 = $(this).find('td').eq(7).find("input");
        			var reckoning=$(this).find('td').eq(7).find("input");
        			var costCenter1 = $(this).find('td').eq(8).find("input");
        			//var unitPrice = $(this).find('td').eq(10).find("input");
        			//var amountInTotal = $(this).find('td').eq(11).find("input");
        			var procurementSection1 =$(this).find('td').eq(12).find("input");
        			var itemGroup1=null;
        			
        			costCenter1.combobox({
						valueField : 'id',
						textField : 'text',
						//required : true,
						editable : false,
						onSelect : function(record) {
							makeAccessory();
							//$("#costCenterName${rand}").val(record.text);
							//$('#costCenterId${rand}').val(record.id);
						},onLoadSuccess:function(){
							costCenter1.combobox('setValue',costCenter1.val());
						}
					});
        			
        			if(courseAllot1=='K'&&(stock1==null||stock1=='')){
        				itemGroup1 =$(this).find('td').eq(13);
        			}else{
        				itemGroup1 =$(this).find('td').eq(13).find("input");
        			}
        			if($("#factory${rand}").combobox("getValue")!=''&&$("#factory${rand}").combobox("getValue")!=null&&$("#factory${rand}").combobox("getValue")!=undefined){
    					$.get('hrFlow/getSapCostCenter.json', {
    						factory:$("#factory${rand}").combobox("getValue")
    					}, function(data) {
    						costCenter1.combobox('loadData', data);
    					}, 'json');
    					
    					if(stock1.val()==null || stock1.val()==''){
							return;
						}
						//根据工厂、物料编号获取非生产物资数据
						$.get("hrFlow/getStockInfo.json",{
							functionName:'ZHR_OA46',vars:'I_MATNR_VALUE_'+stock1.val()+'_NEXT_I_WERKS_VALUE_'+$("#factory${rand}").combobox("getValue"),exportTableName:'E_MATNR',
							exportlist:'MAKTX_NEXT_MEINS_NEXT_EKGRP_NEXT_MATKL'
						},function(data){
							var jsondata=eval("("+data+")");
							if(jsondata.MAKTX=='' && jsondata.MEINS=='' && jsondata.EKGRP=='' && jsondata.MATKL==''){
								$.messager.alert("提示信息","您好，此编号的非生产物资不存在!");
								$(this).find('td').eq(3).find("input").val('');
							}
							stockNameAndStandard1.val(jsondata.MAKTX);
							monad1.val(jsondata.MEINS);
							procurementSection1.val(jsondata.EKGRP);
							//if(courseAllot1=='K'){
								if(jsondata.MATKL=='7001'||jsondata.MATKL=='7010'){
									reckoning.val('6598000059');
								}else if(jsondata.MATKL=='7011'||jsondata.MATKL=='7014'){
									reckoning.val('6598000022');
								}else if(jsondata.MATKL=='7509'){
									reckoning.val('6598000086');
								}else if(jsondata.MATKL=='7510'){
									reckoning.val('6598000087');
								}else if(jsondata.MATKL=='7511'){
									reckoning.val('6598000088');
								}else{
									reckoning.val('6598000033');
								}
							if(courseAllot1=='K'){
								itemGroup1.html('<input id="itemGroup'+row+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+jsondata.MATKL+'" onblur="makeAccessory()"/>');
							}else{
								itemGroup1.val(jsondata.MATKL);
							}
						});
    				}
        		});
			}
    		//$('#accessoryInfoTb${rand} tbody').append($('#accessoryInfoTb${rand} tbody tr'));
    		//$.parser.parse($('#accessoryInfoTb${rand}').parent());
    		$("#isOffRowCount${rand}").val($('#accessoryInfoTb${rand} tbody tr').length);
    		//makeAccessory();
		}
		
		function makeAccessory() {
			var rows = $('#accessoryInfoTb${rand} tbody tr');
			if(rows.length == 0) {		
				$('#AccessoriesJsonStr${rand}').val('');
			} else {				
				var MFixedAssetsDetraction = { accessoryData:[] };
				var rowno = 1;
        		$('#accessoryInfoTb${rand} tbody tr').each(function () {
        			var courseAllot = $.trim($(this).find('td').eq(2).find("select").val());
        			var stockNumber = $.trim($(this).find('td').eq(3).find("input").val());
        			var stockNameAndStandard = $.trim($(this).find('td').eq(4).find("input").val());
        			var applyNumber = $.trim($(this).find('td').eq(5).find("input").numberbox("getValue"));
        			var monad = $.trim($(this).find('td').eq(6).find("input").val());
        			//var factory = $.trim($(this).find('td').eq(7).find("input").combotree("getText"));
        			var reckoning = $.trim($(this).find('td').eq(7).find("input").val());
        			var costCenter = $.trim($(this).find('td').eq(8).find("input").combotree("getText"));
        			var unitPrice = $.trim($(this).find('td').eq(9).find("input").val());
        			var amountInTotal = $.trim($(this).find('td').eq(10).find("input").numberbox("getValue"));
        			var deliveryDate = $.trim($(this).find('td').eq(11).find("input").val());
        			var procurementSection = $.trim($(this).find('td').eq(12).find("input").val());
        			var itemGroup='';
        			if(courseAllot=='K' && (stockNumber==null || stockNumber=='')){
        				itemGroup = $.trim($(this).find('td').eq(13).find("select").val());
        			}else{
        				itemGroup = $.trim($(this).find('td').eq(13).find("input").val());
        			}
        			var applyName = $.trim($(this).find('td').eq(14).find("input").val());
        			var remark = $.trim($(this).find('td').eq(15).find("input").val());
        		
        			MFixedAssetsDetraction.accessoryData.push({
        				rowno:rowno,courseAllot:courseAllot,stockNumber:stockNumber,stockNameAndStandard:stockNameAndStandard,applyNumber:applyNumber,monad:monad,reckoning:reckoning,costCenter:costCenter,unitPrice:unitPrice,amountInTotal:amountInTotal,deliveryDate:deliveryDate,procurementSection:procurementSection,itemGroup:itemGroup,applyName:applyName,remark:remark
        			})
        			rowno++;
        		});
        		
        		$('#AccessoriesJsonStr${rand}').val(JSON.stringify(MFixedAssetsDetraction));
			}
		}
		function getStockInfo(n){
			var courseAllot = $.trim($("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(2).find("select").val());
			var stock=$.trim($("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(3).find("input").val());
			var factory=$.trim($("#factory${rand}").combobox('getValue'));
			var reckoning=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(7).find("input");
			var stockNameAndStandard=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(4).find("input");
			var monad=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(6).find("input");
			var procurementSection=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(12).find("input");
			var itemGroup=null;
			if(courseAllot=='K'){
				itemGroup=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(13);
			}else{
				itemGroup=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(13).find("input");
			}
			if(factory==null || factory==''){
				return;
			}
			if(stock==null || stock==''){
				if(courseAllot=='K'){
					itemGroup.html('<select id="itemGroup'+n+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getRecoking('+n+');">'
							+'<option value="7001">7001-消防类</option>'
							+'<option value="7002">7002-安全系统类</option>'
							+'<option value="7004">7004-电工维修工具类</option>'
							+'<option value="7005">7005-办公设施类</option>'
							+'<option value="7006">7006-办公用品类</option>'
							+'<option value="7007">7007-生活辅助类</option>'
							+'<option value="7008">7008-安装制作维修类</option>'
							+'<option value="7010" selected="selected">7010-设备维修类</option>'
							+'<option value="7011">7011-手机充值卡类</option>'
							+'<option value="7012">7012-手机测试卡类</option>'
							+'<option value="7014">7014-培训物资类</option>'
						+' </select>');
					reckoning.val('');
				}
				return;
			}
			//根据工厂、物料编号获取非生产物资数据
			/*if(factory=='59513'){
				if(stock==null || stock==''){
					return;
				}*/
				//根据工厂、物料编号获取非生产物资数据
				$.ajax({
			           type: "post",
			           url: "hrFlow/getStockInfo.json",
			           cache: false,
			           async: false,  //设置同步
			           dataType: "json",
			           data: {functionName:'ZHR_OA46',vars:'I_MATNR_VALUE_'+stock+'_NEXT_I_WERKS_VALUE_'+factory,exportTableName:'E_MATNR',
							exportlist:'MAKTX_NEXT_MEINS_NEXT_EKGRP_NEXT_MATKL'},
			           success: function (data) {
			            	var jsondata=eval("("+data+")");
			            	if(jsondata.MAKTX=='' && jsondata.MEINS=='' && jsondata.EKGRP=='' && jsondata.MATKL==''){
								$.messager.alert("提示信息","您好，此编号的非生产物资不存在!");
								$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(3).find("input").val('');
							}
			            	stockNameAndStandard.val(jsondata.MAKTX);
							monad.val(jsondata.MEINS);
							procurementSection.val(jsondata.EKGRP);
							//if(courseAllot=='K'){
								if(jsondata.MATKL=='7001'||jsondata.MATKL=='7010'){
									reckoning.val('6598000059');
								}else if(jsondata.MATKL=='7011'||jsondata.MATKL=='7014'){
									reckoning.val('6598000022');
								}else if(jsondata.MATKL=='7509'){
									reckoning.val('6598000086');
								}else if(jsondata.MATKL=='7510'){
									reckoning.val('6598000087');
								}else if(jsondata.MATKL=='7511'){
									reckoning.val('6598000088');
								}else{
									reckoning.val('6598000033');
								}
							if(courseAllot=='K'){
								itemGroup.html('<input id="itemGroup'+n+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+jsondata.MATKL+'" onblur="makeAccessory();"/>');
							}else{
								itemGroup.val(jsondata.MATKL);
							}
			            }
			          });
			
			makeAccessory();
		}
				
		//下载模板
		$("#downloadTravelExcel${rand}").bind('click',function(){
			submitForm("download.equipmentMaintain.name");
		});
		function submitForm(value){
			var form = $("<form>");
			form.attr('style','display:none');
			form.attr('method','post');
			form.attr('action','${base}sysprocess/task/mDownload.html');
			
			var key = $("<input>");
			key.attr('type','hidden');
			key.attr('name','key');
			key.attr('value',value);
			
			$("body").append(form);
			form.append(key);
			
			form.submit();
			form.remove();
		}
		//导入设备物料清单
		$("#openImportPersonBtn-${rand}").bind('click',function(){
			 $("#importWin-${rand}").dialog('open');
		 });
		
		 function clearInputFile${rand}(){
				//清空文件框
				$("#upload_file-${rand}").remove(); //移除原来的
			    var newFileInput = '<input id="upload_file-${rand}" class="easyui-validatebox" data-options="required:true" type="file" name="files" style="width:300px;"/>';
			   	$('#td_input_${rand}').html(newFileInput); //添加新的
			    $.parser.parse('#td_input_${rand}');
			}
		 
		 $("#upfile-${rand}").bind('click',function(){
			 $.messager.progress();
			 $("#upform-${rand}").form('submit',{
					url:'teamActivities/importEquipmentMaintain.json',
					onSubmit:function(){
						var validateResult = $(this).form('validate');
				    	if (!validateResult) {
				    		$.messager.progress('close');
							return false;
				    	} else {
				    		return true;
				    	}
				    },
					success:function(data){
						if(typeof(data).toLowerCase()=='string'){
							data=eval("("+data+")");
						}
						if(data.success){
							if(data.obj == null || data.obj.length == 0){
								$.messager.alert("提示信息","您上传的文件为空，请重新上传！");
							}else{
							
								var MFixedAssetsDetraction = { accessoryData:[] };
								if(data.obj.length>0){
									$('#participantListTb${rand} tbody').html("");
									$("#participantListTb${rand}").append("<tr align=center><td width=5%>序号</td><td width=5%>科目分配</td><td width=5%>物料编码</td><td width=10%>物料名称及规格</td><td width=5%>申请数量</td><td width=5%>单位</td><td width=5%>总账科目</td><td width=10%>成本中心</td><td width=5%>预估单价</td><td width=5%>合计</td><td width=10%>交货日期</td><td width=5%>采购组</td><td width=10%>物料组</td><td width=5%>申请者</td><td width=10%>备注</td></tr>");
									for(var i = 0;i < data.obj.length;i++){
									 var str='<tr align="center"><td>'+data.obj[i].number+'</td>'
										+'<td width="45"><select id="courseAllot'+data.obj[i].number+'${rand}" style="width:40px;border:solid 1px #007ACC;" onchange="showImportRequire('+data.obj[i].number+')"><option value="" selected="selected"></option><option value="K">K</option></select></td>'
										+'<td width="80"><input id="stock'+data.obj[i].number+'${rand}" type="text" class="easyui-validatebox" data-options="required:true" style="width:75px;border:solid 1px #007ACC;" onblur="getImportStockInfo('+data.obj[i].number+');" value="'+$.trim(data.obj[i].stockNumber)+'"/></td>'
										+'<td width="150"><input id="stockNameAndStandard'+data.obj[i].number+'${rand}" type="text" class="easyui-validatebox"  style="width:145px;border:solid 1px #007ACC;" value="'+data.obj[i].stockNameAndStandard+'" onblur="makeImportInf()"/></td>'
										+'<td width="60"><input type="text" class="easyui-numberbox" data-options="required:true" style="width:55px;border:solid 1px #007ACC;" onblur="getImportAcountIntTotal('+data.obj[i].number+');" value="'+data.obj[i].applyNumber+'"/></td>'
										+'<td width="60"><input id="monad'+data.obj[i].number+'${rand}" type="text" class="easyui-validatebox" style="width:55px;border:solid 1px #007ACC;" value="'+data.obj[i].monad+'" onblur="makeImportInf()"/></td>'
										+'<td width="80"><input id="totalAllot'+data.obj[i].number+'${rand}" type="text" class="easyui-validatebox" style="width:75px;border:solid 1px #007ACC;" onblur="makeImportInf()" value="'+data.obj[i].reckoning+'"/></td>'
										+'<td width="125"><input id="costCenter'+data.obj[i].number+'${rand}" type="text" class="easyui-validatebox" style="width:120px;border:solid 1px #007ACC;" value="'+data.obj[i].costCenter+'"/></td>'
										+'<td width="60"><input id="unitPrice'+data.obj[i].number+'${rand}" type="text" class="easyui-numberbox" data-options="required:true" precision="3" style="width:55px;border:solid 1px #007ACC;" onblur="getImportAcountIntTotal('+data.obj[i].number+');" value="'+data.obj[i].unitPrice+'"/></td>'
										+'<td width="80"><input id="totalAmount'+data.obj[i].number+'${rand}" type="text" class="easyui-numberbox" precision="3" style="width:75px;border:solid 1px #007ACC;" value="'+data.obj[i].amountInTotal+'" readonly/></td>'
										+'<td width="125"><input type="text" class="easyui-my97" data-options="width:100,required:true,disabled:false,minDate:\'%y-%M-{%d}\',validType:\'reqdate\' " style="width:100px;border:solid 1px #007ACC;" onblur="makeImportInf()" value="'+$.trim(data.obj[i].deliveryDate)+'"/></td>'
										+'<td width="50"><input id="procurementSection'+data.obj[i].number+'${rand}" type="text" class="easyui-validatebox" style="width:45px;border:solid 1px #007ACC;" value="'+data.obj[i].procurementSection+'" onblur="makeImportInf()"/></td>';
										if(data.obj[i].courseAllot=='K'&&(data.obj[i].stockNumber==null||$.trim(data.obj[i].stockNumber)=='')){
											str +='<td width="100"><select id="itemGroup'+data.obj[i].number+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getImportRecoking('+data.obj[i].number+');">'
											+'<option value="7001">7001-消防类</option>'
											+'<option value="7002">7002-安全系统类</option>'
											+'<option value="7004">7004-电工维修工具类</option>'
											+'<option value="7005">7005-办公设施类</option>'
											+'<option value="7006">7006-办公用品类</option>'
											+'<option value="7007">7007-生活辅助类</option>'
											+'<option value="7008">7008-安装制作维修类</option>'
											+'<option value="7010" selected="selected">7010-设备维修类</option>'
											+'<option value="7011">7011-手机充值卡类</option>'
											+'<option value="7012">7012-手机测试卡类</option>'
											+'<option value="7014">7014-培训物资类</option>'
										+' </select></td>';
										}else{
											str +='<td width="100"><input id="itemGroup'+data.obj[i].number+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+data.obj[i].itemGroup+'" onblur="makeImportInf()"/></td>';
										}
										str +='<td width="80"><input type="text" class="easyui-validatebox" data-options="required:true" style="width:75px;border:solid 1px #007ACC;" onblur="makeImportInf()" value="'+data.obj[i].applyName+'"/></td>';
										str +='<td width="180"><input type="text" class="easyui-validatebox" style="width:175px;border:solid 1px #007ACC;" onblur="makeImportInf" value="'+data.obj[i].remark+'"/></td>';
										str += '</tr>';
										
										$('#participantListTb${rand} tbody').append(str);
										//$.parser.parse($('#updateAccessoryInfoTb${rand}').parent());
										$.parser.parse($('#participantListTb${rand}').find("tr").eq(data.obj[i].number));
								    	
										if(data.obj[i].courseAllot=='K'){
											$("#stock"+data.obj[i].number+"${rand}").validatebox({required:false});
											$("#stockNameAndStandard"+data.obj[i].number+"${rand}").validatebox({required:true});
											$("#monad"+data.obj[i].number+"${rand}").validatebox({required:true});
											$("#totalAllot"+data.obj[i].number+"${rand}").validatebox({required:true});
											if(data.obj[i].stockNumber==null||$.trim(data.obj[i].stockNumber)==''){
												$("#itemGroup"+data.obj[i].number+"${rand} option[value='"+data.obj[i].itemGroup+"']").attr("selected", true); 
											}
										}
										$("#courseAllot"+data.obj[i].number+"${rand} option[value='"+data.obj[i].courseAllot+"']").attr("selected", true);  
										
									  MFixedAssetsDetraction.accessoryData.push({
										  rowno:data.obj[i].number,courseAllot:data.obj[i].courseAllot,stockNumber:data.obj[i].stockNumber,stockNameAndStandard:data.obj[i].stockNameAndStandard,applyNumber:data.obj[i].applyNumber,monad:data.obj[i].monad,reckoning:data.obj[i].reckoning,costCenter:$.trim(data.obj[i].costCenter),unitPrice:data.obj[i].unitPrice,amountInTotal:data.obj[i].amountInTotal,deliveryDate:data.obj[i].deliveryDate,procurementSection:data.obj[i].procurementSection,itemGroup:data.obj[i].itemGroup,applyName:data.obj[i].applyName,remark:data.obj[i].remark
					        			})
									  $.ajaxSetup({async : true});
									  $("#isOffRowCount${rand}").val(i+1);
									}
									
						    		var rows = $('#participantListTb${rand} tbody tr');
						    		var count=0;
						    		$('#participantListTb${rand} tbody tr').each(function () {
						        			if(count>0){
						        				var row=$.trim($(this).find('td').eq(0).find("input").val());
							        			var courseAllot1=$.trim($(this).find('td').eq(1).find("input").val());
							        			var stock1 = $(this).find('td').eq(2).find("input");
							        			var stockNameAndStandard1 =$(this).find('td').eq(3).find("input");
							        			var monad1 = $(this).find('td').eq(4).find("input");
							        			var reckoning=$(this).find('td').eq(6).find("input");
							        			var costCenter1 = $(this).find('td').eq(7).find("input");
							        			var procurementSection1 =$(this).find('td').eq(11).find("input");
							        			var itemGroup1=null;
							        			
							        			if(courseAllot1=='K'&&(stock1==null||stock1=='')){
							        				itemGroup1 =$(this).find('td').eq(12);
							        			}else{
							        				itemGroup1 =$(this).find('td').eq(12).find("input");
							        			}
							        			
							        			costCenter1.combobox({
						    						valueField : 'id',
						    						textField : 'text',
						    						//required : true,
						    						editable : false,
						    						onSelect : function(record) {
						    							makeImportInf();
						    							//$("#costCenterName${rand}").val(record.text);
						    							//$('#costCenterId${rand}').val(record.id);
						    						},onLoadSuccess:function(){
						    							costCenter1.combobox('setValue',costCenter1.val());
						    						}
						    					});
							        			
							    					$.get('hrFlow/getSapCostCenter.json', {
							    						factory:$("#factory${rand}").combobox("getValue")
							    					}, function(data) {
							    						costCenter1.combobox("clear")
							    								.combobox('loadData', data);
							    					}, 'json');
						        			}
						    				
						    					count++;
						        		});
							  }
								$('#scrapWay2JsonStr${rand}').val(JSON.stringify(MFixedAssetsDetraction));
								//document.getElementById('participantList_val').value=document.getElementById("participantList").innerHTML;
								$.messager.alert("提示信息",data.msg);
							}
						}else{ 
							$.messager.alert("提示信息",data.msg);
						}
						$("#importWin-${rand}").dialog('close');
						$.messager.progress('close');
					}
				});
		 });
		 
		 function makeImportInf() {
			 	var rows = $('#participantListTb${rand} tbody tr');
				if(rows.length == 0) {		
					$('#scrapWay2JsonStr${rand}').val('');
				} else {				
					var MFixedAssetsDetraction = { accessoryData:[] };
					var rowno = 0;
					$('#participantListTb${rand} tbody tr').each(function () {
						if(rowno>0){
							var courseAllot = $.trim($(this).find('td').eq(1).find("select").val());
		        			var stockNumber = $.trim($(this).find('td').eq(2).find("input").val());
		        			var stockNameAndStandard = $.trim($(this).find('td').eq(3).find("input").val());
		        			var applyNumber = $.trim($(this).find('td').eq(4).find("input").numberbox("getValue"));
		        			var monad = $.trim($(this).find('td').eq(5).find("input").val());
		        			var reckoning = $.trim($(this).find('td').eq(6).find("input").val());
		        			var costCenter = $.trim($(this).find('td').eq(7).find("input").combotree("getText"));
		        			var unitPrice = $.trim($(this).find('td').eq(8).find("input").val());
		        			var amountInTotal = $.trim($(this).find('td').eq(9).find("input").numberbox("getValue"));
		        			var deliveryDate = $.trim($(this).find('td').eq(10).find("input").val());
		        			var procurementSection = $.trim($(this).find('td').eq(11).find("input").val());
		        			var itemGroup='';
		        			if(courseAllot=='K' && (stockNumber==null || stockNumber=='')){
		        				itemGroup = $.trim($(this).find('td').eq(12).find("select").val());
		        			}else{
		        				itemGroup = $.trim($(this).find('td').eq(12).find("input").val());
		        			}
		        			var applyName = $.trim($(this).find('td').eq(13).find("input").val());
		        			var remark = $.trim($(this).find('td').eq(14).find("input").val());
	        			
	        		    	MFixedAssetsDetraction.accessoryData.push({
		        				rowno:rowno,courseAllot:courseAllot,stockNumber:stockNumber,stockNameAndStandard:stockNameAndStandard,applyNumber:applyNumber,monad:monad,reckoning:reckoning,costCenter:costCenter,unitPrice:unitPrice,amountInTotal:amountInTotal,deliveryDate:deliveryDate,procurementSection:procurementSection,itemGroup:itemGroup,applyName:applyName,remark:remark
		        			})
	        		    }
	        			
	        			rowno++;
	        		});
	        		
	        		$('#scrapWay2JsonStr${rand}').val(JSON.stringify(MFixedAssetsDetraction));
				}
			}
		
		 function showImportRequire(n){
				var courseAllot = $.trim($("#participantListTb${rand} tbody").find("tr").eq(n).find("td").eq(1).find("select").val());
				var stock=$("#participantListTb${rand} tbody").find("tr").eq(n).find("td").eq(2).find("input");
				var stockNameAndStandard=$("#participantListTb${rand} tbody").find("tr").eq(n).find("td").eq(3).find("input");
				var monad=$("#participantListTb${rand} tbody").find("tr").eq(n).find("td").eq(5).find("input");
				var roging=$("#participantListTb${rand} tbody").find("tr").eq(n).find("td").eq(6).find("input");
				//var costCenter=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(9);
				var procurementSection=$("#participantListTb${rand} tbody").find("tr").eq(n).find("td").eq(11).find("input");
				var itemGroup=$("#participantListTb${rand} tbody").find("tr").eq(n).find("td").eq(12);
				//itemGroup.empty();
				roging.val('');
				if(courseAllot=='K'){
					stock.validatebox({required:false});
					stockNameAndStandard.validatebox({required:true});
					monad.validatebox({required:true});
					roging.validatebox({required:true});
					procurementSection.validatebox({required:true});
					//costCenter.html('<input id="costCenter'+n+'${rand}" type="text" class="easyui-combobox" data-options="valueField : \'id\',textField : \'text\',required : true,editable : false,onSelect : function(record) {makeAccessory();}" style="width:120px;border:solid 1px #007ACC;"/>');
					//roging.val('6598000059');
					if(stock.val()==null || stock.val()==''){
						itemGroup.html('<select id="itemGroup'+n+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getImportRecoking('+n+');">'
								+'<option value="7001">7001-消防类</option>'
								+'<option value="7002">7002-安全系统类</option>'
								+'<option value="7004">7004-电工维修工具类</option>'
								+'<option value="7005">7005-办公设施类</option>'
								+'<option value="7006">7006-办公用品类</option>'
								+'<option value="7007">7007-生活辅助类</option>'
								+'<option value="7008">7008-安装制作维修类</option>'
								+'<option value="7010" selected="selected">7010-设备维修类</option>'
								+'<option value="7011">7011-手机充值卡类</option>'
								+'<option value="7012">7012-手机测试卡类</option>'
								+'<option value="7014">7014-培训物资类</option>'
							+' </select>');
					}
				}else{
					//roging.val('');
					stock.validatebox({required:true});
					stockNameAndStandard.validatebox({required:false});
					monad.validatebox({required:false});
					roging.validatebox({required:false});
					procurementSection.validatebox({required:false});
					//costCenter.html('<input id="costCenter'+n+'${rand}" type="text" class="easyui-combobox" data-options="valueField : \'id\',textField : \'text\',required : false,editable : false,onSelect : function(record) {makeAccessory();}" style="width:120px;border:solid 1px #007ACC;"/>');
					itemGroup.html('<input id="itemGroup'+n+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" onblur="makeImportInf();" readonly/>');
				}
				//$('#accessoryInfoTb${rand} tbody').append($("#accessoryInfoTb${rand}").find("tr").eq(n-1));
		    	$.parser.parse($('#participantListTb${rand}').find("tr").eq(n));
		    	makeImportInf();
			}
		 
		 function getImportStockInfo(n){
			    var courseAllot = $.trim($("#participantListTb${rand}").find("tr").eq(n).find("td").eq(1).find("select").val());
				var stock=$.trim($("#participantListTb${rand}").find("tr").eq(n).find("td").eq(2).find("input").val());
				var factory=$.trim($("#factory${rand}").combobox("getValue"));
				var reckoning=$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(6).find("input");
				var stockNameAndStandard=$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(3).find("input");
				var monad=$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(5).find("input");
				var procurementSection=$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(11).find("input");
				var itemGroup=null;
				if(courseAllot=='K'){
					itemGroup=$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(12);
				}else{
					itemGroup=$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(12).find("input");
				}
				if(factory==null || factory==''){
					return;
				}
				if(stock==null || stock==''){
					if(courseAllot=='K'){
						itemGroup.html('<select id="itemGroup'+n+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getImportRecoking('+n+');">'
								+'<option value="7001">7001-消防类</option>'
								+'<option value="7002">7002-安全系统类</option>'
								+'<option value="7004">7004-电工维修工具类</option>'
								+'<option value="7005">7005-办公设施类</option>'
								+'<option value="7006">7006-办公用品类</option>'
								+'<option value="7007">7007-生活辅助类</option>'
								+'<option value="7008">7008-安装制作维修类</option>'
								+'<option value="7010" selected="selected">7010-设备维修类</option>'
								+'<option value="7011">7011-手机充值卡类</option>'
								+'<option value="7012">7012-手机测试卡类</option>'
								+'<option value="7014">7014-培训物资类</option>'
							+' </select>');
						reckoning.val('');
					}
					return;
				}
				
					//根据工厂、物料编号获取非生产物资数据
					$.ajax({
				           type: "post",
				           url: "hrFlow/getStockInfo.json",
				           cache: false,
				           async: false,  //设置同步
				           dataType: "json",
				           data: {functionName:'ZHR_OA46',vars:'I_MATNR_VALUE_'+stock+'_NEXT_I_WERKS_VALUE_'+factory,exportTableName:'E_MATNR',
								exportlist:'MAKTX_NEXT_MEINS_NEXT_EKGRP_NEXT_MATKL'},
				           success: function (data) {
				            	var jsondata=eval("("+data+")");
				            	if(jsondata.MAKTX=='' && jsondata.MEINS=='' && jsondata.EKGRP=='' && jsondata.MATKL==''){
									$.messager.alert("提示信息","您好，此编号的非生产物资不存在!");
									$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(2).find("input").val('');
								}
				            	stockNameAndStandard.val(jsondata.MAKTX);
								monad.val(jsondata.MEINS);
								procurementSection.val(jsondata.EKGRP);
								//if(courseAllot=='K'){
									if(jsondata.MATKL=='7001'||jsondata.MATKL=='7010'){
										reckoning.val('6598000059');
									}else if(jsondata.MATKL=='7011'||jsondata.MATKL=='7014'){
										reckoning.val('6598000022');
									}else if(jsondata.MATKL=='7509'){
										reckoning.val('6598000086');
									}else if(jsondata.MATKL=='7510'){
										reckoning.val('6598000087');
									}else if(jsondata.MATKL=='7511'){
										reckoning.val('6598000088');
									}else{
										reckoning.val('6598000033');
									}
								if(courseAllot=='K'){
									itemGroup.html('<input id="itemGroup'+n+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+jsondata.MATKL+'" onblur="makeImportInf();"/>');
								}else{
									itemGroup.val(jsondata.MATKL);
								}
				            }
				          });
				
				makeImportInf();
			}
					
		 function getImportRecoking(n){
				var itemGroup = $.trim($("#participantListTb${rand}").find("tr").eq(n).find("td").eq(12).find("select").val());
				var reckoning=$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(6).find("input");
				if(itemGroup=='7001'||itemGroup=='7010'){
					reckoning.val('6598000059');
				}else if(itemGroup=='7011'||itemGroup=='7014'){
					reckoning.val('6598000022');
				}else if(itemGroup=='7509'){
					reckoning.val('6598000086');
				}else if(itemGroup=='7510'){
					reckoning.val('6598000087');
				}else if(itemGroup=='7511'){
					reckoning.val('6598000088');
				}else{
					reckoning.val('6598000033');
				}
				makeImportInf();
			}
		
		//计算物资合计价钱
		function getAcountIntTotal(n){
			var count=$.trim($("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(5).find("input").val());
			var price=$.trim($("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(9).find("input").val());
			if(isNaN(count)||count==undefined||count==''){
				return;
			}else{
				count=parseFloat(count);
			}
			if(isNaN(price)||price==undefined||price==''){
				return;
			}else{
				price=parseFloat(price);
			}
			$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(10).find("input").val(price*count);
			makeAccessory();
		}
		
		function getImportAcountIntTotal(n){
			var count=$.trim($("#participantListTb${rand}").find("tr").eq(n).find("td").eq(4).find("input").val());
			var price=$.trim($("#participantListTb${rand}").find("tr").eq(n).find("td").eq(8).find("input").val());
			if(isNaN(count)||count==undefined||count==''){
				return;
			}else{
				count=parseFloat(count);
			}
			if(isNaN(price)||price==undefined||price==''){
				return;
			}else{
				price=parseFloat(price);
			}
			$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(9).find("input").val(price*count);
			makeImportInf();
		}
	</script>
	</#if>
</#if>

<!-- 判断是否结束流程 -->
<#if currentStep?exists && currentStep == 'confirmProcessEndTask'> 
		<div id="confirmProcessEndTask">
			<form id="confirmProcessEndTaskForm" method="post" enctype='multipart/form-data'>
				<table id="confirmProcessEndTaskFormTable" class="formtable" cellspacing="1" cellpadding="0">
				
			   	<tr>
			   		<td class="formtable_td_key" rowspan="3">发起人确认</td>
			  	  	<td class="formtable_td_key">是否结束该流程</td>
			  	  	<td class="formtable_td_value" colspan="3">
								<input id="endProcess-${rand}" type="radio" name="fp_confirmProcessEndAudi"  value="1" mobile="是否结束该流程_是"/>是
								<input id="continueProcess-${rand}" type="radio" name="fp_confirmProcessEndAudi" checked="checked" value="0" mobile="是否结束该流程_否"/>否
					</td>
		  	  	</tr>
					<tr>
						<td class="formtable_td_key">确认意见：</td>
						<td class="formtable_td_value" colspan="3">
							<textarea style="width: 800px; height: 100px" mobile="确认意见" id="applyUserAudiAdvice${rand}" name="fp_applyUserAudiAdvice" class="easyui-validatebox" mobile="确认意见"></textarea>
						</td>
					</tr>
					<tr>
						<td class="formtable_td_key">确认人</td>
						<td class="formtable_td_value" >
							<input type="hidden" name="fp_applyUserAccount" value="${appuser.account}" />
							<input type="hidden" name="fp_applyUserName" value="${appuser.name}" mobile="确认人"/>
							${appuser.name}
						</td>
						<td class="formtable_td_key">确认时间：</td>
						<td class="formtable_td_value"  >
							<input type="hidden" name="fp_applyUserAudiTime" timeEditor="1"  value="${.now?string('yyyy-MM-dd HH:mm:ss')}" mobile="确认时间"/>
							${.now?string('yyyy-MM-dd HH:mm:ss')}
						</td>
					</tr>
				</table>
			</form>
		</div>
		<script type="text/javascript">
			$("#applyUserAudiAdvice${rand}").validatebox({required:false});
			var success = function(){
				$("#applyUserAudiAdvice${rand}").validatebox({required:false});//是否结束流程意见为非必填项
			}
			var failure=function(){
				$("#applyUserAudiAdvice${rand}").val('');
				$("#applyUserAudiAdvice${rand}").validatebox({required:true});//是否结束流程意见为必填项
			};
			$("#continueProcess-${rand}").bind("click",success);
			$("#endProcess-${rand}").bind("click",failure);
		</script>
</#if>
<!-- 修改设备维修申请 -->
<#if currentStep?exists>
	<#if processSteps??> 
      <#list processSteps as steps> 
      	<#if steps.key == 'startevent1'>
	<#if currentStep == 'updateEquipmentApplyTask'>
	<#if steps.vars["isOffGaffer"]=='1'>
		<#if steps.vars["scrapWay"]=='1'>
			<#assign text=steps.vars["MFixedAssetsDetraction"]!""/>
		</#if>
		<#if steps.vars["scrapWay"]=='2'>
			<#assign text=steps.vars["scrapWay2JsonStr"]!""/>
		</#if>
	</#if>
	<#assign proofType=steps.vars["proofType"]!""/>
		<div id="updateEquipmentApplyTask">
			<form id="updateEquipmentApplyTaskForm" method="post" enctype='multipart/form-data'>
		  	  <table id="updateEquipmentApplyTaskFormTable" class="formtable" cellspacing="1" cellpadding="0">
		  	 	<tr>
		  	  		<td class="formtable_td_key" align="center" colspan="4" style="font-weight:bold;font-size:14px;">
		  	  			修改设备维修申请表
		  	  		</td>
		  	  	</tr>
		  	  	<tr>
		  	  		<td class="formtable_td_key">申请部门：</td>
					<td class="formtable_td_value">
						   <input id="updateApplyDepartment${rand}" style="width:180px;" class='easyui-validatebox' type="text" name="fp_updateApplyDepartment" value="${(steps.vars["applyDepartment"])!""}"/>
					</td>
		  	  		<td class="formtable_td_key">申请日期：</td>
		  	  		<td class="formtable_td_value">
		  	  			<input id="updateApplyDate${rand}" class="easyui-my97" style="width:165px;" type='text' name='fp_updateApplyDate' data-options="width:120,required:true,disabled:false,minDate:'%y-%M-{%d}',validType:'reqdate' " value='${(steps.vars["applyDate"])!""}'/>
		  	  		</td>
		  	  	</tr>
		  	  	<tr>
					<td class="formtable_td_key">设备名称：</td>
			  	  		<td class="formtable_td_value" >
			  	  			<input id="updateEquipmentName${rand}" style="width:180px;" type="text"  class="easyui-validatebox textbox"  data-options="required:true"   name="fp_updateEquipmentName" value="${(steps.vars["equipmentName"])!""}"/>
			  	  		</td>
		  	  		<td class="formtable_td_key">型号/规格：</td>
			  	  		<td class="formtable_td_value"  >
			  	  			<input id="updateTypeOrStandard${rand}" style="width:180px;" type="text"  class="easyui-validatebox textbox"  data-options="required:true"   name="fp_updateTypeOrStandard" value="${(steps.vars["typeOrStandard"])!""}"/>
			  	  		</td>
		  	  	</tr>
		  	  	<tr>
		  	  		<td class="formtable_td_key">设备编号：</td>
		  	  		<td class="formtable_td_value">
		  	  			<input id="updateEquipmentNo${rand}" style="width:180px;" type="text"  class="easyui-validatebox textbox"  data-options="required:true"   name="fp_updateEquipmentNo" value="${(steps.vars["equipmentNo"])!""}"/>
		  	  		</td>
		  	  		<td class="formtable_td_key" >生产厂家:</td>
		  	  		<td class="formtable_td_value">
		  	  			<input id="updateManufactureFactory${rand}" style="width:180px;" class="easyui-validatebox textbox" name="fp_updateManufactureFactory" type="text" value="${(steps.vars["manufactureFactory"])!""}"/>
		  	  		</td>	
		  	  	</tr>
				<tr>
					<td class="formtable_td_key">所属类别：</td>
					<td class="formtable_td_value">
						<input type="checkbox" name="fp_updateEquipmentType" value="1"  <#if steps.vars["equipmentType"]?contains("1")>checked</#if>/>设备类
		                <input type="checkbox" name="fp_updateEquipmentType" value="2"  <#if steps.vars["equipmentType"]?contains("2")>checked</#if>/>仪表类
		                <input type="checkbox" name="fp_updateEquipmentType" value="3"  <#if steps.vars["equipmentType"]?contains("3")>checked</#if>/>工具类
		                <input type="checkbox" name="fp_updateEquipmentType" value="4"  <#if steps.vars["equipmentType"]?contains("4")>checked</#if>/>测架类
					
						<!--<input type="checkbox"   name="fp_updateEquipmentType" value="1" />设备类
	                    <input type="checkbox"   name="fp_updateEquipmentType" value="2"/>仪表类
	                    <input type="checkbox"   name="fp_updateEquipmentType" value="3"/>工具类
	                    <input type="checkbox"   name="fp_updateEquipmentType" value="4"/>测架类-->
	                    <font color="red"> (至少勾选一个) </font>
	                    <input id="moduleName${rand}" name="fp_moduleName" class="easyui-validatebox" data-options="required:true" missingMessage="至少勾选一个" style="padding:0px;margin:0px;width:0px;height:0px;border-width:0px;" />
					</td>
					<td class="formtable_td_key">工厂：</td>
					<td class="formtable_td_value">
						<input id="factory${rand}" class="easyui-combobox" style="width:180px;" type="text"  name="fp_updateFactory" value="${(steps.vars["factory"])!""}" data-options="required:true,valueField: 'value',textField: 'text',
									data:[
										{text:'东莞市金铭电子有限公司',value:'2000'},
										{text:'东莞金卓通信科技有限公司',value:'3000'}] " 
										/>
						<input id="factoryName${rand}" type="hidden" name="fp_updateFactoryName" value="${(steps.vars["factoryName"])!""}"/>
					</td>
				</tr>
				<tr>
					<td class="formtable_td_key" >故障现象描述:</td>
		  	  		<td class="formtable_td_value" colspan="3">
		  	  			<textarea
							 name="fp_updateFaultDescribe" class="easyui-validatebox"   
							style="font-size: 12px; width: 800px; height: 50px;" data-options="required:true">${(steps.vars["faultDescribe"])!""}</textarea>
		  	  		</td>
				</tr>
				<#if steps.vars["isOffGaffer"]=='1'>
				<tr class="gaffter">
					<td class="formtable_td_key">凭证类型：</td>
					<td class="formtable_td_value" colspan="3">
						 <select id="updateProofType${rand}" name="fp_updateProofType" style="width:180px;">
						 	<option value='ZR01'>ZR01 总经办非生产物资采购申请</option>
						  	<option value='NB'>NB 标准采购申请</option>
						  	<option value='ZR02'>ZR02 工程部非生产物资采购申请</option>
						  	<option value='ZR03'>ZR03 物殊采购申请</option>
						  	<option value='ZR04'>ZR04 金立非生产物资采购申请(测试部)</option>
						  	<option value='ZR05'>ZR05金立非生产物资采购申请(信息部)</option>
						 </select>
					</td>
				</tr>
				
				<tr class="gaffter">
				  	<td colspan="4" class="formtable_td_key" align="center">设备维修物料清单</td>
				</tr>
				<tr class="gaffter">
				  	<td class="formtable_td_value" colspan="4">
				  		<div>
				  	  		<a class="easyui-linkbutton l-btn" onclick="addAccessory()">
	    						<span class="l-btn-text icon-add l-btn-icon-left">新增</span>
	    					</a>
	    					<a class="easyui-linkbutton l-btn" onclick="removeAccessory()">
	    						<span class="l-btn-text icon-remove l-btn-icon-left">删除</span>
	    						<input type="hidden" id="updateAccessoriesJsonStr${rand}" name="fp_updateMFixedAssetsDetraction"/>
	    					</a>
				  	  	</div>
				  	  	<div style="width:1465px;margin-top:2px;border:solid 1px #95B8E7;">
					  	  	<div style="border-top:solid 1px #666666;">
								<table class="gridtable">
									<thead>
										<tr>
											<td width="1" align="center"><input type="checkbox" class="thchk" /></td>
											<td width="24" align="center">序号</td>
											<td width="45" align="center">科目分配</td>
											<td width="80" align="center">物料编码</td>
											<td width="150" align="center">物料名称及规格</td>
											<td width="60" align="center">申请数量</td>
											<td width="60" align="center">单位</td>
											<!--<td width="125" align="center">工厂</td>-->
											<td width="80" align="center">总账科目</td>
											<td width="125" align="center">成本中心</td>
											<td width="60" align="center">预估单价</td>
											<td width="80" align="center">合计</td>
											<td width="125" align="center">交货日期</td>
											<td width="50" align="center">采购组</td>
											<td width="100" align="center">物料组</td>
											<td width="80" align="center">申请者</td>
											<td width="180" align="center">备注</td>
										</tr>
									</thead>
								</table>
							</div>
							<div style="height:auto;overflow-y:auto;border-top:solid 1px #666666;">
								<table id="updateAccessoryInfoTb${rand}" class="gridtable" style="word-break:break-all; word-wrap:break-all;">
									<tbody>
									</tbody>
								</table>
							</div>
						</div>	
				  	  </td>
				  	</tr>
				  </#if>
				<tr>		  	
		  	  		<td class="formtable_td_key">申请人签字：</td>
		  	  		<td class="formtable_td_value">
		  	  			<input id="updateApplyUserName" class="easyui-validatebox textbox"  name="fp_updateApplyUserName" type="hidden" value="${appuser.name}"/>${appuser.name}
		  	  			<input id="isOffGaffer${rand}" name="fp_isOffGaffer" type="hidden" value="${(steps.vars["isOffGaffer"])!""}"/>
		  	  			<input id="isOffRowCount${rand}" name="fp_isOffRowCount" type="hidden" value="0"/>
		  	  		</td>
		  	  		<td class="formtable_td_key">日期：</td>
		  	  		<td class="formtable_td_value">${.now?string('yyyy-MM-dd HH:mm:ss')}
		  	  			<input   name="fp_updateApplyUserDate" type="hidden" value="${.now?string('yyyy-MM-dd HH:mm:ss')}"/>
		  	  		</td>
		  	  	</tr>
		  	  </table>
			</form>
		</div>
		<style type="text/css">
				table.gridtable {
					font-family: verdana,arial,sans-serif;
					font-size:11px;
					color:#333333;
					border-width: 1px;
					border-color: #666666;
					border-collapse: collapse;
				}
				table.gridtable thead td {
					padding: 4px;
					border-top:solid 1px #666666;
					border-right:solid 1px #666666;
					border-left:solid 1px #666666;
				}
				table.gridtable tbody td {
					padding: 4px;
					border-width: 1px;
					border-style: solid;
					border-color: #666666;
				}
			</style>
	<script type="text/javascript">
		$(function(){
			document.getElementById("moduleName${rand}").value = "";
	    	var str1="";
	    	  $("input[name='fp_updateEquipmentType']").each(function(){
	                if($(this).prop("checked")){
	                    str1 += $(this).val()+",";
	                    document.getElementById("moduleName${rand}").value = str1;
	                }
	            })
			
			$("input[name='fp_updateEquipmentType']").bind("click",function(){
		    	document.getElementById("moduleName${rand}").value = "";
		    	var str="";
		    	  $("input[name='fp_updateEquipmentType']").each(function(){ 
		                if($(this).prop("checked")){
		                    str += $(this).val()+",";
		                    document.getElementById("moduleName${rand}").value = str;
		                }
		            })
		    });	
			
	    	  if('${text}'!=''){
	    		  $("#updateProofType${rand} option[value='${proofType}']").attr("selected", true);
	    		  var json=eval("("+'${text}'+")"); 
					for(var i=0;i<json.accessoryData.length;i++){
						var str = '<tr>';
						str += '<td width="1"><input type="checkbox" class="tdchk" /></td>';
						str += '<td width="24" align="center">' + json.accessoryData[i].rowno + '</td>';
						str += '<td width="45"><select id="courseAllot'+json.accessoryData[i].rowno+'${rand}" style="width:40px;border:solid 1px #007ACC;" onchange="showRequire('+json.accessoryData[i].rowno+')"><option value="" selected="selected"></option><option value="K">K</option></select></td>';
						str += '<td width="80"><input id="stock'+json.accessoryData[i].rowno+'${rand}" type="text" class="easyui-validatebox" style="width:75px;border:solid 1px #007ACC;" onblur="getStockInfo('+json.accessoryData[i].rowno+');" value="'+json.accessoryData[i].stockNumber+'"/></td>';
						str += '<td width="150"><input id="stockNameAndStandard'+json.accessoryData[i].rowno+'${rand}" type="text" class="easyui-validatebox"  style="width:145px;border:solid 1px #007ACC;" value="'+json.accessoryData[i].stockNameAndStandard+'" onblur="makeAccessory()"/></td>';
						str +='<td width="60"><input type="text" class="easyui-numberbox" data-options="required:true" style="width:55px;border:solid 1px #007ACC;" onblur="getAcountIntTotal('+json.accessoryData[i].rowno+');" value="'+json.accessoryData[i].applyNumber+'"/></td>';
						str +='<td width="60"><input id="monad'+json.accessoryData[i].rowno+'${rand}" type="text" class="easyui-validatebox" style="width:55px;border:solid 1px #007ACC;" value="'+json.accessoryData[i].monad+'" onblur="makeAccessory()"/></td>';
						//str +='<td width="125"><input id="factory'+json.accessoryData[i].rowno+'${rand}" type="text" class="easyui-combobox" data-options="required:true" style="width:120px;border:solid 1px #007ACC;" value="'+json.accessoryData[i].factory+'" /></td>';
						str +='<td width="80"><input type="text" class="easyui-validatebox" style="width:75px;border:solid 1px #007ACC;" onblur="makeAccessory()" value="'+json.accessoryData[i].reckoning+'"/></td>';
						str +='<td width="125"><input id="costCenter'+json.accessoryData[i].rowno+'${rand}" type="text" class="easyui-combobox" style="width:120px;border:solid 1px #007ACC;" value="'+json.accessoryData[i].costCenter+'"/></td>';
						str +='<td width="60"><input id="unitPrice'+json.accessoryData[i].rowno+'${rand}" type="text" class="easyui-numberbox" data-options="required:true" style="width:55px;border:solid 1px #007ACC;" onblur="getAcountIntTotal('+json.accessoryData[i].rowno+');" value="'+json.accessoryData[i].unitPrice+'"/></td>';
						str +='<td width="80"><input id="totalAmount'+json.accessoryData[i].rowno+'${rand}" type="text" class="easyui-numberbox" style="width:75px;border:solid 1px #007ACC;" value="'+json.accessoryData[i].amountInTotal+'" readonly/></td>';
						str +='<td width="125"><input type="text" class="easyui-my97" data-options="width:100,required:true,disabled:false,minDate:\'%y-%M-{%d}\',validType:\'reqdate\' " style="width:100px;border:solid 1px #007ACC;" onblur="makeAccessory()" value="'+json.accessoryData[i].deliveryDate+'"/></td>';
						str +='<td width="50"><input id="procurementSection'+json.accessoryData[i].rowno+'${rand}" type="text" class="easyui-validatebox" style="width:45px;border:solid 1px #007ACC;" value="'+json.accessoryData[i].procurementSection+'" onblur="makeAccessory()"/></td>';
						if(json.accessoryData[i].courseAllot=='K'&&(json.accessoryData[i].stockNumber==null||json.accessoryData[i].stockNumber=='')){
							str +='<td width="100"><select id="itemGroup'+json.accessoryData[i].rowno+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getRecoking('+json.accessoryData[i].rowno+');">'
							+'<option value="7001">7001-消防类</option>'
							+'<option value="7002">7002-安全系统类</option>'
							+'<option value="7004">7004-电工维修工具类</option>'
							+'<option value="7005">7005-办公设施类</option>'
							+'<option value="7006">7006-办公用品类</option>'
							+'<option value="7007">7007-生活辅助类</option>'
							+'<option value="7008">7008-安装制作维修类</option>'
							+'<option value="7010" selected="selected">7010-设备维修类</option>'
							+'<option value="7011">7011-手机充值卡类</option>'
							+'<option value="7012">7012-手机测试卡类</option>'
							+'<option value="7014">7014-培训物资类</option>'
						+' </select></td>';
						}else{
							str +='<td width="100"><input id="itemGroup'+json.accessoryData[i].rowno+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+json.accessoryData[i].itemGroup+'" onblur="makeAccessory()"/></td>';
						}
						str +='<td width="80"><input type="text" class="easyui-validatebox" data-options="required:true" style="width:75px;border:solid 1px #007ACC;" onblur="makeAccessory()" value="'+json.accessoryData[i].applyName+'"/></td>';
						str +='<td width="180"><input type="text" class="easyui-validatebox" style="width:175px;border:solid 1px #007ACC;" onblur="makeAccessory()" value="'+json.accessoryData[i].remark+'"/></td>';
						str += '</tr>';
						$("#isOffRowCount${rand}").val(i+1);
					
						$('#updateAccessoryInfoTb${rand} tbody').append(str);
						//$.parser.parse($('#updateAccessoryInfoTb${rand}').parent());
						$.parser.parse($('#updateAccessoryInfoTb${rand}').find("tr").eq(json.accessoryData[i].rowno));
						
						/*$("#unitPrice"+rowno+"${rand}").numberbox({
						    precision:3
						});
				    	
				    	$("#totalAmount"+rowno+"${rand}").numberbox({
						    precision:3
						});*/
				    	
						if(json.accessoryData[i].courseAllot=='K'){
							$("#stock"+rowno+"${rand}").validatebox({required:false});
							if(json.accessoryData[i].stockNumber==null||json.accessoryData[i].stockNumber==''){
								$("#itemGroup"+json.accessoryData[i].rowno+"${rand} option[value='"+json.accessoryData[i].itemGroup+"']").attr("selected", true); 
							}
						}
						$("#courseAllot"+json.accessoryData[i].rowno+"${rand} option[value='"+json.accessoryData[i].courseAllot+"']").attr("selected", true); 
					}
					var rows = $('#updateAccessoryInfoTb${rand} tbody tr');
					if(rows.length == 0) {		
						$('#updateAccessoriesJsonStr${rand}').val('');
					} else {				
		        		$('#updateAccessoryInfoTb${rand} tbody tr').each(function () {
		        			var courseAllot1=$.trim($(this).find('td').eq(2).find("input").val());
		        			var costCenter1 = $(this).find('td').eq(8).find("input");
		        			var unitPrice = $(this).find('td').eq(9).find("input");
		        			var amountInTotal = $(this).find('td').eq(10).find("input");
		        			var itemGroup1=null;
		        			unitPrice.numberbox({
		    				    precision:3
		    				});
		    		    	
		        			amountInTotal.numberbox({
		    				    precision:3
		    				});
		        			if(courseAllot1=='K'&&(stock1==null||stock1=='')){
		        				itemGroup1 =$(this).find('td').eq(13);
		        			}else{
		        				itemGroup1 =$(this).find('td').eq(13).find("input");
		        			}
		        			
		        			costCenter1.combobox({
	    						valueField : 'id',
	    						textField : 'text',
	    						//required : true,
	    						editable : false,
	    						onSelect : function(record) {
	    							makeAccessory();
	    							//$("#costCenterName${rand}").val(record.text);
	    							//$('#costCenterId${rand}').val(record.id);
	    						},onLoadSuccess:function(){
	    							costCenter1.combobox('setValue',costCenter1.val());
	    						}
	    					});
		        			
		    				$.get('hrFlow/getSapCostCenter.json', {
		    					factory:$("#factory${rand}").val()
		    				}, function(data) {
		    					costCenter1.combobox("clear")
		    							.combobox('loadData', data);
		    				}, 'json');
		    					
		        		});
					}
		    		//makeAccessory();
		    		var rows = $('#updateAccessoryInfoTb${rand} tbody tr');
					if(rows.length == 0) {		
						$('#updateAccessoriesJsonStr${rand}').val('');
					} else {				
						var MFixedAssetsDetraction = { accessoryData:[] };
						var rowno = 1;
		        		$('#updateAccessoryInfoTb${rand} tbody tr').each(function () {	        			
		        			var courseAllot = $.trim($(this).find('td').eq(2).find("select").val());
		        			var stockNumber = $.trim($(this).find('td').eq(3).find("input").val());
		        			var stockNameAndStandard = $.trim($(this).find('td').eq(4).find("input").val());
		        			var applyNumber = $.trim($(this).find('td').eq(5).find("input").val());
		        			var monad = $.trim($(this).find('td').eq(6).find("input").val());
		        			//var factory = $.trim($(this).find('td').eq(7).find("input").val());
		        			var reckoning = $.trim($(this).find('td').eq(7).find("input").val());
		        			var costCenter = $.trim($(this).find('td').eq(8).find("input").val());
		        			var unitPrice = $.trim($(this).find('td').eq(9).find("input").numberbox("getValue"));
		        			var amountInTotal = $.trim($(this).find('td').eq(10).find("input").numberbox("getValue"));
		        			var deliveryDate = $.trim($(this).find('td').eq(11).find("input").val());
		        			var procurementSection = $.trim($(this).find('td').eq(12).find("input").val());
		        			var itemGroup='';
		        			if(courseAllot=='K'&&(stockNumber==null||stockNumber=='')){
		        				itemGroup = $.trim($(this).find('td').eq(13).find("select").val());
		        			}else{
		        				itemGroup = $.trim($(this).find('td').eq(13).find("input").val());
		        			}
		        			var applyName = $.trim($(this).find('td').eq(14).find("input").val());
		        			var remark = $.trim($(this).find('td').eq(15).find("input").val());
		        		
		        			MFixedAssetsDetraction.accessoryData.push({
		        				rowno:rowno,courseAllot:courseAllot,stockNumber:stockNumber,stockNameAndStandard:stockNameAndStandard,applyNumber:applyNumber,monad:monad,reckoning:reckoning,costCenter:costCenter,unitPrice:unitPrice,amountInTotal:amountInTotal,deliveryDate:deliveryDate,procurementSection:procurementSection,itemGroup:itemGroup,applyName:applyName,remark:remark
		        			})
		        			rowno++;
		        		});
		        		
		        		$('#updateAccessoriesJsonStr${rand}').val(JSON.stringify(MFixedAssetsDetraction));
					}
	    	  }
			    
				$('.thchk').each(function(){ 
					$(this).click(function(){ 
						if($(this).prop('checked')){
							$('.tdchk').prop("checked", true);
						} else {
							$('.tdchk').prop("checked", false);
						} 	
					});
				});
		});
		
		$("#factory${rand}").combobox({
			onChange:function(n,o){
				if(n=='2000'){
					$("#factoryName${rand}").val('东莞市金铭电子有限公司');
				}
				if(n=='3000'){
					$("#factoryName${rand}").val('东莞金卓通信科技有限公司');
				}
				if(n!=''){
					$('#updateAccessoryInfoTb${rand} tbody tr').each(function () {
						var courseAllot = $.trim($(this).find('td').eq(2).find("select").val());
						var stockNumber = $.trim($(this).find('td').eq(3).find("input").val());
		    			var stockNameAndStandard = $(this).find('td').eq(4).find("input");
		    			var monad = $(this).find('td').eq(6).find("input");
		    			var reckoning = $(this).find('td').eq(7).find("input");
		    			var costCenter = $(this).find('td').eq(8).find("input");
		    			var procurementSection = $(this).find('td').eq(12).find("input");
		    			var itemGroup=$(this).find('td').eq(13);
		    			
		    			$.get('hrFlow/getSapCostCenter.json', {
							factory:n
						}, function(data) {
							costCenter.val('');
							costCenter.combobox('loadData', data);
						}, 'json');
		    			
		    			if(stockNumber!=null&&stockNumber!=''){
		    				//根据工厂、物料编号获取非生产物资数据
							$.get("hrFlow/getStockInfo.json",{
								functionName:'ZHR_OA46',vars:'I_MATNR_VALUE_'+stockNumber+'_NEXT_I_WERKS_VALUE_'+n,exportTableName:'E_MATNR',
								exportlist:'MAKTX_NEXT_MEINS_NEXT_EKGRP_NEXT_MATKL'
							},function(data){
								var jsondata=eval("("+data+")");
								if(jsondata.MAKTX=='' && jsondata.MEINS=='' && jsondata.EKGRP=='' && jsondata.MATKL==''){
									$.messager.alert("提示信息","您好，此编号的非生产物资不存在!");
									$("#stock"+rowno+"${rand}").val('');
								}
								stockNameAndStandard.val(jsondata.MAKTX);
								monad.val(jsondata.MEINS);
								procurementSection.val(jsondata.EKGRP);
								//if(courseAllot=='K'){
									if(jsondata.MATKL=='7001'||jsondata.MATKL=='7010'){
										reckoning.val('6598000059');
									}else if(jsondata.MATKL=='7011'||jsondata.MATKL=='7014'){
										reckoning.val('6598000022');
									}else if(jsondata.MATKL=='7509'){
										reckoning.val('6598000086');
									}else if(jsondata.MATKL=='7510'){
										reckoning.val('6598000087');
									}else if(jsondata.MATKL=='7511'){
										reckoning.val('6598000088');
									}else{
										reckoning.val('6598000033');
									}
								if(courseAllot=='K'){
									itemGroup.html('<input id="itemGroup'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+jsondata.MATKL+'" onblur="makeAccessory();"/>')
								}else{
									itemGroup.find("input").val(jsondata.MATKL);
								}
								makeAccessory();
							});
		    			}
					});
				}
			}
		});
		
		function addAccessory() {
			var rows = $('#updateAccessoryInfoTb${rand} tbody tr'); 
			var rowno = rows.length + 1;
			var str = '<tr>';
			str += '<td width="1"><input type="checkbox" class="tdchk" /></td>';
			str += '<td width="24" align="center">' + rowno + '</td>';
			str += '<td width="45"><select id="courseAllot'+rowno+'${rand}" style="width:40px;border:solid 1px #007ACC;" onchange="showRequire('+rowno+')"><option value=""></option><option value="K" selected="selected">K</option></select></td>';
			str += '<td width="80"><input id="stock'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:75px;border:solid 1px #007ACC;" onblur="getStockInfo('+rowno+');"/></td>';
			str += '<td width="150"><input id="stockNameAndStandard'+rowno+'${rand}" type="text" class="easyui-validatebox" data-options="required:true" style="width:145px;border:solid 1px #007ACC;" onblur="makeAccessory()"/></td>';
			str +='<td width="60"><input type="text" class="easyui-numberbox" data-options="required:true" style="width:55px;border:solid 1px #007ACC;" onblur="getAcountIntTotal('+rowno+');"/></td>';
			str +='<td width="60"><input id="monad'+rowno+'${rand}" type="text" class="easyui-validatebox" data-options="required:true" style="width:55px;border:solid 1px #007ACC;" onblur="makeAccessory()"/></td>';
			//str +='<td width="125"><input id="factory'+rowno+'${rand}" type="text" class="easyui-combobox" data-options="required:true" style="width:120px;border:solid 1px #007ACC;" onblur="makeAccessory()"/></td>';
			str +='<td width="80"><input type="text" id="reckoning'+rowno+'${rand}" class="easyui-validatebox" style="width:75px;border:solid 1px #007ACC;" value="6598000059" onblur="makeAccessory()"/></td>';
			str +='<td width="125"><input id="costCenter'+rowno+'${rand}" type="text" class="easyui-combobox" style="width:120px;border:solid 1px #007ACC;"/></td>';
			str +='<td width="60"><input id="unitPrice'+rowno+'${rand}" type="text" class="easyui-numberbox" data-options="required:true" style="width:55px;border:solid 1px #007ACC;" onblur="getAcountIntTotal('+rowno+');"/></td>';
			str +='<td width="80"><input id="totalAmount'+rowno+'${rand}" type="text" class="easyui-numberbox" style="width:75px;border:solid 1px #007ACC;" readonly/></td>';
			str +='<td width="125"><input type="text" class="easyui-my97" data-options="width:100,required:true,disabled:false,minDate:\'%y-%M-{%d}\',validType:\'reqdate\' " style="width:100px;border:solid 1px #007ACC;" onblur="makeAccessory()"/></td>';
			str +='<td width="50"><input id="procurementSection'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:45px;border:solid 1px #007ACC;" value="006" onblur="makeAccessory()"/></td>';
			str +='<td width="100"><select id="itemGroup'+rowno+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getRecoking('+rowno+');">'
				+'<option value="7001">7001-消防类</option>'
				+'<option value="7002">7002-安全系统类</option>'
				+'<option value="7004">7004-电工维修工具类</option>'
				+'<option value="7005">7005-办公设施类</option>'
				+'<option value="7006">7006-办公用品类</option>'
				+'<option value="7007">7007-生活辅助类</option>'
				+'<option value="7008">7008-安装制作维修类</option>'
				+'<option value="7010" selected="selected">7010-设备维修类</option>'
				+'<option value="7011">7011-手机充值卡类</option>'
				+'<option value="7012">7012-手机测试卡类</option>'
				+'<option value="7014">7014-培训物资类</option>'
				+'</select></td>';
			str +='<td width="80"><input type="text" class="easyui-validatebox" data-options="required:true" style="width:75px;border:solid 1px #007ACC;" onblur="makeAccessory()"/></td>';
			str +='<td width="180"><input type="text" class="easyui-validatebox" style="width:175px;border:solid 1px #007ACC;" onblur="makeAccessory()"/></td>';
			str += '</tr>';
	    	$('#updateAccessoryInfoTb${rand} tbody').append(str);
	    	$.parser.parse($('#updateAccessoryInfoTb${rand}').find("tr").eq(-1));
	    	$("#isOffRowCount${rand}").val(rowno);
	    	
	    	$("#unitPrice"+rowno+"${rand}").numberbox({
			    precision:3
			});
	    	
	    	$("#totalAmount"+rowno+"${rand}").numberbox({
			    precision:3
			});
	    	
	    	var costCenter=$("#costCenter"+rowno+"${rand}");
	    	
	    	costCenter.combobox({
				valueField : 'id',
				textField : 'text',
				//required : true,
				editable : false,
				onSelect : function(record) {
					makeAccessory();
					//$("#costCenterName${rand}").val(record.text);
					//$('#costCenterId${rand}').val(record.id);
				}
			});
	    	
	    	var courseAllot=$("#courseAllot"+rowno+"${rand}").val();
			var stock=$("#stock"+rowno+"${rand}").val();
			var stockNameAndStandard=$("#stockNameAndStandard"+rowno+"${rand}");
			var monad=$("#monad"+rowno+"${rand}");
			var reckoning=$("#reckoning"+rowno+"${rand}");
			var procurementSection=$("#procurementSection"+rowno+"${rand}");
			var itemGroup=$("#itemGroup"+rowno+"${rand}");
	    	var factory=$("#factory${rand}").combobox("getValue");
	    	if(factory!=null&&factory!=''&&factory!=undefined){
	    		$.get('hrFlow/getSapCostCenter.json', {
					factory:factory
				}, function(data) {
					costCenter.combobox("clear")
							.combobox('loadData', data);
				}, 'json');
	    		
	    		if(stock==null || stock==''){
					return;
				}
				//根据工厂、物料编号获取非生产物资数据
				$.get("hrFlow/getStockInfo.json",{
					functionName:'ZHR_OA46',vars:'I_MATNR_VALUE_'+stock+'_NEXT_I_WERKS_VALUE_'+factory,exportTableName:'E_MATNR',
					exportlist:'MAKTX_NEXT_MEINS_NEXT_EKGRP_NEXT_MATKL'
				},function(data){
					var jsondata=eval("("+data+")");
					if(jsondata.MAKTX=='' && jsondata.MEINS=='' && jsondata.EKGRP=='' && jsondata.MATKL==''){
						$.messager.alert("提示信息","您好，此编号的非生产物资不存在!");
						$("#stock"+rowno+"${rand}").val('');
					}
					stockNameAndStandard.val(jsondata.MAKTX);
					monad.val(jsondata.MEINS);
					procurementSection.val(jsondata.EKGRP);
					//if(courseAllot=='K'){
						if(jsondata.MATKL=='7001'||jsondata.MATKL=='7010'){
							reckoning.val('6598000059');
						}else if(jsondata.MATKL=='7011'||jsondata.MATKL=='7014'){
							reckoning.val('6598000022');
						}else if(jsondata.MATKL=='7509'){
							reckoning.val('6598000086');
						}else if(jsondata.MATKL=='7510'){
							reckoning.val('6598000087');
						}else if(jsondata.MATKL=='7511'){
							reckoning.val('6598000088');
						}else{
							reckoning.val('6598000033');
						}
					if(courseAllot=='K'){
						itemGroup.parent().html('<input id="itemGroup'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+jsondata.MATKL+'" onblur="makeAccessory()"/>');
					}else{
						itemGroup.val(jsondata.MATKL);
					}
	    	});
				}
		}
		
		function showRequire(n){
			var courseAllot = $.trim($("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(2).find("select").val());
			var stock=$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(3).find("input");
			var stockNameAndStandard=$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(4).find("input");
			var monad=$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(6).find("input");
			//var factory=$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(7).find("input");
			var roging=$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(7).find("input");
			//var costCenter=$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(9);
			var procurementSection=$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(12).find("input");
			var itemGroup=$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(13);
			roging.val('');
			if(courseAllot=='K'){
				stock.validatebox({required:false});
				stockNameAndStandard.validatebox({required:true});
				monad.validatebox({required:true});
				roging.validatebox({required:true});
				procurementSection.validatebox({required:true});
				//costCenter.html('<input id="costCenter'+n+'${rand}" type="text" class="easyui-combobox" data-options="valueField : \'id\',textField : \'text\',required : true,editable : false,onSelect : function(record) {makeAccessory();}" style="width:120px;border:solid 1px #007ACC;"/>');
				//roging.val('6598000059');
				if(stock.val()==null || stock.val()==''){
					itemGroup.html('<select id="itemGroup'+n+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getRecoking('+n+');">'
							+'<option value="7001">7001-消防类</option>'
							+'<option value="7002">7002-安全系统类</option>'
							+'<option value="7004">7004-电工维修工具类</option>'
							+'<option value="7005">7005-办公设施类</option>'
							+'<option value="7006">7006-办公用品类</option>'
							+'<option value="7007">7007-生活辅助类</option>'
							+'<option value="7008">7008-安装制作维修类</option>'
							+'<option value="7010" selected="selected">7010-设备维修类</option>'
							+'<option value="7011">7011-手机充值卡类</option>'
							+'<option value="7012">7012-手机测试卡类</option>'
							+'<option value="7014">7014-培训物资类</option>'
						+' </select>');
					roging.val('6598000059');
				}
			}else{
				//roging.val('');
				stock.validatebox({required:true});
				stockNameAndStandard.validatebox({required:false});
				monad.validatebox({required:false});
				roging.validatebox({required:false});
				procurementSection.validatebox({required:false});
				//costCenter.html('<input id="costCenter'+n+'${rand}" type="text" class="easyui-combobox" data-options="valueField : \'id\',textField : \'text\',required : false,editable : false,onSelect : function(record) {makeAccessory();}" style="width:120px;border:solid 1px #007ACC;"/>');
				itemGroup.html('<input id="itemGroup'+n+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" onblur="makeAccessory();"/>');
			}
			$.parser.parse($('#updateAccessoryInfoTb${rand}').find("tr").eq(n-1));
			makeAccessory();
		}
		
		function getRecoking(n){
			var itemGroup = $.trim($("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(13).find("select").val());
			var reckoning=$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(7).find("input");
			if(itemGroup=='7001'||itemGroup=='7010'){
				reckoning.val('6598000059');
			}else if(itemGroup=='7011'||itemGroup=='7014'){
				reckoning.val('6598000022');
			}else if(itemGroup=='7509'){
				reckoning.val('6598000086');
			}else if(itemGroup=='7510'){
				reckoning.val('6598000087');
			}else if(itemGroup=='7511'){
				reckoning.val('6598000088');
			}else{
				reckoning.val('6598000033');
			}
			makeAccessory();
		}
		
		function removeAccessory() {
	    	var rows = $('#updateAccessoryInfoTb${rand} tbody tr input[type="checkbox"]:checked');
            if (rows.length == 0) {
        		$.messager.alert("操作提示", "请至少选择一条数据", "info");
        		return false;
            }

            $.each(rows, function () {        
                $(this).parent("td").parent("tr").remove();
            });
            var MFixedAssetsDetraction = { accessoryData:[] };
            var accessoryArr = [];
            var rows=1;
    		$('#updateAccessoryInfoTb${rand} tbody tr').each(function () {
    			var courseAllot = $.trim($(this).find('td').eq(2).find("select").val());
    			var stockNumber = $.trim($(this).find('td').eq(3).find("input").val());
    			var stockNameAndStandard = $.trim($(this).find('td').eq(4).find("input").val());
    			var applyNumber = $.trim($(this).find('td').eq(5).find("input").numberbox("getValue"));
    			var monad = $.trim($(this).find('td').eq(6).find("input").val());
    			//var factory = $.trim($(this).find('td').eq(7).find("input").combotree("getText"));
    			var reckoning = $.trim($(this).find('td').eq(7).find("input").val());
    			var costCenter = $.trim($(this).find('td').eq(8).find("input").combotree("getText"));
    			var unitPrice = $.trim($(this).find('td').eq(9).find("input").numberbox("getValue"));
    			var amountInTotal = $.trim($(this).find('td').eq(10).find("input").numberbox("getValue"));
    			var deliveryDate = $.trim($(this).find('td').eq(11).find("input").val());
    			var procurementSection = $.trim($(this).find('td').eq(12).find("input").val());
    			var itemGroup='';
    			if(courseAllot=='K' && (stockNumber==null || stockNumber=='')){
    				itemGroup = $.trim($(this).find('td').eq(13).find("select").val());
    			}else{
    				itemGroup = $.trim($(this).find('td').eq(13).find("input").val());
    			}
    			var applyName = $.trim($(this).find('td').eq(14).find("input").val());
    			var remark = $.trim($(this).find('td').eq(15).find("input").val());
    			accessoryArr.push({
    				courseAllot:courseAllot,stockNumber:stockNumber,stockNameAndStandard:stockNameAndStandard,applyNumber:applyNumber,monad:monad,reckoning:reckoning,costCenter:costCenter,unitPrice:unitPrice,amountInTotal:amountInTotal,deliveryDate:deliveryDate,procurementSection:procurementSection,itemGroup:itemGroup,applyName:applyName,remark:remark
    			});
    			MFixedAssetsDetraction.accessoryData.push({
    				rowno:rows,courseAllot:courseAllot,stockNumber:stockNumber,stockNameAndStandard:stockNameAndStandard,applyNumber:applyNumber,monad:monad,reckoning:reckoning,costCenter:costCenter,unitPrice:unitPrice,amountInTotal:amountInTotal,deliveryDate:deliveryDate,procurementSection:procurementSection,itemGroup:itemGroup,applyName:applyName,remark:remark
    			})
    			rows++;
    		});
    		$('#updateAccessoriesJsonStr${rand}').val(JSON.stringify(MFixedAssetsDetraction));

        	var rowno = 1;
        	$("#updateAccessoryInfoTb${rand} tbody").empty();
    		$.each(accessoryArr, function(idx, obj) {
    			var str = '<tr>';
				str += '<td width="1"><input type="checkbox" class="tdchk" /></td>';
				str += '<td width="24" align="center">' + rowno + '</td>';
				str += '<td width="45"><select id="courseAllot'+rowno+'${rand}" style="width:40px;border:solid 1px #007ACC;" onchange="showRequire('+rowno+')"><option value="" selected="selected"></option><option value="K">K</option></select></td>';
				str += '<td width="80"><input id="stock'+rowno+'${rand}" type="text" class="easyui-validatebox" data-options="required:true" style="width:75px;border:solid 1px #007ACC;" onblur="getStockInfo('+rowno+');" value="'+obj.stockNumber+'"/></td>';
				str += '<td width="150"><input id="stockNameAndStandard'+rowno+'${rand}" type="text" class="easyui-validatebox"  style="width:145px;border:solid 1px #007ACC;" value="'+obj.stockNameAndStandard+'" onblur="makeAccessory()"/></td>';
				str +='<td width="60"><input type="text" class="easyui-numberbox" data-options="required:true" style="width:55px;border:solid 1px #007ACC;" onblur="getAcountIntTotal('+rowno+');" value="'+obj.applyNumber+'"/></td>';
				str +='<td width="60"><input id="monad'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:55px;border:solid 1px #007ACC;" value="'+obj.monad+'" onblur="makeAccessory()"/></td>';
				//str +='<td width="125"><input id="factory'+rowno+'${rand}" type="text" data-options="required:true" style="width:120px;border:solid 1px #007ACC;" value="'+obj.factory+'" /></td>';
				str +='<td width="80"><input id="totalAllot'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:75px;border:solid 1px #007ACC;" onblur="makeAccessory()" value="'+obj.reckoning+'"/></td>';
				str +='<td width="125"><input id="costCenter'+rowno+'${rand}" type="text" style="width:120px;border:solid 1px #007ACC;" value="'+obj.costCenter+'"/></td>';
				str +='<td width="60"><input id="unitPrice'+rowno+'${rand}" type="text" class="easyui-numberbox" data-options="required:true" precision="3" style="width:55px;border:solid 1px #007ACC;" onblur="getAcountIntTotal('+rowno+');" value="'+obj.unitPrice+'"/></td>';
				str +='<td width="80"><input id="totalAmount'+rowno+'${rand}" type="text" class="easyui-numberbox" precision="3" style="width:75px;border:solid 1px #007ACC;" value="'+obj.amountInTotal+'" readonly/></td>';
				str +='<td width="125"><input type="text" class="easyui-my97" data-options="width:100,required:true,disabled:false,minDate:\'%y-%M-{%d}\',validType:\'reqdate\' " style="width:100px;border:solid 1px #007ACC;" onblur="makeAccessory()" value="'+obj.deliveryDate+'"/></td>';
				str +='<td width="50"><input id="procurementSection'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:45px;border:solid 1px #007ACC;" value="'+obj.procurementSection+'" onblur="makeAccessory()"/></td>';
				if(obj.courseAllot=='K'&&(obj.stockNumber==null||obj.stockNumber=='')){
					str +='<td width="100"><select id="itemGroup'+rowno+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getRecoking('+rowno+');">'
					+'<option value="7001">7001-消防类</option>'
					+'<option value="7002">7002-安全系统类</option>'
					+'<option value="7004">7004-电工维修工具类</option>'
					+'<option value="7005">7005-办公设施类</option>'
					+'<option value="7006">7006-办公用品类</option>'
					+'<option value="7007">7007-生活辅助类</option>'
					+'<option value="7008">7008-安装制作维修类</option>'
					+'<option value="7010" selected="selected">7010-设备维修类</option>'
					+'<option value="7011">7011-手机充值卡类</option>'
					+'<option value="7012">7012-手机测试卡类</option>'
					+'<option value="7014">7014-培训物资类</option>'
				+' </select></td>';
				}else{
					str +='<td width="100"><input id="itemGroup'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+obj.itemGroup+'" onblur="makeAccessory()"/></td>';
				}
				str +='<td width="80"><input type="text" class="easyui-validatebox" data-options="required:true" style="width:75px;border:solid 1px #007ACC;" onblur="makeAccessory()" value="'+obj.applyName+'"/></td>';
				str +='<td width="180"><input type="text" class="easyui-validatebox" style="width:175px;border:solid 1px #007ACC;" onblur="makeAccessory()" value="'+obj.remark+'"/></td>';
				str += '</tr>';
			
				$('#updateAccessoryInfoTb${rand} tbody').append(str);
				//$.parser.parse($('#updateAccessoryInfoTb${rand}').parent());
				$.parser.parse($('#updateAccessoryInfoTb${rand}').find("tr").eq(rowno-1));
				
				/*$("#unitPrice"+rowno+"${rand}").numberbox({
				    precision:3
				});
		    	
		    	$("#totalAmount"+rowno+"${rand}").numberbox({
				    precision:3
				});*/
		    	
				if(obj.courseAllot=='K'){
					$("#stock"+rowno+"${rand}").validatebox({required:false});
					$("#stockNameAndStandard"+rowno+"${rand}").validatebox({required:true});
					$("#monad"+rowno+"${rand}").validatebox({required:true});
					$("#totalAllot"+rowno+"${rand}").validatebox({required:true});
					if(obj.stockNumber==null||obj.stockNumber==''){
						$("#itemGroup"+rowno+"${rand} option[value='"+obj.itemGroup+"']").attr("selected", true);
					}
				}
				$("#courseAllot"+rowno+"${rand} option[value='"+obj.courseAllot+"']").attr("selected", true);     		    	
    			rowno++;
    		});
    		var rows = $('#updateAccessoryInfoTb${rand} tbody tr');
			if(rows.length == 0) {		
				$('#updateAccessoryInfoTb${rand}').val('');
			} else {				
        		$('#updateAccessoryInfoTb${rand} tbody tr').each(function () {
        			var row=$.trim($(this).find('td').eq(1).find("input").val());
        			var courseAllot1=$.trim($(this).find('td').eq(2).find("input").val());
        			var stock1 = $(this).find('td').eq(3).find("input");
        			var stockNameAndStandard1 =$(this).find('td').eq(4).find("input");
        			var monad1 = $(this).find('td').eq(6).find("input");
        			//var factory1 = $(this).find('td').eq(7).find("input");
        			var reckoning=$(this).find('td').eq(7).find("input");
        			var costCenter1 = $(this).find('td').eq(8).find("input");
        			//var unitPrice = $(this).find('td').eq(10).find("input");
        			//var amountInTotal = $(this).find('td').eq(11).find("input");
        			var procurementSection1 =$(this).find('td').eq(12).find("input");
        			var itemGroup1=null;
        			/*unitPrice.numberbox({
    				    precision:3
    				});
    		    	
        			amountInTotal.numberbox({
    				    precision:3
    				});*/
        			if(courseAllot1=='K'&&(stock1==null||stock1=='')){
        				itemGroup1 =$(this).find('td').eq(13);
        			}else{
        				itemGroup1 =$(this).find('td').eq(13).find("input");
        			}
    				
    				costCenter1.combobox({
						valueField : 'id',
						textField : 'text',
						//required : true,
						editable : false,
						onSelect : function(record) {
							makeAccessory();
							//$("#costCenterName${rand}").val(record.text);
							//$('#costCenterId${rand}').val(record.id);
						},onLoadSuccess:function(){
							costCenter1.combobox('setValue',costCenter1.val());
						}
					});
    				
    				$.get('hrFlow/getSapCostCenter.json', {
    					factory:$("#factory${rand}").combobox("getValue")
    				}, function(data) {
    					costCenter1.combobox('loadData', data);
    				}, 'json');
    				
    				if(stock1.val()==null || stock1.val()==''){
						return;
					}
					//根据工厂、物料编号获取非生产物资数据
					$.get("hrFlow/getStockInfo.json",{
						functionName:'ZHR_OA46',vars:'I_MATNR_VALUE_'+stock1.val()+'_NEXT_I_WERKS_VALUE_'+$("#factory${rand}").combobox("getValue"),exportTableName:'E_MATNR',
						exportlist:'MAKTX_NEXT_MEINS_NEXT_EKGRP_NEXT_MATKL'
					},function(data){
						var jsondata=eval("("+data+")");
						if(jsondata.MAKTX=='' && jsondata.MEINS=='' && jsondata.EKGRP=='' && jsondata.MATKL==''){
							$.messager.alert("提示信息","您好，此编号的非生产物资不存在!");
							$(this).find('td').eq(3).find("input").val('');
						}
						stockNameAndStandard1.val(jsondata.MAKTX);
						monad1.val(jsondata.MEINS);
						procurementSection1.val(jsondata.EKGRP);
						//if(courseAllot1=='K'){
							if(jsondata.MATKL=='7001'||jsondata.MATKL=='7010'){
								reckoning.val('6598000059');
							}else if(jsondata.MATKL=='7011'||jsondata.MATKL=='7014'){
								reckoning.val('6598000022');
							}else if(jsondata.MATKL=='7509'){
								reckoning.val('6598000086');
							}else if(jsondata.MATKL=='7510'){
								reckoning.val('6598000087');
							}else if(jsondata.MATKL=='7511'){
								reckoning.val('6598000088');
							}else{
								reckoning.val('6598000033');
							}
						if(courseAllot1=='K'){
							itemGroup1.html('<input id="itemGroup'+row+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+jsondata.MATKL+'" onblur="makeAccessory()"/>');
						}else{
							itemGroup1.val(jsondata.MATKL);
						}
					});
        		});
			}
    		//$('#updateAccessoryInfoTb${rand} tbody').append($('#updateAccessoryInfoTb${rand} tbody tr'));
    		//$.parser.parse($('#updateAccessoryInfoTb${rand}').parent());
    		$("#isOffRowCount${rand}").val($('#updateAccessoryInfoTb${rand} tbody tr').length);
    		//makeAccessory();
		}
		
		function makeAccessory() {
			var rows = $('#updateAccessoryInfoTb${rand} tbody tr');
			if(rows.length == 0) {		
				$('#updateAccessoriesJsonStr${rand}').val('');
			} else {				
				var MFixedAssetsDetraction = { accessoryData:[] };
				var rowno = 1;
        		$('#updateAccessoryInfoTb${rand} tbody tr').each(function () {	        			
        			var courseAllot = $.trim($(this).find('td').eq(2).find("select").val());
        			var stockNumber = $.trim($(this).find('td').eq(3).find("input").val());
        			var stockNameAndStandard = $.trim($(this).find('td').eq(4).find("input").val());
        			var applyNumber = $.trim($(this).find('td').eq(5).find("input").numberbox("getValue"));
        			var monad = $.trim($(this).find('td').eq(6).find("input").val());
        			//var factory = $.trim($(this).find('td').eq(7).find("input").combotree("getText"));
        			var reckoning = $.trim($(this).find('td').eq(7).find("input").val());
        			var costCenter = $.trim($(this).find('td').eq(8).find("input").combotree("getText"));
        			var unitPrice = $.trim($(this).find('td').eq(9).find("input").val());
        			var amountInTotal = $.trim($(this).find('td').eq(10).find("input").numberbox("getValue"));
        			var deliveryDate = $.trim($(this).find('td').eq(11).find("input").val());
        			var procurementSection = $.trim($(this).find('td').eq(12).find("input").val());
        			var itemGroup='';
        			if(courseAllot=='K'&&(stockNumber==null||stockNumber=='')){
        				itemGroup = $.trim($(this).find('td').eq(13).find("select").val());
        			}else{
        				itemGroup = $.trim($(this).find('td').eq(13).find("input").val());
        			}
        			var applyName = $.trim($(this).find('td').eq(14).find("input").val());
        			var remark = $.trim($(this).find('td').eq(15).find("input").val());
        		
        			MFixedAssetsDetraction.accessoryData.push({
        				rowno:rowno,courseAllot:courseAllot,stockNumber:stockNumber,stockNameAndStandard:stockNameAndStandard,applyNumber:applyNumber,monad:monad,reckoning:reckoning,costCenter:costCenter,unitPrice:unitPrice,amountInTotal:amountInTotal,deliveryDate:deliveryDate,procurementSection:procurementSection,itemGroup:itemGroup,applyName:applyName,remark:remark
        			})
        			rowno++;
        		});
        		
        		$('#updateAccessoriesJsonStr${rand}').val(JSON.stringify(MFixedAssetsDetraction));
			}
		}
		function getStockInfo(n){
			var courseAllot=$.trim($("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(2).find("select").val());
			var stock=$.trim($("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(3).find("input").val());
			//var factory=$.trim($("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(7).find("input").combobox('getValue'));
			var reckoning=$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(7).find("input");
			var stockNameAndStandard=$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(4).find("input");
			var monad=$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(6).find("input");
			var procurementSection=$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(12).find("input");
			var itemGroup=null;
			if(courseAllot=='K'){
				itemGroup=$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(13)
			}else{
				itemGroup=$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(13).find("input");
			}
			
			if(stock==null || stock==''){
				if(courseAllot=='K'){
					itemGroup.html('<select id="itemGroup'+n+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getRecoking('+n+');">'
							+'<option value="7001">7001-消防类</option>'
							+'<option value="7002">7002-安全系统类</option>'
							+'<option value="7004">7004-电工维修工具类</option>'
							+'<option value="7005">7005-办公设施类</option>'
							+'<option value="7006">7006-办公用品类</option>'
							+'<option value="7007">7007-生活辅助类</option>'
							+'<option value="7008">7008-安装制作维修类</option>'
							+'<option value="7010" selected="selected">7010-设备维修类</option>'
							+'<option value="7011">7011-手机充值卡类</option>'
							+'<option value="7012">7012-手机测试卡类</option>'
							+'<option value="7014">7014-培训物资类</option>'
						+' </select>');
					reckoning.val('');
				}
				return;
			}
			//根据工厂、物料编号获取非生产物资数据
			$.ajax({
		           type: "post",
		           url: "hrFlow/getStockInfo.json",
		           cache: false,
		           async: false,  //设置同步
		           dataType: "json",
		           data: {functionName:'ZHR_OA46',vars:'I_MATNR_VALUE_'+stock+'_NEXT_I_WERKS_VALUE_'+$("#factory${rand}").combobox("getValue"),exportTableName:'E_MATNR',
						exportlist:'MAKTX_NEXT_MEINS_NEXT_EKGRP_NEXT_MATKL'},
		           success: function (data) {
		            	var jsondata=eval("("+data+")");
		            	if(jsondata.MAKTX=='' && jsondata.MEINS=='' && jsondata.EKGRP=='' && jsondata.MATKL==''){
							$.messager.alert("提示信息","您好，此编号的非生产物资不存在!");
							$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(3).find("input").val('');
						}
		            	stockNameAndStandard.val(jsondata.MAKTX);
						monad.val(jsondata.MEINS);
						procurementSection.val(jsondata.EKGRP);
						//if(courseAllot=='K'){
							if(jsondata.MATKL=='7001'||jsondata.MATKL=='7010'){
								reckoning.val('6598000059');
							}else if(jsondata.MATKL=='7011'||jsondata.MATKL=='7014'){
								reckoning.val('6598000022');
							}else if(jsondata.MATKL=='7509'){
								reckoning.val('6598000086');
							}else if(jsondata.MATKL=='7510'){
								reckoning.val('6598000087');
							}else if(jsondata.MATKL=='7511'){
								reckoning.val('6598000088');
							}else{
								reckoning.val('6598000033');
							}
						if(courseAllot=='K'){
							itemGroup.html('<input id="itemGroup'+n+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+jsondata.MATKL+'" onblur="makeAccessory()"/>')
						}else{
							itemGroup.val(jsondata.MATKL);
						}
		            }
		          });
			makeAccessory();
		}
		
		//计算物资合计价钱
		function getAcountIntTotal(n){
			var count=$.trim($("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(5).find("input").val());
			var price=$.trim($("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(9).find("input").val());
			if(isNaN(count)||count==undefined||count==''){
				return;
			}else{
				count=parseFloat(count);
			}
			if(isNaN(price)||price==undefined||price==''){
				return;
			}else{
				price=parseFloat(price);
			}
			$("#updateAccessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(10).find("input").val((price*count+'').substring(0,(price*count+'').indexOf(".")+4));
			makeAccessory();
		}
		
	</script>
				</#if>
			</#if>
		</#list>
	</#if>
</#if>

<!-- 部门经理审核 -->
<#if currentStep?exists && currentStep == 'departManagerAudiTask'> 
		<div id="departManagerAudiTask">
			<form id="departManagerAudiTaskForm" method="post" enctype='multipart/form-data'>
				<table id="departManagerAudiTaskFormTable" class="formtable" cellspacing="1" cellpadding="0">
					<tr>
		  	  			<td class="formtable_td_key" align="center" colspan="4" style="font-weight:bold;font-size:14px;">
		  	  				部门负责人审核
		  	  			</td>
		  	  		</tr>
					<tr>
						<td style="width:133px" class="formtable_td_key" colspan="2">部门负责人审核</td>
						<td width="325px" class="formtable_td_value">
							<input type="hidden" name="fp_deptManagerAccount" value="${appuser.account}" />
							<input type="hidden" name="fp_deptManagerName" mobile="部门负责人审核" value="${appuser.name}" />
							${appuser.name}
						</td>
						<td class="formtable_td_value">
							<input id="deptManagerAudiAgree${rand}" type="radio" name="fp_deptManagerAudi" mobile="处理结果_同意"checked="checked" value="0"/>同意
							<input id="deptManagerAudiDisAgree${rand}" type="radio" name="fp_deptManagerAudi" mobile="处理结果_不同意" value="1" />不同意
						</td>
					</tr>
					<tr>
						<td class="formtable_td_key" colspan="2">处理意见：（包括维修价格、维修期限等，由处理单位填写）</td>
						<td class="formtable_td_value" colspan="2">
							<textarea id="deptManagerAudiAdvice${rand}" style="width: 800px; height: 100px" mobile="处理意见：（包括维修价格、维修期限等，由处理单位填写）" name="fp_deptManagerAudiAdvice" class="easyui-validatebox" ></textarea>
						</td>
					</tr>
					<tr>
						<td class="formtable_td_key" colspan="2">备注：</td>
						<td class="formtable_td_value" colspan="2">
							<textarea style="width: 800px; height: 100px" mobile="备注" name="fp_deptManagerRemark" class="easyui-validatebox" ></textarea>
						</td>
					</tr>
					<tr>
						<td class="formtable_td_key" colspan="2">审核时间：</td>
						<td class="formtable_td_value"  colspan="2">
							<input type="hidden" name="fp_deptManagerAudiTime" mobile="审批时间"
								timeEditor="1" 	value="${.now?string('yyyy-MM-dd HH:mm:ss')}" />
							${.now?string('yyyy-MM-dd HH:mm:ss')}
						</td>
					</tr>
				</table>
			</form>
		</div>
		<script type="text/javascript">
			$("#deptManagerAudiAdvice${rand}").validatebox({required:false});
			var success = function(){
				$("#deptManagerAudiAdvice${rand}").validatebox({required:false});//部门经理意见为非必填项
			}
			var failure=function(){
				$("#deptManagerAudiAdvice${rand}").val('');
				$("#deptManagerAudiAdvice${rand}").validatebox({required:true});//部门经理意见为必填项
			};
			$("#deptManagerAudiAgree${rand}").bind("click",success);
			$("#deptManagerAudiDisAgree${rand}").bind("click",failure);
		</script>
</#if>

<!-- 采购员处理 -->
<#if currentStep?exists>
   <#if currentStep == 'logisticProcurementAudiTask'>
	<#if processSteps??> 
      <#list processSteps as steps> 
      	<#if steps.key == 'startevent1'>
		<#assign factory=steps.vars["factory"]!""/>
		<div id="logisticProcurementAudiTask">
			<form id="logisticProcurementAudiTaskForm" method="post" enctype='multipart/form-data'>
				<table id="logisticProcurementAudiTaskFormTable" class="formtable" cellspacing="1" cellpadding="0">
					<tr>
		  	  			<td class="formtable_td_key" align="center" colspan="4" style="font-weight:bold;font-size:14px;">
		  	  				后勤采购员处理
		  	  			</td>
		  	  		</tr>
		  	  		<tr>
					<td class="formtable_td_key" style="">凭证类型：</td>
					<td class="formtable_td_value" colspan="3">
						 <select id="proofType${rand}" name="fp_proofType" style="width:180px;">
						 	<option value='ZR01'>ZR01 总经办非生产物资采购申请</option>
						  	<option value='NB'>NB 标准采购申请</option>
						  	<option value='ZR02'>ZR02 工程部非生产物资采购申请</option>
						  	<option value='ZR03'>ZR03 物殊采购申请</option>
						  	<option value='ZR04'>ZR04 金立非生产物资采购申请(测试部)</option>
						  	<option value='ZR05'>ZR05金立非生产物资采购申请(信息部)</option>
						 </select>
					</td>
				</tr>
				<tr>
		  	  		<td class="formtable_td_key">选择申请方式：</td>
		  	  		<td class="formtable_td_value" colspan="3">
		  	  			<input type="radio" name="fp_scrapWay" value="1" checked/>少量申请
		  	  			<input type="radio" name="fp_scrapWay" value="2"/>批量申请
		  	  		</td>
		  	  	</tr>
				<tr>
				  	<td colspan="4" class="formtable_td_key" align="center">设备维修物料清单</td>
				</tr>
				<tr class="scrapWay1">
				  	<td class="formtable_td_value" colspan="4">
				  		<div>
				  	  		<a class="easyui-linkbutton l-btn" onclick="addAccessory()">
	    						<span class="l-btn-text icon-add l-btn-icon-left">新增</span>
	    					</a>
	    					<a class="easyui-linkbutton l-btn" onclick="removeAccessory()">
	    						<span class="l-btn-text icon-remove l-btn-icon-left">删除</span>
	    						<input type="hidden" id="AccessoriesJsonStr${rand}" name="fp_MFixedAssetsDetraction"/>
	    						<input type="hidden" id="factory${rand}" name="fp_factory"/>
	    					</a>
				  	  	</div>
				  	  	<div style="width:1465px;margin-top:2px;border:solid 1px #95B8E7;">
					  	  	<div style="border-top:solid 1px #666666;">
								<table class="gridtable">
									<thead>
										<tr>
											<td width="1" align="center"><input type="checkbox" class="thchk" /></td>
											<td width="24" align="center">序号</td>
											<td width="45" align="center">科目分配</td>
											<td width="80" align="center">物料编码</td>
											<td width="150" align="center">物料名称及规格</td>
											<td width="60" align="center">申请数量</td>
											<td width="60" align="center">单位</td>
											<!--<td width="125" align="center">工厂</td>-->
											<td width="80" align="center">总账科目</td>
											<td width="125" align="center">成本中心</td>
											<td width="60" align="center">预估单价</td>
											<td width="80" align="center">合计</td>
											<td width="125" align="center">交货日期</td>
											<td width="50" align="center">采购组</td>
											<td width="100" align="center">物料组</td>
											<td width="80" align="center">申请者</td>
											<td width="180" align="center">备注</td>
										</tr>
									</thead>
								</table>
							</div>
							<div style="height:auto;overflow-y:auto;border-top:solid 1px #666666;">
								<table id="accessoryInfoTb${rand}" class="gridtable" style="word-break:break-all; word-wrap:break-all;">
									<tbody>
									</tbody>
								</table>
							</div>
						</div>	
				  	  </td>
				  	</tr>
				  	<tr class="scrapWay2">
					<td class="formtable_td_value" colspan="4">
						<input id="partAccount" type="hidden" name="fp_partList" /> 
						<!--<input id="participantList_val" type="hidden" name="fp_participantList" />--> 
						<input id="scrapWay2JsonStr${rand}" type="hidden" name="fp_scrapWay2JsonStr" />
						<a id="openImportPersonBtn-${rand}" href="javascript:void(0);" class="easyui-linkbutton" 
								data-options="iconCls:'icon-upload'">导入设备维修物料清单</a>
						<a id="downloadTravelExcel${rand}" href="javascript:void(0);" class="easyui-linkbutton" 
								data-options="iconCls:'icon-down_load'">下载EXCEL电子模板</a>
						<div id="participantList" style="font-size: 12px; ">
							<table id="participantListTb${rand}" class="gridtable" style="word-break:break-all; word-wrap:break-all;">
								<tbody>
								</tbody>
							</table>
						</div>
					</td>
				 	</tr>
					<tr>
						<td class="formtable_td_key" colspan="2">后勤采购员：</td>
						<td width="325px" class="formtable_td_value">
							<input id="isOffRowCount${rand}" name="fp_isOffRowCount" type="hidden" value="0"/>
							<input type="hidden" name="fp_logisticProcurementAccount" value="${appuser.account}" />
							<input type="hidden" name="fp_logisticProcurementName"mobile="采购员处理" value="${appuser.name}" />
							${appuser.name}
						</td>
						<td class="formtable_td_value">
							<input id="logisticProcurementAgree${rand}" type="radio" name="fp_logisticProcurementAudi" mobile="处理结果_同意" checked="checked" value="0"/>同意
							<input id="logisticProcurementDisagree${rand}" type="radio" name="fp_logisticProcurementAudi" mobile="处理结果_不同意" value="1" />不同意
						</td>
					</tr>
					<tr>
						<td class="formtable_td_key" colspan="2">处理意见：（包括维修价格、维修期限等，由处理单位填写）</td>
						<td class="formtable_td_value" colspan="2">
						<textarea id="logisticProcurementAudiAdvice${rand}" style="width: 800px; height: 100px" mobile="处理意见：（包括维修价格、维修期限等，由处理单位填写）"
								name="fp_logisticProcurementAudiAdvice" class="easyui-validatebox" ></textarea>
						</td>
					</tr>
					<tr>
						<td class="formtable_td_key" colspan="2">备注：</td>
						<td class="formtable_td_value" colspan="2">
						<textarea style="width: 800px; height: 100px" mobile="备注"
								name="fp_logisticProcurementRemark" class="easyui-validatebox" ></textarea>
						</td>
					</tr>
					<tr>
						<td class="formtable_td_key" colspan="2">处理时间：</td>
						<td class="formtable_td_value"  colspan="2">
							<input type="hidden" name="fp_logisticProcurementAudiTime" mobile="处理时间"
								timeEditor="1" 	value="${.now?string('yyyy-MM-dd HH:mm:ss')}" />
							${.now?string('yyyy-MM-dd HH:mm:ss')}
						</td>
					</tr>
				</table>
			</form>
		</div>
		</#if>
		<#if steps.key == 'updateEquipmentApplyTask'>
			<#assign factory=steps.vars["updateFactory"]!""/>
		</#if>
		</#list>
		<div id="importWin-${rand}" class="easyui-dialog"
		data-options="modal:true, title:'导入非生产物资清单',closed:true,cache:false,iconCls:'icon-process',width:600,height:100,onClose:clearInputFile${rand}">
		<div  style="padding:10px 10px;">
		<form id="upform-${rand}" method="post" enctype="multipart/form-data">
			<table>
				<tr>
					<td width="120" align="center">上传文件:</td>
					<td id="td_input_${rand}"><input id="upload_file-${rand}" class="easyui-validatebox" data-options="required:true" type="file" name="files" style="width:300px;"/></td>
					<td>
						<a id="upfile-${rand}" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search">上传</a>
					</td>
				</tr>
			</table>
		</form>
		</div>
	</div>
		<style type="text/css">
				table.gridtable {
					font-family: verdana,arial,sans-serif;
					font-size:11px;
					color:#333333;
					border-width: 1px;
					border-color: #666666;
					border-collapse: collapse;
				}
				table.gridtable thead td {
					padding: 4px;
					border-top:solid 1px #666666;
					border-right:solid 1px #666666;
					border-left:solid 1px #666666;
				}
				table.gridtable tbody td {
					padding: 4px;
					border-width: 1px;
					border-style: solid;
					border-color: #666666;
				}
			</style>	
		<script type="text/javascript">
			$(function(){
				$('.thchk').each(function(){ 
					$(this).click(function(){ 
						if($(this).prop('checked')){
							$('.tdchk').prop("checked", true);
						} else {
							$('.tdchk').prop("checked", false);
						} 	
					});
				});
				
				$("#factory${rand}").val('${factory}');
				
				$(".scrapWay2").hide();
				$(":radio[name='fp_scrapWay']").click(function(){
					var scrapWay=$('input[name="fp_scrapWay"]:checked').val();
					if(scrapWay=='1'){
						$(".scrapWay1").show();
						$("#participantListTb${rand} tbody").html('');
						$("#scrapWay2JsonStr${rand}").val('');
						$(".scrapWay2").hide();
					}else{
						$(".scrapWay2").show();
						$("#accessoryInfoTb${rand} tbody").html('');
						$("#AccessoriesJsonStr${rand}").val('');
						$(".scrapWay1").hide();
					}
				});
			});
			
			function addAccessory() {
				var rows = $('#accessoryInfoTb${rand} tbody tr'); 
				var rowno = rows.length + 1;
				var str = '<tr>';
				str += '<td width="1"><input type="checkbox" class="tdchk" /></td>';
				str += '<td width="24" align="center">' + rowno + '</td>';
				str += '<td width="45"><select id="courseAllot'+rowno+'${rand}" style="width:40px;border:solid 1px #007ACC;" onchange="showRequire('+rowno+')"><option value=""></option><option value="K" selected="selected">K</option></select></td>';
				str += '<td width="80"><input id="stock'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:75px;border:solid 1px #007ACC;" onblur="getStockInfo('+rowno+');"/></td>';
				str += '<td width="150"><input id="stockNameAndStandard'+rowno+'${rand}" type="text" class="easyui-validatebox" data-options="required:true" style="width:145px;border:solid 1px #007ACC;"/></td>';
				str +='<td width="60"><input type="text" class="easyui-numberbox" data-options="required:true" style="width:55px;border:solid 1px #007ACC;" onblur="getAcountIntTotal('+rowno+');"/></td>';
				str +='<td width="60"><input id="monad'+rowno+'${rand}" type="text" class="easyui-validatebox" data-options="required:true" style="width:55px;border:solid 1px #007ACC;" onblur="makeAccessory()"/></td>';
				//str +='<td width="125"><input id="factory'+rowno+'${rand}" type="text" class="easyui-combobox" data-options="required:true" style="width:120px;border:solid 1px #007ACC;"/></td>';
				str +='<td width="80"><input id="reckoning'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:75px;border:solid 1px #007ACC;" value="6598000059" onblur="makeAccessory()"/></td>';
				str +='<td width="125"><input id="costCenter'+rowno+'${rand}" type="text" class="easyui-combobox" style="width:120px;border:solid 1px #007ACC;"/></td>';
				str +='<td width="60"><input type="text" id="unitPrice'+rowno+'${rand}" class="easyui-numberbox" data-options="required:true" style="width:55px;border:solid 1px #007ACC;" onblur="getAcountIntTotal('+rowno+');"/></td>';
				str +='<td width="80"><input type="text" id="totalAmount'+rowno+'${rand}" class="easyui-numberbox" style="width:75px;border:solid 1px #007ACC;" readonly/></td>';
				str +='<td width="125"><input type="text" class="easyui-my97" data-options="width:100,required:true,disabled:false,minDate:\'%y-%M-{%d}\',validType:\'reqdate\' " style="width:100px;border:solid 1px #007ACC;" onblur="makeAccessory()"/></td>';
				str +='<td width="50"><input id="procurementSection'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:45px;border:solid 1px #007ACC;" value="006" onblur="makeAccessory()"/></td>';
				str +='<td width="100"><select id="itemGroup'+rowno+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getRecoking('+rowno+');">'
					+'<option value="7001">7001-消防类</option>'
					+'<option value="7002">7002-安全系统类</option>'
					+'<option value="7004">7004-电工维修工具类</option>'
					+'<option value="7005">7005-办公设施类</option>'
					+'<option value="7006">7006-办公用品类</option>'
					+'<option value="7007">7007-生活辅助类</option>'
					+'<option value="7008">7008-安装制作维修类</option>'
					+'<option value="7010" selected="selected">7010-设备维修类</option>'
					+'<option value="7011">7011-手机充值卡类</option>'
					+'<option value="7012">7012-手机测试卡类</option>'
					+'<option value="7014">7014-培训物资类</option>'
					+' </select></td>';
				str +='<td width="80"><input type="text" class="easyui-validatebox" data-options="required:true" style="width:75px;border:solid 1px #007ACC;" onblur="makeAccessory()"/></td>';
				str +='<td width="180"><input type="text" class="easyui-validatebox" style="width:175px;border:solid 1px #007ACC;" onblur="makeAccessory()"/></td>';
				str += '</tr>';
		    	$('#accessoryInfoTb${rand} tbody').append(str);
		    	$.parser.parse($('#accessoryInfoTb${rand}').find("tr").eq(-1));
		    	$("#isOffRowCount${rand}").val(rowno);
		    	
		    	$("#unitPrice"+rowno+"${rand}").numberbox({
				    precision:3
				});
		    	
		    	$("#totalAmount"+rowno+"${rand}").numberbox({
				    precision:3
				});
		    	var costCenter=$("#costCenter"+rowno+"${rand}");
		    	var courseAllot=$("#courseAllot"+rowno+"${rand}").val();
				var stock=$("#stock"+rowno+"${rand}").val();
				var stockNameAndStandard=$("#stockNameAndStandard"+rowno+"${rand}");
				var monad=$("#monad"+rowno+"${rand}");
				var reckoning=$("#reckoning"+rowno+"${rand}");
				var procurementSection=$("#procurementSection"+rowno+"${rand}");
				var itemGroup=$("#itemGroup"+rowno+"${rand}");
				
				costCenter.combobox({
					valueField : 'id',
					textField : 'text',
					//required : false,
					editable : false,
					onSelect : function(record) {
						makeAccessory();
						//$("#costCenterName${rand}").val(record.text);
						//$('#costCenterId${rand}').val(record.id);
					}
				});
				$.get('hrFlow/getSapCostCenter.json', {
					factory:$("#factory${rand}").val()
				}, function(data) {
					costCenter.combobox("clear")
							.combobox('loadData', data);
				}, 'json');
				
				if(stock==null || stock==''){
					return;
				}
				//根据工厂、物料编号获取非生产物资数据
				$.get("hrFlow/getStockInfo.json",{
					functionName:'ZHR_OA46',vars:'I_MATNR_VALUE_'+stock+'_NEXT_I_WERKS_VALUE_'+$("#factory${rand}").val(),exportTableName:'E_MATNR',
					exportlist:'MAKTX_NEXT_MEINS_NEXT_EKGRP_NEXT_MATKL'
				},function(data){
					var jsondata=eval("("+data+")");
					if(jsondata.MAKTX=='' && jsondata.MEINS=='' && jsondata.EKGRP=='' && jsondata.MATKL==''){
						$.messager.alert("提示信息","您好，此编号的维修物料不存在!");
						$("#stock"+rowno+"${rand}").val('');
					}
					stockNameAndStandard.val(jsondata.MAKTX);
					monad.val(jsondata.MEINS);
					procurementSection.val(jsondata.EKGRP);
					//if(courseAllot=='K'){
						if(jsondata.MATKL=='7001'||jsondata.MATKL=='7010'){
							reckoning.val('6598000059');
						}else if(jsondata.MATKL=='7011'||jsondata.MATKL=='7014'){
							reckoning.val('6598000022');
						}else if(jsondata.MATKL=='7509'){
							reckoning.val('6598000086');
						}else if(jsondata.MATKL=='7510'){
							reckoning.val('6598000087');
						}else if(jsondata.MATKL=='7511'){
							reckoning.val('6598000088');
						}else{
							reckoning.val('6598000033');
						}
					if(courseAllot=='K'){
						itemGroup.parent().html('<input id="itemGroup'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+jsondata.MATKL+'" onblur="makeAccessory();"/>')
					}else{
						itemGroup.val(jsondata.MATKL);
					}
				});
			}
			
			function showRequire(n){
				var courseAllot = $.trim($("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(2).find("select").val());
				var stock=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(3).find("input");
				var stockNameAndStandard=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(4).find("input");
				var monad=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(6).find("input");
				var roging=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(7).find("input");
				//var costCenter=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(9);
				var procurementSection=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(12).find("input");
				var itemGroup=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(13);
				roging.val('');
				if(courseAllot=='K'){
					stock.validatebox({required:false});
					stockNameAndStandard.validatebox({required:true});
					monad.validatebox({required:true});
					roging.validatebox({required:true});
					//cost.combotree(required,true);
					procurementSection.validatebox({required:true});
					//costCenter.html('<input id="costCenter'+n+'${rand}" type="text" class="easyui-combobox" data-options="valueField : \'id\',textField : \'text\',required : true,editable : false,onSelect : function(record) {makeAccessory();}" style="width:120px;border:solid 1px #007ACC;"/>');
					//roging.val('6598000059');
					if(stock.val()==null || stock.val()==''){
						itemGroup.html('<select id="itemGroup'+n+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getRecoking('+n+');">'
								+'<option value="7001">7001-消防类</option>'
								+'<option value="7002">7002-安全系统类</option>'
								+'<option value="7004">7004-电工维修工具类</option>'
								+'<option value="7005">7005-办公设施类</option>'
								+'<option value="7006">7006-办公用品类</option>'
								+'<option value="7007">7007-生活辅助类</option>'
								+'<option value="7008">7008-安装制作维修类</option>'
								+'<option value="7010" selected="selected">7010-设备维修类</option>'
								+'<option value="7011">7011-手机充值卡类</option>'
								+'<option value="7012">7012-手机测试卡类</option>'
								+'<option value="7014">7014-培训物资类</option>'
							+' </select>');
						roging.val('6598000059');
					}
				}else{
					//roging.val('');
					stock.validatebox({required:true});
					stockNameAndStandard.validatebox({required:false});
					monad.validatebox({required:false});
					roging.validatebox({required:false});
					//cost.combotree(required,false);
					procurementSection.validatebox({required:false});
					//costCenter.html('<input id="costCenter'+n+'${rand}" type="text" class="easyui-combobox" data-options="valueField : \'id\',textField : \'text\',required : false,editable : false,onSelect : function(record) {makeAccessory();}" style="width:120px;border:solid 1px #007ACC;"/>');
					itemGroup.html('<input id="itemGroup'+n+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" onblur="makeAccessory();" readonly/>');
				}
				$.parser.parse($('#accessoryInfoTb${rand}').find("tr").eq(n-1));
				makeAccessory();
			}
			
			function getRecoking(n){
				var itemGroup = $.trim($("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(13).find("select").val());
				var reckoning=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(7).find("input");
				if(itemGroup=='7001'||itemGroup=='7010'){
					reckoning.val('6598000059');
				}else if(itemGroup=='7011'||itemGroup=='7014'){
					reckoning.val('6598000022');
				}else if(itemGroup=='7509'){
					reckoning.val('6598000086');
				}else if(itemGroup=='7510'){
					reckoning.val('6598000087');
				}else if(itemGroup=='7511'){
					reckoning.val('6598000088');
				}else{
					reckoning.val('6598000033');
				}
				makeAccessory();
			}
			
			function removeAccessory() {
		    	var rows = $('#accessoryInfoTb${rand} tbody tr input[type="checkbox"]:checked');
	            if (rows.length == 0) {
	        		$.messager.alert("操作提示", "请至少选择一条数据", "info");
	        		return false;
	            }

	            $.each(rows, function () {        
	                $(this).parent("td").parent("tr").remove();
	            });
	            
	            var MFixedAssetsDetraction = { accessoryData:[] };
	            var accessoryArr = [];
	            var rows=1;
	    		$('#accessoryInfoTb${rand} tbody tr').each(function () {
	    			var courseAllot = $.trim($(this).find('td').eq(2).find("select").val());
	    			var stockNumber = $.trim($(this).find('td').eq(3).find("input").val());
	    			var stockNameAndStandard = $.trim($(this).find('td').eq(4).find("input").val());
	    			var applyNumber = $.trim($(this).find('td').eq(5).find("input").numberbox("getValue"));
	    			var monad = $.trim($(this).find('td').eq(6).find("input").val());
	    			//var factory = $.trim($(this).find('td').eq(7).find("input").combotree("getText"));
	    			var reckoning = $.trim($(this).find('td').eq(7).find("input").val());
	    			var costCenter = $.trim($(this).find('td').eq(8).find("input").combotree("getText"));
	    			var unitPrice = $.trim($(this).find('td').eq(9).find("input").numberbox("getValue"));
	    			var amountInTotal = $.trim($(this).find('td').eq(10).find("input").numberbox("getValue"));
	    			var deliveryDate = $.trim($(this).find('td').eq(11).find("input").val());
	    			var procurementSection = $.trim($(this).find('td').eq(12).find("input").val());
	    			var itemGroup='';
	    			if(courseAllot=='K' && (stockNumber==null || stockNumber=='')){
	    				itemGroup = $.trim($(this).find('td').eq(13).find("select").val());
	    			}else{
	    				itemGroup = $.trim($(this).find('td').eq(13).find("input").val());
	    			}
	    			var applyName = $.trim($(this).find('td').eq(14).find("input").val());
	    			var remark = $.trim($(this).find('td').eq(15).find("input").val());
	    			accessoryArr.push({
	    				courseAllot:courseAllot,stockNumber:stockNumber,stockNameAndStandard:stockNameAndStandard,applyNumber:applyNumber,monad:monad,reckoning:reckoning,costCenter:costCenter,unitPrice:unitPrice,amountInTotal:amountInTotal,deliveryDate:deliveryDate,procurementSection:procurementSection,itemGroup:itemGroup,applyName:applyName,remark:remark
	    			});
	    			MFixedAssetsDetraction.accessoryData.push({
	    				rowno:rows,courseAllot:courseAllot,stockNumber:stockNumber,stockNameAndStandard:stockNameAndStandard,applyNumber:applyNumber,monad:monad,reckoning:reckoning,costCenter:costCenter,unitPrice:unitPrice,amountInTotal:amountInTotal,deliveryDate:deliveryDate,procurementSection:procurementSection,itemGroup:itemGroup,applyName:applyName,remark:remark
	    			});
	    			rows++;
	    		});
	    		$('#AccessoriesJsonStr${rand}').val(JSON.stringify(MFixedAssetsDetraction));

	        	var rowno = 1;
	        	$("#accessoryInfoTb${rand} tbody").empty();
	    		$.each(accessoryArr, function(idx, obj) {
	    			var str = '<tr>';
					str += '<td width="1"><input type="checkbox" class="tdchk" /></td>';
					str += '<td width="24" align="center">' + rowno + '</td>';
					str += '<td width="45"><select id="courseAllot'+rowno+'${rand}" style="width:40px;border:solid 1px #007ACC;" onchange="showRequire('+rowno+')"><option value="" selected="selected"></option><option value="K">K</option></select></td>';
					str += '<td width="80"><input id="stock'+rowno+'${rand}" type="text" class="easyui-validatebox" data-options="required:true" style="width:75px;border:solid 1px #007ACC;" onblur="getStockInfo('+rowno+');" value="'+obj.stockNumber+'"/></td>';
					str += '<td width="150"><input id="stockNameAndStandard'+rowno+'${rand}" type="text" class="easyui-validatebox"  style="width:145px;border:solid 1px #007ACC;" value="'+obj.stockNameAndStandard+'" onblur="makeAccessory()"/></td>';
					str +='<td width="60"><input type="text" class="easyui-numberbox" data-options="required:true" style="width:55px;border:solid 1px #007ACC;" onblur="getAcountIntTotal('+rowno+');" value="'+obj.applyNumber+'"/></td>';
					str +='<td width="60"><input id="monad'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:55px;border:solid 1px #007ACC;" value="'+obj.monad+'" onblur="makeAccessory()"/></td>';
					//str +='<td width="125"><input id="factory'+rowno+'${rand}" type="text" data-options="required:true" style="width:120px;border:solid 1px #007ACC;" value="'+obj.factory+'" /></td>';
					str +='<td width="80"><input id="totalAllot'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:75px;border:solid 1px #007ACC;" onblur="makeAccessory()" value="'+obj.reckoning+'"/></td>';
					str +='<td width="125"><input id="costCenter'+rowno+'${rand}" type="text" style="width:120px;border:solid 1px #007ACC;" value="'+obj.costCenter+'"/></td>';
					str +='<td width="60"><input id="unitPrice'+rowno+'${rand}" type="text" class="easyui-numberbox" data-options="required:true" precision="3" style="width:55px;border:solid 1px #007ACC;" onblur="getAcountIntTotal('+rowno+');" value="'+obj.unitPrice+'"/></td>';
					str +='<td width="80"><input id="totalAmount'+rowno+'${rand}" type="text" class="easyui-numberbox" precision="3" style="width:75px;border:solid 1px #007ACC;" value="'+obj.amountInTotal+'" readonly/></td>';
					str +='<td width="125"><input type="text" class="easyui-my97" data-options="width:100,required:true,disabled:false,minDate:\'%y-%M-{%d}\',validType:\'reqdate\' " style="width:100px;border:solid 1px #007ACC;" onblur="makeAccessory()" value="'+obj.deliveryDate+'"/></td>';
					str +='<td width="50"><input id="procurementSection'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:45px;border:solid 1px #007ACC;" value="'+obj.procurementSection+'" onblur="makeAccessory()"/></td>';
					if(obj.courseAllot=='K'&&(obj.stockNumber==null||obj.stockNumber=='')){
						str +='<td width="100"><select id="itemGroup'+rowno+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getRecoking('+rowno+');">'
						+'<option value="7001">7001-消防类</option>'
						+'<option value="7002">7002-安全系统类</option>'
						+'<option value="7004">7004-电工维修工具类</option>'
						+'<option value="7005">7005-办公设施类</option>'
						+'<option value="7006">7006-办公用品类</option>'
						+'<option value="7007">7007-生活辅助类</option>'
						+'<option value="7008">7008-安装制作维修类</option>'
						+'<option value="7010" selected="selected">7010-设备维修类</option>'
						+'<option value="7011">7011-手机充值卡类</option>'
						+'<option value="7012">7012-手机测试卡类</option>'
						+'<option value="7014">7014-培训物资类</option>'
					+' </select></td>';
					}else{
						str +='<td width="100"><input id="itemGroup'+rowno+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+obj.itemGroup+'" onblur="makeAccessory()"/></td>';
					}
					str +='<td width="80"><input type="text" class="easyui-validatebox" data-options="required:true" style="width:75px;border:solid 1px #007ACC;" onblur="makeAccessory()" value="'+obj.applyName+'"/></td>';
					str +='<td width="180"><input type="text" class="easyui-validatebox" style="width:175px;border:solid 1px #007ACC;" onblur="makeAccessory()" value="'+obj.remark+'"/></td>';
					str += '</tr>';
				
					$('#accessoryInfoTb${rand} tbody').append(str);
					//$.parser.parse($('#updateAccessoryInfoTb${rand}').parent());
					$.parser.parse($('#accessoryInfoTb${rand}').find("tr").eq(rowno-1));
					
					/*$("#unitPrice"+rowno+"${rand}").numberbox({
					    precision:3
					});
			    	
			    	$("#totalAmount"+rowno+"${rand}").numberbox({
					    precision:3
					});*/
			    	
					if(obj.courseAllot=='K'){
						$("#stock"+rowno+"${rand}").validatebox({required:false});
						$("#stockNameAndStandard"+rowno+"${rand}").validatebox({required:true});
						$("#monad"+rowno+"${rand}").validatebox({required:true});
						$("#totalAllot"+rowno+"${rand}").validatebox({required:true});
						if(obj.stockNumber==null||obj.stockNumber==''){
							$("#itemGroup"+rowno+"${rand} option[value='"+obj.itemGroup+"']").attr("selected", true); 
						}
					}
					$("#courseAllot"+rowno+"${rand} option[value='"+obj.courseAllot+"']").attr("selected", true);     		    	
	    			rowno++;
	    		});
	    		var rows = $('#accessoryInfoTb${rand} tbody tr');
				if(rows.length == 0) {		
					$('#accessoryInfoTb${rand}').val('');
				} else {				
	        		$('#accessoryInfoTb${rand} tbody tr').each(function () {
	        			var row=$.trim($(this).find('td').eq(1).find("input").val());
	        			var courseAllot1=$.trim($(this).find('td').eq(2).find("input").val());
	        			var stock1 = $(this).find('td').eq(3).find("input");
	        			var stockNameAndStandard1 =$(this).find('td').eq(4).find("input");
	        			var monad1 = $(this).find('td').eq(6).find("input");
	        			//var factory1 = $(this).find('td').eq(7).find("input");
	        			var reckoning=$(this).find('td').eq(7).find("input");
	        			var costCenter1 = $(this).find('td').eq(8).find("input");
	        			//var unitPrice = $(this).find('td').eq(10).find("input");
	        			//var amountInTotal = $(this).find('td').eq(11).find("input");
	        			var procurementSection1 =$(this).find('td').eq(12).find("input");
	        			var itemGroup1=null;
	        			/*unitPrice.numberbox({
						    precision:3
						});
				    	
	        			amountInTotal.numberbox({
						    precision:3
						});*/
	        			if(courseAllot1=='K'&&(stock1==null||stock1=='')){
	        				itemGroup1 =$(this).find('td').eq(13);
	        			}else{
	        				itemGroup1 =$(this).find('td').eq(13).find("input");
	        			}
						
						costCenter1.combobox({
    						valueField : 'id',
    						textField : 'text',
    						//required : true,
    						editable : false,
    						onSelect : function(record) {
    							makeAccessory();
    							//$("#costCenterName${rand}").val(record.text);
    							//$('#costCenterId${rand}').val(record.id);
    						},onLoadSuccess:function(){
    							costCenter1.combobox('setValue',costCenter1.val());
    						}
    					});
	        			
	    				$.get('hrFlow/getSapCostCenter.json', {
	    					factory:$("#factory${rand}").val()
	    				}, function(data) {
	    					costCenter1.combobox('loadData', data);
	    				}, 'json');
	    				
	    				if(stock1.val()==null || stock1.val()==''){
							return;
						}
						//根据工厂、物料编号获取非生产物资数据
						$.get("hrFlow/getStockInfo.json",{
							functionName:'ZHR_OA46',vars:'I_MATNR_VALUE_'+stock1.val()+'_NEXT_I_WERKS_VALUE_'+$("#factory${rand}").val(),exportTableName:'E_MATNR',
							exportlist:'MAKTX_NEXT_MEINS_NEXT_EKGRP_NEXT_MATKL'
						},function(data){
							var jsondata=eval("("+data+")");
							if(jsondata.MAKTX=='' && jsondata.MEINS=='' && jsondata.EKGRP=='' && jsondata.MATKL==''){
								$.messager.alert("提示信息","您好，此编号的非生产物资不存在!");
								$(this).find('td').eq(3).find("input").val('');
							}
							stockNameAndStandard1.val(jsondata.MAKTX);
							monad1.val(jsondata.MEINS);
							procurementSection1.val(jsondata.EKGRP);
							//if(courseAllot1=='K'){
								if(jsondata.MATKL=='7001'||jsondata.MATKL=='7010'){
									reckoning.val('6598000059');
								}else if(jsondata.MATKL=='7011'||jsondata.MATKL=='7014'){
									reckoning.val('6598000022');
								}else if(jsondata.MATKL=='7509'){
									reckoning.val('6598000086');
								}else if(jsondata.MATKL=='7510'){
									reckoning.val('6598000087');
								}else if(jsondata.MATKL=='7511'){
									reckoning.val('6598000088');
								}else{
									reckoning.val('6598000033');
								}
							if(courseAllot1=='K'){
								itemGroup1.html('<input id="itemGroup'+row+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+jsondata.MATKL+'" onblur="makeAccessory()"/>');
							}else{
								itemGroup1.val(jsondata.MATKL);
							}
						});
	        		});
				}
	            
	    		//$('#accessoryInfoTb${rand} tbody').append($('#accessoryInfoTb${rand} tbody tr'));
	    		//$.parser.parse($('#accessoryInfoTb${rand}').parent());
	    		$("#isOffRowCount${rand}").val($('#accessoryInfoTb${rand} tbody tr').length);
	    		//makeAccessory();
			}
			
			function makeAccessory() {
				var rows = $('#accessoryInfoTb${rand} tbody tr');
				if(rows.length == 0) {		
					$('#AccessoriesJsonStr${rand}').val('');
				} else {				
					var MFixedAssetsDetraction = { accessoryData:[] };
					var rowno = 1;
	        		$('#accessoryInfoTb${rand} tbody tr').each(function () {	        			
	        			var courseAllot = $.trim($(this).find('td').eq(2).find("select").val());
	        			var stockNumber = $.trim($(this).find('td').eq(3).find("input").val());
	        			var stockNameAndStandard = $.trim($(this).find('td').eq(4).find("input").val());
	        			var applyNumber = $.trim($(this).find('td').eq(5).find("input").numberbox("getValue"));
	        			var monad = $.trim($(this).find('td').eq(6).find("input").val());
	        			//var factory = $.trim($(this).find('td').eq(7).find("input").combotree("getText"));
	        			var reckoning = $.trim($(this).find('td').eq(7).find("input").val());
	        			var costCenter = $.trim($(this).find('td').eq(8).find("input").combotree("getText"));
	        			var unitPrice = $.trim($(this).find('td').eq(9).find("input").val());
	        			var amountInTotal = $.trim($(this).find('td').eq(10).find("input").numberbox("getValue"));
	        			var deliveryDate = $.trim($(this).find('td').eq(11).find("input").val());
	        			var procurementSection = $.trim($(this).find('td').eq(12).find("input").val());
	        			var itemGroup='';
	        			if(courseAllot=='K' && (stockNumber==null || stockNumber=='')){
	        				itemGroup = $.trim($(this).find('td').eq(13).find("select").val());
	        			}else{
	        				itemGroup = $.trim($(this).find('td').eq(13).find("input").val());
	        			}
	        			var applyName = $.trim($(this).find('td').eq(14).find("input").val());
	        			var remark = $.trim($(this).find('td').eq(15).find("input").val());
	        		
	        			MFixedAssetsDetraction.accessoryData.push({
	        				rowno:rowno,courseAllot:courseAllot,stockNumber:stockNumber,stockNameAndStandard:stockNameAndStandard,applyNumber:applyNumber,monad:monad,reckoning:reckoning,costCenter:costCenter,unitPrice:unitPrice,amountInTotal:amountInTotal,deliveryDate:deliveryDate,procurementSection:procurementSection,itemGroup:itemGroup,applyName:applyName,remark:remark
	        			})
	        			rowno++;
	        		});
	        		
	        		$('#AccessoriesJsonStr${rand}').val(JSON.stringify(MFixedAssetsDetraction));
				}
			}
			function getStockInfo(n){
				var courseAllot = $.trim($("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(2).find("select").val());
				var stock=$.trim($("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(3).find("input").val());
				//var factory=$.trim($("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(7).find("input").combobox('getValue'));
				var reckoning=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(7).find("input");
				var stockNameAndStandard=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(4).find("input");
				var monad=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(6).find("input");
				var procurementSection=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(12).find("input");
				var itemGroup=null;
				if(courseAllot=='K'){
					itemGroup=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(13);
				}else{
					itemGroup=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(13).find("input");
				}
				
				if(stock==null || stock==''){
					if(courseAllot=='K'){
						itemGroup.html('<select id="itemGroup'+n+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getRecoking('+n+');">'
								+'<option value="7001">7001-消防类</option>'
								+'<option value="7002">7002-安全系统类</option>'
								+'<option value="7004">7004-电工维修工具类</option>'
								+'<option value="7005">7005-办公设施类</option>'
								+'<option value="7006">7006-办公用品类</option>'
								+'<option value="7007">7007-生活辅助类</option>'
								+'<option value="7008">7008-安装制作维修类</option>'
								+'<option value="7010" selected="selected">7010-设备维修类</option>'
								+'<option value="7011">7011-手机充值卡类</option>'
								+'<option value="7012">7012-手机测试卡类</option>'
								+'<option value="7014">7014-培训物资类</option>'
							+' </select>');
						reckoning.val('');
					}
					return;
				}
				
				$.ajax({
			           type: "post",
			           url: "hrFlow/getStockInfo.json",
			           cache: false,
			           async: false,  //设置同步
			           dataType: "json",
			           data: {functionName:'ZHR_OA46',vars:'I_MATNR_VALUE_'+stock+'_NEXT_I_WERKS_VALUE_'+$("#factory${rand}").val(),exportTableName:'E_MATNR',
							exportlist:'MAKTX_NEXT_MEINS_NEXT_EKGRP_NEXT_MATKL'},
			           success: function (data) {
			            	var jsondata=eval("("+data+")");
			            	if(jsondata.MAKTX=='' && jsondata.MEINS=='' && jsondata.EKGRP=='' && jsondata.MATKL==''){
								$.messager.alert("提示信息","您好，此编号的维修物料不存在!");
								$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(3).find("input").val('');
							}
			            	stockNameAndStandard.val(jsondata.MAKTX);
							monad.val(jsondata.MEINS);
							procurementSection.val(jsondata.EKGRP);
							//if(courseAllot=='K'){
								if(jsondata.MATKL=='7001'||jsondata.MATKL=='7010'){
									reckoning.val('6598000059');
								}else if(jsondata.MATKL=='7011'||jsondata.MATKL=='7014'){
									reckoning.val('6598000022');
								}else if(jsondata.MATKL=='7509'){
									reckoning.val('6598000086');
								}else if(jsondata.MATKL=='7510'){
									reckoning.val('6598000087');
								}else if(jsondata.MATKL=='7511'){
									reckoning.val('6598000088');
								}else{
									reckoning.val('6598000033');
								}
							if(courseAllot=='K'){
								itemGroup.html('<input id="itemGroup'+n+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+jsondata.MATKL+'" onblur="makeAccessory();"/>');
							}else{
								itemGroup.val(jsondata.MATKL);
							}	
						  }
			          });
				
				makeAccessory();
			}
				
			//下载模板
			$("#downloadTravelExcel${rand}").bind('click',function(){
				submitForm("download.equipmentMaintain.name");
			});
			function submitForm(value){
				var form = $("<form>");
				form.attr('style','display:none');
				form.attr('method','post');
				form.attr('action','${base}sysprocess/task/mDownload.html');
				
				var key = $("<input>");
				key.attr('type','hidden');
				key.attr('name','key');
				key.attr('value',value);
				
				$("body").append(form);
				form.append(key);
				
				form.submit();
				form.remove();
			}
			//导入设备物料清单
			$("#openImportPersonBtn-${rand}").bind('click',function(){
				 $("#importWin-${rand}").dialog('open');
			 });
			
			 function clearInputFile${rand}(){
					//清空文件框
					$("#upload_file-${rand}").remove(); //移除原来的
				    var newFileInput = '<input id="upload_file-${rand}" class="easyui-validatebox" data-options="required:true" type="file" name="files" style="width:300px;"/>';
				   	$('#td_input_${rand}').html(newFileInput); //添加新的
				    $.parser.parse('#td_input_${rand}');
				}
			 
			 $("#upfile-${rand}").bind('click',function(){
				 $.messager.progress();
				 $("#upform-${rand}").form('submit',{
						url:'teamActivities/importEquipmentMaintain.json',
						onSubmit:function(){
							var validateResult = $(this).form('validate');
					    	if (!validateResult) {
					    		$.messager.progress('close');
								return false;
					    	} else {
					    		return true;
					    	}
					    },
						success:function(data){
							if(typeof(data).toLowerCase()=='string'){
								data=eval("("+data+")");
							}
							if(data.success){
								if(data.obj == null || data.obj.length == 0){
									$.messager.alert("提示信息","您上传的文件为空，请重新上传！");
								}else{
								
									var MFixedAssetsDetraction = { accessoryData:[] };
									if(data.obj.length>0){
										$('#participantListTb${rand} tbody').html("");
										$("#participantListTb${rand}").append("<tr align=center><td width=5%>序号</td><td width=5%>科目分配</td><td width=5%>物料编码</td><td width=10%>物料名称及规格</td><td width=5%>申请数量</td><td width=5%>单位</td><td width=5%>总账科目</td><td width=10%>成本中心</td><td width=5%>预估单价</td><td width=5%>合计</td><td width=10%>交货日期</td><td width=5%>采购组</td><td width=10%>物料组</td><td width=5%>申请者</td><td width=10%>备注</td></tr>");
										for(var i = 0;i < data.obj.length;i++){
										 var str='<tr align="center"><td>'+data.obj[i].number+'</td>'
											+'<td width="45"><select id="courseAllot'+data.obj[i].number+'${rand}" style="width:40px;border:solid 1px #007ACC;" onchange="showImportRequire('+data.obj[i].number+')"><option value="" selected="selected"></option><option value="K">K</option></select></td>'
											+'<td width="80"><input id="stock'+data.obj[i].number+'${rand}" type="text" class="easyui-validatebox" data-options="required:true" style="width:75px;border:solid 1px #007ACC;" onblur="getImportStockInfo('+data.obj[i].number+');" value="'+$.trim(data.obj[i].stockNumber)+'"/></td>'
											+'<td width="150"><input id="stockNameAndStandard'+data.obj[i].number+'${rand}" type="text" class="easyui-validatebox"  style="width:145px;border:solid 1px #007ACC;" value="'+data.obj[i].stockNameAndStandard+'" onblur="makeImportInf()"/></td>'
											+'<td width="60"><input type="text" class="easyui-numberbox" data-options="required:true" style="width:55px;border:solid 1px #007ACC;" onblur="getImportAcountIntTotal('+data.obj[i].number+');" value="'+data.obj[i].applyNumber+'"/></td>'
											+'<td width="60"><input id="monad'+data.obj[i].number+'${rand}" type="text" class="easyui-validatebox" style="width:55px;border:solid 1px #007ACC;" value="'+data.obj[i].monad+'" onblur="makeImportInf()"/></td>'
											+'<td width="80"><input id="totalAllot'+data.obj[i].number+'${rand}" type="text" class="easyui-validatebox" style="width:75px;border:solid 1px #007ACC;" onblur="makeImportInf()" value="'+data.obj[i].reckoning+'"/></td>'
											+'<td width="125"><input id="costCenter'+data.obj[i].number+'${rand}" type="text" class="easyui-validatebox" style="width:120px;border:solid 1px #007ACC;" value="'+data.obj[i].costCenter+'"/></td>'
											+'<td width="60"><input id="unitPrice'+data.obj[i].number+'${rand}" type="text" class="easyui-numberbox" data-options="required:true" precision="3" style="width:55px;border:solid 1px #007ACC;" onblur="getImportAcountIntTotal('+data.obj[i].number+');" value="'+data.obj[i].unitPrice+'"/></td>'
											+'<td width="80"><input id="totalAmount'+data.obj[i].number+'${rand}" type="text" class="easyui-numberbox" precision="3" style="width:75px;border:solid 1px #007ACC;" value="'+data.obj[i].amountInTotal+'" readonly/></td>'
											+'<td width="125"><input type="text" class="easyui-my97" data-options="width:100,required:true,disabled:false,minDate:\'%y-%M-{%d}\',validType:\'reqdate\' " style="width:100px;border:solid 1px #007ACC;" onblur="makeImportInf()" value="'+$.trim(data.obj[i].deliveryDate)+'"/></td>'
											+'<td width="50"><input id="procurementSection'+data.obj[i].number+'${rand}" type="text" class="easyui-validatebox" style="width:45px;border:solid 1px #007ACC;" value="'+data.obj[i].procurementSection+'" onblur="makeImportInf()"/></td>';
											if(data.obj[i].courseAllot=='K'&&(data.obj[i].stockNumber==null||$.trim(data.obj[i].stockNumber)=='')){
												str +='<td width="100"><select id="itemGroup'+data.obj[i].number+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getImportRecoking('+data.obj[i].number+');">'
												+'<option value="7001">7001-消防类</option>'
												+'<option value="7002">7002-安全系统类</option>'
												+'<option value="7004">7004-电工维修工具类</option>'
												+'<option value="7005">7005-办公设施类</option>'
												+'<option value="7006">7006-办公用品类</option>'
												+'<option value="7007">7007-生活辅助类</option>'
												+'<option value="7008">7008-安装制作维修类</option>'
												+'<option value="7010" selected="selected">7010-设备维修类</option>'
												+'<option value="7011">7011-手机充值卡类</option>'
												+'<option value="7012">7012-手机测试卡类</option>'
												+'<option value="7014">7014-培训物资类</option>'
											+' </select></td>';
											}else{
												str +='<td width="100"><input id="itemGroup'+data.obj[i].number+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+data.obj[i].itemGroup+'" onblur="makeImportInf()"/></td>';
											}
											str +='<td width="80"><input type="text" class="easyui-validatebox" data-options="required:true" style="width:75px;border:solid 1px #007ACC;" onblur="makeImportInf()" value="'+data.obj[i].applyName+'"/></td>';
											str +='<td width="180"><input type="text" class="easyui-validatebox" style="width:175px;border:solid 1px #007ACC;" onblur="makeImportInf" value="'+data.obj[i].remark+'"/></td>';
											str += '</tr>';
											
											$('#participantListTb${rand} tbody').append(str);
											//$.parser.parse($('#updateAccessoryInfoTb${rand}').parent());
											$.parser.parse($('#participantListTb${rand}').find("tr").eq(data.obj[i].number));
									    	
											if(data.obj[i].courseAllot=='K'){
												$("#stock"+data.obj[i].number+"${rand}").validatebox({required:false});
												$("#stockNameAndStandard"+data.obj[i].number+"${rand}").validatebox({required:true});
												$("#monad"+data.obj[i].number+"${rand}").validatebox({required:true});
												$("#totalAllot"+data.obj[i].number+"${rand}").validatebox({required:true});
												if(data.obj[i].stockNumber==null||$.trim(data.obj[i].stockNumber)==''){
													$("#itemGroup"+data.obj[i].number+"${rand} option[value='"+data.obj[i].itemGroup+"']").attr("selected", true); 
												}
											}
											$("#courseAllot"+data.obj[i].number+"${rand} option[value='"+data.obj[i].courseAllot+"']").attr("selected", true);  
											
										  MFixedAssetsDetraction.accessoryData.push({
											  rowno:data.obj[i].number,courseAllot:data.obj[i].courseAllot,stockNumber:data.obj[i].stockNumber,stockNameAndStandard:data.obj[i].stockNameAndStandard,applyNumber:data.obj[i].applyNumber,monad:data.obj[i].monad,reckoning:data.obj[i].reckoning,costCenter:$.trim(data.obj[i].costCenter),unitPrice:data.obj[i].unitPrice,amountInTotal:data.obj[i].amountInTotal,deliveryDate:data.obj[i].deliveryDate,procurementSection:data.obj[i].procurementSection,itemGroup:data.obj[i].itemGroup,applyName:data.obj[i].applyName,remark:data.obj[i].remark
						        			})
										  $.ajaxSetup({async : true});
										  $("#isOffRowCount${rand}").val(i+1);
										}
										
							    		var rows = $('#participantListTb${rand} tbody tr');
							    		var count=0;
							    		$('#participantListTb${rand} tbody tr').each(function () {
							        			if(count>0){
							        				var row=$.trim($(this).find('td').eq(0).find("input").val());
								        			var courseAllot1=$.trim($(this).find('td').eq(1).find("input").val());
								        			var stock1 = $(this).find('td').eq(2).find("input");
								        			var stockNameAndStandard1 =$(this).find('td').eq(3).find("input");
								        			var monad1 = $(this).find('td').eq(4).find("input");
								        			var reckoning=$(this).find('td').eq(6).find("input");
								        			var costCenter1 = $(this).find('td').eq(7).find("input");
								        			var procurementSection1 =$(this).find('td').eq(11).find("input");
								        			var itemGroup1=null;
								        			
								        			if(courseAllot1=='K'&&(stock1==null||stock1=='')){
								        				itemGroup1 =$(this).find('td').eq(12);
								        			}else{
								        				itemGroup1 =$(this).find('td').eq(12).find("input");
								        			}
								        			
								        			costCenter1.combobox({
							    						valueField : 'id',
							    						textField : 'text',
							    						//required : true,
							    						editable : false,
							    						onSelect : function(record) {
							    							makeImportInf();
							    							//$("#costCenterName${rand}").val(record.text);
							    							//$('#costCenterId${rand}').val(record.id);
							    						},onLoadSuccess:function(){
							    							costCenter1.combobox('setValue',costCenter1.val());
							    						}
							    					});
								        			
								    					$.get('hrFlow/getSapCostCenter.json', {
								    						factory:$("#factory${rand}").val()
								    					}, function(data) {
								    						costCenter1.combobox("clear")
								    								.combobox('loadData', data);
								    					}, 'json');
							        			}
							    				
							    					count++;
							        		});
								  }
									$('#scrapWay2JsonStr${rand}').val(JSON.stringify(MFixedAssetsDetraction));
									//document.getElementById('participantList_val').value=document.getElementById("participantList").innerHTML;
									$.messager.alert("提示信息",data.msg);
								}
							}else{ 
								$.messager.alert("提示信息",data.msg);
							}
							$("#importWin-${rand}").dialog('close');
							$.messager.progress('close');
						}
					});
			 });
			 
			 function makeImportInf() {
				 	var rows = $('#participantListTb${rand} tbody tr');
					if(rows.length == 0) {		
						$('#scrapWay2JsonStr${rand}').val('');
					} else {				
						var MFixedAssetsDetraction = { accessoryData:[] };
						var rowno = 0;
						$('#participantListTb${rand} tbody tr').each(function () {
							if(rowno>0){
								var courseAllot = $.trim($(this).find('td').eq(1).find("select").val());
			        			var stockNumber = $.trim($(this).find('td').eq(2).find("input").val());
			        			var stockNameAndStandard = $.trim($(this).find('td').eq(3).find("input").val());
			        			var applyNumber = $.trim($(this).find('td').eq(4).find("input").numberbox("getValue"));
			        			var monad = $.trim($(this).find('td').eq(5).find("input").val());
			        			var reckoning = $.trim($(this).find('td').eq(6).find("input").val());
			        			var costCenter = $.trim($(this).find('td').eq(7).find("input").combotree("getText"));
			        			var unitPrice = $.trim($(this).find('td').eq(8).find("input").val());
			        			var amountInTotal = $.trim($(this).find('td').eq(9).find("input").numberbox("getValue"));
			        			var deliveryDate = $.trim($(this).find('td').eq(10).find("input").val());
			        			var procurementSection = $.trim($(this).find('td').eq(11).find("input").val());
			        			var itemGroup='';
			        			if(courseAllot=='K' && (stockNumber==null || stockNumber=='')){
			        				itemGroup = $.trim($(this).find('td').eq(12).find("select").val());
			        			}else{
			        				itemGroup = $.trim($(this).find('td').eq(12).find("input").val());
			        			}
			        			var applyName = $.trim($(this).find('td').eq(13).find("input").val());
			        			var remark = $.trim($(this).find('td').eq(14).find("input").val());
		        			
		        		    	MFixedAssetsDetraction.accessoryData.push({
			        				rowno:rowno,courseAllot:courseAllot,stockNumber:stockNumber,stockNameAndStandard:stockNameAndStandard,applyNumber:applyNumber,monad:monad,reckoning:reckoning,costCenter:costCenter,unitPrice:unitPrice,amountInTotal:amountInTotal,deliveryDate:deliveryDate,procurementSection:procurementSection,itemGroup:itemGroup,applyName:applyName,remark:remark
			        			})
		        		    }
		        			
		        			rowno++;
		        		});
		        		
		        		$('#scrapWay2JsonStr${rand}').val(JSON.stringify(MFixedAssetsDetraction));
					}
				}
			
			 function showImportRequire(n){
					var courseAllot = $.trim($("#participantListTb${rand} tbody").find("tr").eq(n).find("td").eq(1).find("select").val());
					var stock=$("#participantListTb${rand} tbody").find("tr").eq(n).find("td").eq(2).find("input");
					var stockNameAndStandard=$("#participantListTb${rand} tbody").find("tr").eq(n).find("td").eq(3).find("input");
					var monad=$("#participantListTb${rand} tbody").find("tr").eq(n).find("td").eq(5).find("input");
					var roging=$("#participantListTb${rand} tbody").find("tr").eq(n).find("td").eq(6).find("input");
					//var costCenter=$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(9);
					var procurementSection=$("#participantListTb${rand} tbody").find("tr").eq(n).find("td").eq(11).find("input");
					var itemGroup=$("#participantListTb${rand} tbody").find("tr").eq(n).find("td").eq(12);
					//itemGroup.empty();
					roging.val('');
					if(courseAllot=='K'){
						stock.validatebox({required:false});
						stockNameAndStandard.validatebox({required:true});
						monad.validatebox({required:true});
						roging.validatebox({required:true});
						procurementSection.validatebox({required:true});
						//costCenter.html('<input id="costCenter'+n+'${rand}" type="text" class="easyui-combobox" data-options="valueField : \'id\',textField : \'text\',required : true,editable : false,onSelect : function(record) {makeAccessory();}" style="width:120px;border:solid 1px #007ACC;"/>');
						//roging.val('6598000059');
						if(stock.val()==null || stock.val()==''){
							itemGroup.html('<select id="itemGroup'+n+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getImportRecoking('+n+');">'
									+'<option value="7001">7001-消防类</option>'
									+'<option value="7002">7002-安全系统类</option>'
									+'<option value="7004">7004-电工维修工具类</option>'
									+'<option value="7005">7005-办公设施类</option>'
									+'<option value="7006">7006-办公用品类</option>'
									+'<option value="7007">7007-生活辅助类</option>'
									+'<option value="7008">7008-安装制作维修类</option>'
									+'<option value="7010" selected="selected">7010-设备维修类</option>'
									+'<option value="7011">7011-手机充值卡类</option>'
									+'<option value="7012">7012-手机测试卡类</option>'
									+'<option value="7014">7014-培训物资类</option>'
								+' </select>');
						}
					}else{
						//roging.val('');
						stock.validatebox({required:true});
						stockNameAndStandard.validatebox({required:false});
						monad.validatebox({required:false});
						roging.validatebox({required:false});
						procurementSection.validatebox({required:false});
						//costCenter.html('<input id="costCenter'+n+'${rand}" type="text" class="easyui-combobox" data-options="valueField : \'id\',textField : \'text\',required : false,editable : false,onSelect : function(record) {makeAccessory();}" style="width:120px;border:solid 1px #007ACC;"/>');
						itemGroup.html('<input id="itemGroup'+n+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" onblur="makeImportInf();" readonly/>');
					}
					//$('#accessoryInfoTb${rand} tbody').append($("#accessoryInfoTb${rand}").find("tr").eq(n-1));
			    	$.parser.parse($('#participantListTb${rand}').find("tr").eq(n));
			    	makeImportInf();
				}
			 
			 function getImportStockInfo(n){
				    var courseAllot = $.trim($("#participantListTb${rand}").find("tr").eq(n).find("td").eq(1).find("select").val());
					var stock=$.trim($("#participantListTb${rand}").find("tr").eq(n).find("td").eq(2).find("input").val());
					var factory=$.trim($("#factory${rand}").val());
					var reckoning=$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(6).find("input");
					var stockNameAndStandard=$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(3).find("input");
					var monad=$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(5).find("input");
					var procurementSection=$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(11).find("input");
					var itemGroup=null;
					if(courseAllot=='K'){
						itemGroup=$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(12);
					}else{
						itemGroup=$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(12).find("input");
					}
					if(factory==null || factory==''){
						return;
					}
					if(stock==null || stock==''){
						if(courseAllot=='K'){
							itemGroup.html('<select id="itemGroup'+n+'${rand}" style="width:95px;border:solid 1px #007ACC;" onchange="getImportRecoking('+n+');">'
									+'<option value="7001">7001-消防类</option>'
									+'<option value="7002">7002-安全系统类</option>'
									+'<option value="7004">7004-电工维修工具类</option>'
									+'<option value="7005">7005-办公设施类</option>'
									+'<option value="7006">7006-办公用品类</option>'
									+'<option value="7007">7007-生活辅助类</option>'
									+'<option value="7008">7008-安装制作维修类</option>'
									+'<option value="7010" selected="selected">7010-设备维修类</option>'
									+'<option value="7011">7011-手机充值卡类</option>'
									+'<option value="7012">7012-手机测试卡类</option>'
									+'<option value="7014">7014-培训物资类</option>'
								+' </select>');
							reckoning.val('');
						}
						return;
					}
					
						//根据工厂、物料编号获取非生产物资数据
						$.ajax({
					           type: "post",
					           url: "hrFlow/getStockInfo.json",
					           cache: false,
					           async: false,  //设置同步
					           dataType: "json",
					           data: {functionName:'ZHR_OA46',vars:'I_MATNR_VALUE_'+stock+'_NEXT_I_WERKS_VALUE_'+factory,exportTableName:'E_MATNR',
									exportlist:'MAKTX_NEXT_MEINS_NEXT_EKGRP_NEXT_MATKL'},
					           success: function (data) {
					            	var jsondata=eval("("+data+")");
					            	if(jsondata.MAKTX=='' && jsondata.MEINS=='' && jsondata.EKGRP=='' && jsondata.MATKL==''){
										$.messager.alert("提示信息","您好，此编号的非生产物资不存在!");
										$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(2).find("input").val('');
									}
					            	stockNameAndStandard.val(jsondata.MAKTX);
									monad.val(jsondata.MEINS);
									procurementSection.val(jsondata.EKGRP);
									//if(courseAllot=='K'){
										if(jsondata.MATKL=='7001'||jsondata.MATKL=='7010'){
											reckoning.val('6598000059');
										}else if(jsondata.MATKL=='7011'||jsondata.MATKL=='7014'){
											reckoning.val('6598000022');
										}else if(jsondata.MATKL=='7509'){
											reckoning.val('6598000086');
										}else if(jsondata.MATKL=='7510'){
											reckoning.val('6598000087');
										}else if(jsondata.MATKL=='7511'){
											reckoning.val('6598000088');
										}else{
											reckoning.val('6598000033');
										}
									if(courseAllot=='K'){
										itemGroup.html('<input id="itemGroup'+n+'${rand}" type="text" class="easyui-validatebox" style="width:95px;border:solid 1px #007ACC;" value="'+jsondata.MATKL+'" onblur="makeImportInf();"/>');
									}else{
										itemGroup.val(jsondata.MATKL);
									}
					            }
					          });
					
					makeImportInf();
				}
						
			 function getImportRecoking(n){
					var itemGroup = $.trim($("#participantListTb${rand}").find("tr").eq(n).find("td").eq(12).find("select").val());
					var reckoning=$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(6).find("input");
					if(itemGroup=='7001'||itemGroup=='7010'){
						reckoning.val('6598000059');
					}else if(itemGroup=='7011'||itemGroup=='7014'){
						reckoning.val('6598000022');
					}else if(itemGroup=='7509'){
						reckoning.val('6598000086');
					}else if(itemGroup=='7510'){
						reckoning.val('6598000087');
					}else if(itemGroup=='7511'){
						reckoning.val('6598000088');
					}else{
						reckoning.val('6598000033');
					}
					makeImportInf();
				}
			
			//计算物资合计价钱
			function getAcountIntTotal(n){
				var count=$.trim($("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(5).find("input").val());
				var price=$.trim($("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(9).find("input").val());
				if(isNaN(count)||count==undefined||count==''){
					return;
				}else{
					count=parseFloat(count);
				}
				if(isNaN(price)||price==undefined||price==''){
					return;
				}else{
					price=parseFloat(price);
				}
				$("#accessoryInfoTb${rand}").find("tr").eq(n-1).find("td").eq(10).find("input").val(price*count);
				makeAccessory();
			}
			
			function getImportAcountIntTotal(n){
				var count=$.trim($("#participantListTb${rand}").find("tr").eq(n).find("td").eq(4).find("input").val());
				var price=$.trim($("#participantListTb${rand}").find("tr").eq(n).find("td").eq(8).find("input").val());
				if(isNaN(count)||count==undefined||count==''){
					return;
				}else{
					count=parseFloat(count);
				}
				if(isNaN(price)||price==undefined||price==''){
					return;
				}else{
					price=parseFloat(price);
				}
				$("#participantListTb${rand}").find("tr").eq(n).find("td").eq(9).find("input").val(price*count);
				makeImportInf();
			}
		
			$("#logisticProcurementAudiAdvice${rand}").validatebox({required:false});
			var success = function(){
				$("#logisticProcurementAudiAdvice${rand}").validatebox({required:false});//采购员意见为非必填项
			}
			var failure=function(){
				$("#logisticProcurementAudiAdvice${rand}").val('');
				$("#logisticProcurementAudiAdvice${rand}").validatebox({required:true});//采购员意见为必填项
			};
			$("#logisticProcurementAgree${rand}").bind("click",success);
			$("#logisticProcurementDisagree${rand}").bind("click",failure);
</script>
</#if>
</#if>
</#if>

<!-- 后勤部经理审核 -->
<#if currentStep?exists && currentStep == 'logisticManagerAuditTask'> 
		<div id="logisticManagerAuditTask">
			<form id="logisticManagerAuditTaskForm" method="post" enctype='multipart/form-data'>
				<table id="logisticManagerAuditTaskFormTable" class="formtable" cellspacing="1" cellpadding="0">
					<tr>
						<td class="formtable_td_key" width="" colspan="2">后勤部经理审核</td>
						<td class="formtable_td_value"  >
							<input type="hidden" name="fp_logisticManagerAccount" value="${appuser.account}" />
							<input type="hidden" name="fp_logisticManagerName" mobile="后勤部经理审核" value="${appuser.name}" />
							${appuser.name}
						</td>
						<td class="formtable_td_value">
							<input id="logisticManagerAgree${rand}" type="radio" name="fp_logisticManagerAudi"mobile="审核结果_同意" checked="checked" value="0" />同意
							<input id="logisticManagerDisagree${rand}" type="radio" name="fp_logisticManagerAudi" mobile="审核结果_不同意"value="1" />不同意
						</td>
					</tr>
					<tr>
						<td class="formtable_td_key" colspan="2">处理意见：（包括维修价格、维修期限等，由处理单位填写）</td>
						<td class="formtable_td_value" colspan="2">
						<textarea id="logisticManagerAudiAdvice${rand}" style="width: 800px; height: 100px" mobile="处理意见：（包括维修价格、维修期限等，由处理单位填写）"
								name="fp_logisticManagerAudiAdvice" class="easyui-validatebox" ></textarea>
						</td>
					</tr>
					<tr>
						<td class="formtable_td_key" colspan="2">备注：</td>
						<td class="formtable_td_value" colspan="2">
						<textarea style="width: 800px; height: 100px" mobile="备注"
								name="fp_logisticManagerRemark" class="easyui-validatebox" ></textarea>
						</td>
					</tr>
					<tr>
						<td class="formtable_td_key" colspan="2">审核时间：</td>
						<td class="formtable_td_value"  colspan="2">
							<input id="proInstId" type="hidden" name="fp_proInstId" value="${processInstanceId}"/>
							<input type="hidden" name="fp_logisticManagerAudiTime" mobile="审批时间"
								timeEditor="1" 	value="${.now?string('yyyy-MM-dd HH:mm:ss')}" />
							${.now?string('yyyy-MM-dd HH:mm:ss')}
						</td>
					</tr>
				</table>
			</form>
		</div>
		<script type="text/javascript">
			$("#logisticManagerAudiAdvice${rand}").validatebox({required:false});
			var success = function(){
				$("#logisticManagerAudiAdvice${rand}").validatebox({required:false});//后勤部经理意见为非必填项
			}
			var failure=function(){
				$("#logisticManagerAudiAdvice${rand}").val('');
				$("#logisticManagerAudiAdvice${rand}").validatebox({required:true});//后勤部经理意见为必填项
			};
			$("#logisticManagerAgree${rand}").bind("click",success);
			$("#logisticManagerDisagree${rand}").bind("click",failure);
</script>
</#if>

<!-- 申请人查看凭证编号 -->
<!--<#if currentStep?exists && currentStep == 'applyGetProofNoTask'> 
		<div id="applyGetProofNoTask">
			<form id="applyGetProofNoTaskForm" method="post" enctype='multipart/form-data'>
				<table id="applyGetProofNoTaskFormTable" class="formtable" cellspacing="1" cellpadding="0" style="width:1498px;">
					<tr>
		  	  			<td class="formtable_td_key" align="center" colspan="4" style="font-weight:bold;font-size:14px;">
		  	  				申请人查看凭证编号
		  	  			</td>
		  	  		</tr>
					<tr>
						<td class="formtable_td_key">凭证编号：</td>
						<td class="formtable_td_value" colspan="3">
							<input type="easyui-validatebox" name="fp_proofNo" id="proofNo${rand}" readonly/>
						</td>
					</tr>
					<tr>
						<td style="width:133px" class="formtable_td_key">查看人：</td>
						<td width="325px" class="formtable_td_value">
							<input type="hidden" name="fp_getProofNoAccount" value="${appuser.account}" />
							<input type="hidden" name="fp_getProofNoName" mobile="查看人" value="${appuser.name}" />
							${appuser.name}
						</td>
						<td class="formtable_td_key">查看时间：</td>
						<td class="formtable_td_value">
							<input id="proInstId" type="hidden" value="${processInstanceId}"/>
							<input type="hidden" name="fp_getProofNoTime" mobile="查看时间"
								timeEditor="1" 	value="${.now?string('yyyy-MM-dd HH:mm:ss')}" />
							${.now?string('yyyy-MM-dd HH:mm:ss')}
						</td>
					</tr>
				</table>
			</form>
		</div>
	<script type="text/javascript">
		$(function(){
			$.get("workspace/getNoProducProofNo.json",{
				processId:$("#proInstId").val()
			},function(data){
				$("#proofNo${rand}").val(data);
			});
		});
</script>
</#if>-->

<!-- 总经理审核 -->
<!--<#if currentStep?exists && currentStep == 'generalManagerAuditTask'> 
		<div id="generalManagerAuditTask">
			<form id="generalManagerAuditTaskForm" method="post" enctype='multipart/form-data'>
				<table id="generalManagerAuditTaskFormTable" class="formtable" cellspacing="1" cellpadding="0" >
					<tr>
						<td class="formtable_td_key" width="">总经理审核</td>
						<td class="formtable_td_value"  >
							<input type="hidden" name="fp_generalManagerAccount" value="${appuser.account}" />
							<input type="hidden" name="fp_generalManagerName" mobile="总经理审核" value="${appuser.name}" />
							${appuser.name}
						</td>
						<td class="formtable_td_value" colspan="2">
							<input id="generalManagerAgree${rand}" type="radio" name="fp_generalManagerAudi" mobile="审核结果_同意" checked="checked" value="0" />同意
							<input id="generalManagerDisagree${rand}" type="radio" name="fp_generalManagerAudi" mobile="审核结果_不同意" value="1" />不同意
						</td>
					</tr>
					<tr>
						<td class="formtable_td_key">处理意见：（包括维修价格、维修期限等，由处理单位填写）</td>
						<td class="formtable_td_value" colspan="3">
						<textarea id="generalManagerAudiAdvice${rand}" style="width: 730px; height: 100px" mobile="审核意见"
								name="fp_generalManagerAudiAdvice" class="easyui-validatebox" ></textarea>
						</td>
					</tr>
					<tr>
						<td class="formtable_td_key">审核时间：</td>
						<td class="formtable_td_value"  colspan="3">
							<input type="hidden" name="fp_generalManagerAudiTime" mobile="审核时间"
								timeEditor="1" 	value="${.now?string('yyyy-MM-dd HH:mm:ss')}" />
							${.now?string('yyyy-MM-dd HH:mm:ss')}
						</td>
					</tr>
					<tr>
						<td class="formtable_td_key">备注：</td>
						<td class="formtable_td_value" colspan="3">
						<textarea style="width: 730px; height: 100px"
								name="fp_generalManagerRemark" class="easyui-validatebox" ></textarea>
						</td>
					</tr>
				</table>
			</form>
		</div>
		<script type="text/javascript">
			$("#generalManagerAudiAdvice${rand}").validatebox({required:false});
			var success = function(){
				$("#generalManagerAudiAdvice${rand}").validatebox({required:false});//总经理意见为非必填项
			}
			var failure=function(){
				$("#generalManagerAudiAdvice${rand}").val('');
				$("#generalManagerAudiAdvice${rand}").validatebox({required:true});//总经理意见为必填项
			};
			$("#generalManagerAgree${rand}").bind("click",success);
			$("#generalManagerDisagree${rand}").bind("click",failure);
</script>
</#if>-->

<!-- SAP录入员确认-->
<!--<#if currentStep?exists && currentStep == 'keyboarderVerifyTask'> 
	<#if processSteps??> 
      <#list processSteps as steps> 
      	<#if steps.key == 'startevent1'>
		<div id="keyboarderVerifyTask">
			<form id="keyboarderVerifyTaskForm" method="post" enctype='multipart/form-data'>
				<table id="keyboarderVerifyTaskFormTable" class="formtable" cellspacing="1" cellpadding="0" >
					<tr><td class="formtable_td_key" align="center" colspan="4">SAP录入员确认</td></tr>
					<tr>
						<td class="formtable_td_key">处理意见：（包括维修价格、维修期限等，由处理单位填写）</td>
						<td class="formtable_td_value" colspan="3">
							<textarea style="width: 730px; height: 100px" name="fp_keyboarderAudiAdvice" class="formtable_remark" ></textarea>
						</td>
					</tr>
		  	  		<tr>
						<td class="formtable_td_key" width="">确认人:</td>
						<td class="formtable_td_value">
							<input type="hidden" name="fp_keyboarderAccount" value="${appuser.account}" />
							<input type="hidden" name="fp_keyboarderName" value="${appuser.name}" />
							${appuser.name}
						</td>
						<td class="formtable_td_key">确认时间：</td>
						<td class="formtable_td_value">
							<input type="hidden" name="fp_keyboarderAudiTime"
									value="${.now?string('yyyy-MM-dd HH:mm:ss')}" />
							${.now?string('yyyy-MM-dd HH:mm:ss')}
						</td>
					</tr>
					<tr>
						<td class="formtable_td_key">备注：</td>
						<td class="formtable_td_value" colspan="3">
							<textarea style="width: 730px; height: 100px" name="fp_keyboarderRemark" class="formtable_remark" ></textarea>
						</td>
					</tr>
				</table>
			</form>
		</div>
		<script type="text/javascript">
		</script>
		</#if>
	</#list>
   </#if>
</#if>-->

<#include "/common/foot.html">